<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head lang="en">
	<title>UnrealWiki: Moofed</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<link rel="stylesheet" type="text/css" media="screen, print"
		href="shared/stylebase.structural.css">	
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/template-default.css">
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/styles.chblue.css">
	<link rel="stylesheet" type="text/css" media="print"
		href="shared/template-default-print.css">
	<!--[if IE 6]>
			<style>
			/* dirty hack for IE6. */
			#quickbar {
				position: absolute;
				}
			</style>
	<![endif]-->
  <link rel="start" href="http://wiki.beyondunreal.com/">
  <link rel="glossary"  href="http://wiki.beyondunreal.com/wiki/Terminology">
  <link rel="help"  href="http://wiki.beyondunreal.com/wiki/Using_The_Wiki">
<script type="text/javascript" src="shared/dhtml.js"></script>
<script type="text/javascript" src="shared/dhtml-menu.js"></script>
<style type="text/css">#dhtml-menu    { background: #eee; padding: 5px 0px; margin-right: -20px; border: 1px solid #888; border-left: 1px solid #ccc; border-top: 1px solid #ccc;  border-right: 1px solid #888; border-bottom: 1px solid #888 }
#dhtml-menu td { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; padding: 1px 10px; cursor: default }
#dhtml-menu a  { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; text-decoration: none }
#dhtml-menu tt { font-family: monospace; font-size: 9pt }
#dhtml-menu-separator { height: 1px; background: red }
#dhtml-menu-anchor { cursor: default }
</style>
<script type="text/javascript" src="shared/expandable.js"></script>
</head>
<body onLoad="menuInit(); document.cookie='page=Moofed; path=/'" class="default">
<div id="scrolling"><!-- contains all except the fixed sidebar -->
<div id="topbar"  class="bar">
	<div class="righthalf">
		<form class="inline" method="post" action="/wiki" enctype="application/x-www-form-urlencoded"><input type="text" name="search"  size="20" /> <input type="submit" name="search" value="search" /></form>
	</div>
	<div class="lefthalf">
		<script type="text/javascript"><!--
			menuAlignRight = false;
		//--></script>
		<span><script type="text/javascript"><!--
 menuWriteAnchor("Quick Navigation") //--></script></span> | <a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a>
	</div>
</div>

<div id="content"><!-- contains the title and article -->
	<h1 class='pagetitle'><a href="http://wiki.beyondunreal.com/wiki?back=Moofed">Moofed</a></h1>
	<div class="wiki"><h2><a name="0.1"></a>Moofed</h2>
<p>I'm a newer member of the Unreal modding community.  I've been a long time fan of the Unreal games (I had an Unreal hat at one time, but it has long since been lost), but only recently have had the time and skills to look at any unrealscript.</p>
<h3><a name="0.1.1"></a>Carjack</h3>
<p><em class="em2">Released!</em> The results of the Carjack project, including a download of the mod, are available from <a href="http://spock.informatics.indiana.edu/~carjack">http://spock.informatics.indiana.edu/~carjack</a></p>
<p>The performance in general is not that great because of the large amount of physics calculations and AI driver code from about 40 vehicles.  Not recommended for Internet play.  It would have been unplayable FPS-wise had we used an over-the-shoulder camera due to rendering an entire city's worth of static meshes.  The top-down viewpoint avoided that problem nicely.  But, it is fun with a couple friends on a LAN.  Enjoy!</p>
<hr class="thin"><p>Carjack is a mod I am working on to complete the capstone project for my Informatics degree from Indiana University.  It is an attempt to clone the multiplayer gameplay from Grand Theft Auto 2, while making use of the modern amenities found in UnrealEngine2.  My reason for this project is GTA2 has always been a blast to play at LAN parties, but it has certain limitations (such as using DirectPlay 6.1 for its netcode and being limited to 6 players) that make having fun playing it more difficult.</p>
<p>A video showcasing the progress of the project as of mid-Feburary 2006 is available:</p>
<p><a href="https://www.slashtmp.iu.edu/public/download.php?FILE=dlpierce/94788r7kgDF">https://www.slashtmp.iu.edu/public/download.php?FILE=dlpierce/94788r7kgDF</a></p>
<p>Yes, I do know that <a href="mod-ideas-carjack.html">Mod Ideas/CarJack</a> has the same name, but I didn't see that page until we had already started work.  Plus "Carjack" is only a working title for now, it may change.</p>
<h4><a name="0.1.1.1"></a>Civilians</h4>
<p>Part of what makes GTA2 so neat is there are hordes of civilians wondering the streets that pose no threat to the player.  I anticipate this feature to be one of the more difficult in developing the mod, and is why I am writing about it here.  What I want to make happen is</p>
<ul><li>Have civilian vehicles driving on city streets<ul><li>These drivers should stop when something is in front of them, and when they come to a (red) traffic light.</li>
<li>They must drive on the streets, but will become spooked by gunshots and then drive erratically/aggressively or get out of the vehicle and run for their lives (effectively becoming a spooked pedestrian, see below).</li>
<li>A predetermined number of civilian vehicles will exist in the game at any one time.  When one is destroyed, another is spawned at a random VehicleFactory location. Ideally, this will not be visible to the players.  I am imagining a garage with doors that open up and the new civilian drives out.  Only spawned civilians would be allowed out, no one allowed in.</li>
</ul>
</li>
<li>Have civilian pedestrians wandering the sidewalks.<ul><li>Pedestrians stay on the sidewalks unless spooked, at which point they run away from the player.</li>
<li>There is a chance the pedestrian will not be a total pushover and will whip out a pistol and start shooting back.</li>
<li>Killed pedestrians have a chance of dropping an item (weapon, health, whatever).</li>
</ul>
</li>
</ul>
<p>To do all this I think I will need three seperate bot paths, two for vehicles (one for each side of the road) and one for pedestrians, plus some extra pathnodes only available to bots (if I got that far) and spooked NPCs.  Spooked NPCs would also have the vehicle pathnodes at their disposal.  Functioning stop lights are also necessary to make a believable traffic simulation, but obviously add much more complexity to the problem.</p>
<p><em class="em2">Update:</em> After much experimentation, I have decided that the NavigationPoint system is not suitable for what I want to do.  The autoconnecting behavior ruins any attempt to make  seperate paths from nodes in close proximity (such as the two lanes of a road).  </p>
<p>Instead I have made a custom network of Actor nodes that each have an array of nodes that the vehicle can go to next (randomly selected).  This has the advantage of allowing the mapper to precisely define the map's traffic behavior, and the disadvantages of not being automated like NavigationPoints are, and not having any lines displayed in UnrealEd.  I can display the network inside the game using HUD.Draw3DLine, but UnrealEd has no HUDs as far as I can tell (or any way to change anything actually).  I am thinking of making using a similar node network for civilian pedestrians, leaving the NavigationPoint network free to be dedicated to bots.</p>
<p>At first I was using MoveToward to make my vehicles move, but this again was insufficient.  MoveToward dis not control the steering acurately enough to stay on the correct side of the road, instead the drivers would drunkenly drift over the centerline or onto the sidewalks.  MoveToward also has no interface to control the vehicle's throttle, giving the all civilians a severe case of lead foot.  This is my current driver controller:</p>
<table border=0 cellspacing=0 cellpadding=0 class="wookee-expandable"><tr><td valign=top></td>
<td valign=top>&nbsp;<a class="wookee-expandable-label" labelfor="wookee-expandable-11" onclick="toggleElementExpanded(event);">&gt;&gt;</a></td>
</tr>
</table>
<div id="wookee-expandable-11" class="wookee-expandable-body expandable"><pre class="uscript"><span class="uscript-keyword">class</span> CarjackDriver <span class="uscript-keyword">extends</span> CarjackNPC<span class="uscript-operator">;</span>

<span class="uscript-keyword">var</span> <span class="uscript-type">int</span> NumRandomJumps<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span> Actor RandDest<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span> Actor TempPoint<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span> CarjackRoadNode DestRoadNode<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span> <span class="uscript-type">float</span> DriverThrottle<span class="uscript-operator">,</span> DriverSteering<span class="uscript-operator">;</span> <span class="uscript-comment">//Sets respective vehicle variables via Tick in the vehicle's code</span>

<span class="uscript-keyword">function</span> CarjackRoadNode FindRandomRoadNode<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-keyword">array</span><span class="uscript-operator">&lt;</span>CarjackRoadNode<span class="uscript-operator">&gt;</span> NodeList<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> CarjackRoadNode Node<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> i<span class="uscript-operator">;</span>
    
    <span class="uscript-keyword">foreach</span> AllActors<span class="uscript-operator">(</span><span class="uscript-keyword">class</span><span class="uscript-name">'CarjackRoadNode'</span><span class="uscript-operator">,</span> Node<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        NodeList<span class="uscript-operator">[</span>i<span class="uscript-operator">]</span> <span class="uscript-operator">=</span> Node<span class="uscript-operator">;</span>
        i<span class="uscript-operator">++</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">return</span> NodeList<span class="uscript-operator">[</span>Rand<span class="uscript-operator">(</span>NodeList<span class="uscript-operator">.</span><span class="uscript-keyword">Length</span><span class="uscript-operator">)</span><span class="uscript-operator">]</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">function</span> CarjackRoadNode FindNearestRoadNode<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> CarjackRoadNode Node<span class="uscript-operator">,</span> ClosestNode<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> Dist<span class="uscript-operator">,</span> ClosestDist<span class="uscript-operator">;</span>
    
    ClosestDist <span class="uscript-operator">=</span> <span class="uscript-number">100000.0</span><span class="uscript-operator">;</span>
    
    <span class="uscript-keyword">foreach</span> AllActors<span class="uscript-operator">(</span><span class="uscript-keyword">class</span><span class="uscript-name">'CarjackRoadNode'</span><span class="uscript-operator">,</span> Node<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        Dist <span class="uscript-operator">=</span> VSize<span class="uscript-operator">(</span>Node<span class="uscript-operator">.</span>Location <span class="uscript-operator">-</span> Pawn<span class="uscript-operator">.</span>Location<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Dist <span class="uscript-operator">&lt;</span> ClosestDist<span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            ClosestNode <span class="uscript-operator">=</span> Node<span class="uscript-operator">;</span>
            ClosestDist <span class="uscript-operator">=</span> Dist<span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">return</span> ClosestNode<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">function</span> CarjackRoadNode FindNextRoadNode<span class="uscript-operator">(</span>CarjackRoadNode CurrentNode<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">return</span> CurrentNode<span class="uscript-operator">.</span>GetNextNode<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-comment">//Check for Pawns in the way.</span>
<span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> CheckObstruction<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> vector HitLocation<span class="uscript-operator">,</span> HitNormal<span class="uscript-operator">,</span> ExtentSize<span class="uscript-operator">;</span>
    
    ExtentSize<span class="uscript-operator">.</span>X <span class="uscript-operator">=</span> CarjackVehicle<span class="uscript-operator">(</span>Pawn<span class="uscript-operator">)</span><span class="uscript-operator">.</span>VehicleWidth<span class="uscript-operator">;</span>
    ExtentSize<span class="uscript-operator">.</span>Y <span class="uscript-operator">=</span> CarjackVehicle<span class="uscript-operator">(</span>Pawn<span class="uscript-operator">)</span><span class="uscript-operator">.</span>VehicleWidth<span class="uscript-operator">;</span>
    
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Pawn<span class="uscript-operator">(</span>Trace<span class="uscript-operator">(</span>HitLocation<span class="uscript-operator">,</span> HitNormal<span class="uscript-operator">,</span> <span class="uscript-operator">(</span>vector<span class="uscript-operator">(</span>Pawn<span class="uscript-operator">.</span>Rotation<span class="uscript-operator">)</span> <span class="uscript-operator">*</span> <span class="uscript-number">250</span><span class="uscript-operator">)</span> <span class="uscript-operator">+</span> Pawn<span class="uscript-operator">.</span>Location<span class="uscript-operator">,</span> Pawn<span class="uscript-operator">.</span>Location<span class="uscript-operator">,</span> <span class="uscript-keyword">true</span><span class="uscript-operator">,</span> ExtentSize<span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">!=</span> <span class="uscript-keyword">None</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        <span class="uscript-keyword">return</span> <span class="uscript-keyword">true</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">return</span> <span class="uscript-keyword">false</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">auto</span> <span class="uscript-keyword">state</span> Driving
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">function</span> SetThrottle<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        <span class="uscript-keyword">local</span> Vehicle V<span class="uscript-operator">;</span>
        
        V <span class="uscript-operator">=</span> Vehicle<span class="uscript-operator">(</span>Pawn<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>VSize<span class="uscript-operator">(</span>V<span class="uscript-operator">.</span>Velocity<span class="uscript-operator">)</span> <span class="uscript-operator">&gt;</span> DestRoadNode<span class="uscript-operator">.</span>SpeedLimit<span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            DriverThrottle <span class="uscript-operator">=</span> <span class="uscript-number">0.25</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
        <span class="uscript-keyword">else</span>
        <span class="uscript-operator">{</span>
            DriverThrottle <span class="uscript-operator">=</span> <span class="uscript-number">0.90</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
    <span class="uscript-operator">}</span>
    
    <span class="uscript-keyword">function</span> SetSteering<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> RadiansDelta<span class="uscript-operator">,</span> RightOrLeft<span class="uscript-operator">,</span> ForwardOrBackward<span class="uscript-operator">;</span>
        <span class="uscript-keyword">local</span> Vehicle V<span class="uscript-operator">;</span>
        
        V <span class="uscript-operator">=</span> Vehicle<span class="uscript-operator">(</span>Pawn<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        
        RadiansDelta <span class="uscript-operator">=</span> Acos<span class="uscript-operator">(</span>Normal<span class="uscript-operator">(</span>vector<span class="uscript-operator">(</span>V<span class="uscript-operator">.</span>Rotation<span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">dot</span> Normal<span class="uscript-operator">(</span>DestRoadNode<span class="uscript-operator">.</span>Location <span class="uscript-operator">-</span> V<span class="uscript-operator">.</span>Location<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        RightOrLeft <span class="uscript-operator">=</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>vector<span class="uscript-operator">(</span>V<span class="uscript-operator">.</span>Rotation<span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">cross</span> <span class="uscript-keyword">vect</span><span class="uscript-operator">(</span><span class="uscript-number">0</span><span class="uscript-operator">,</span><span class="uscript-number">0</span><span class="uscript-operator">,</span><span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">dot</span> Normal<span class="uscript-operator">(</span>DestRoadNode<span class="uscript-operator">.</span>Location <span class="uscript-operator">-</span> V<span class="uscript-operator">.</span>Location<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        ForwardOrBackward <span class="uscript-operator">=</span> vector<span class="uscript-operator">(</span>V<span class="uscript-operator">.</span>Rotation<span class="uscript-operator">)</span> <span class="uscript-operator">dot</span> Normal<span class="uscript-operator">(</span>DestRoadNode<span class="uscript-operator">.</span>Location <span class="uscript-operator">-</span> V<span class="uscript-operator">.</span>Location<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>RightOrLeft <span class="uscript-operator">&lt;</span> <span class="uscript-number">0.0</span><span class="uscript-operator">)</span> <span class="uscript-comment">// Turn Left</span>
        <span class="uscript-operator">{</span>
            DriverSteering <span class="uscript-operator">=</span> FClamp<span class="uscript-operator">(</span>RadiansDelta<span class="uscript-operator">,</span> <span class="uscript-number">0.0</span><span class="uscript-operator">,</span> <span class="uscript-number">1.0</span><span class="uscript-operator">)</span> <span class="uscript-operator">*</span> <span class="uscript-operator">-</span><span class="uscript-number">1</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
        <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>RightOrLeft <span class="uscript-operator">&gt;</span> <span class="uscript-number">0.0</span><span class="uscript-operator">)</span> <span class="uscript-comment">// Turn Right</span>
        <span class="uscript-operator">{</span>
            DriverSteering <span class="uscript-operator">=</span> FClamp<span class="uscript-operator">(</span>RadiansDelta<span class="uscript-operator">,</span> <span class="uscript-number">0.0</span><span class="uscript-operator">,</span> <span class="uscript-number">1.0</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
        <span class="uscript-keyword">else</span>
        <span class="uscript-operator">{</span>
            DriverSteering <span class="uscript-operator">=</span> <span class="uscript-number">0.0</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
    <span class="uscript-operator">}</span>
    
Begin:
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>DestRoadNode <span class="uscript-operator">==</span> <span class="uscript-keyword">None</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        DestRoadNode <span class="uscript-operator">=</span> FindNearestRoadNode<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>CheckObstruction<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        GoToState<span class="uscript-operator">(</span><span class="uscript-name">'Obstructed'</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>VSize<span class="uscript-operator">(</span>DestRoadNode<span class="uscript-operator">.</span>Location <span class="uscript-operator">-</span> Pawn<span class="uscript-operator">.</span>Location<span class="uscript-operator">)</span> <span class="uscript-operator">&lt;</span> <span class="uscript-number">200</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>DestRoadNode<span class="uscript-operator">.</span>bStopTraffic<span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            GotoState<span class="uscript-operator">(</span><span class="uscript-name">'Stopped'</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
        <span class="uscript-keyword">else</span>
        <span class="uscript-operator">{</span>
            DestRoadNode <span class="uscript-operator">=</span> FindNextRoadNode<span class="uscript-operator">(</span>DestRoadNode<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
    <span class="uscript-operator">}</span>
    
    SetThrottle<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    SetSteering<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    
    Sleep<span class="uscript-operator">(</span><span class="uscript-number">0.2</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">Goto</span><span class="uscript-operator">(</span><span class="uscript-name">'Begin'</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">state</span> Stopped
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">function</span> SetThrottle<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        DriverThrottle <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    
Begin:
    SetThrottle<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span><span class="uscript-operator">!</span>DestRoadNode<span class="uscript-operator">.</span>bStopTraffic<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        GotoState<span class="uscript-operator">(</span><span class="uscript-name">'Driving'</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    Sleep<span class="uscript-operator">(</span><span class="uscript-number">0.5</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">Goto</span><span class="uscript-operator">(</span><span class="uscript-name">'Begin'</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">state</span> Obstructed
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">function</span> SetThrottle<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        DriverThrottle <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    
Begin:
    SetThrottle<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span><span class="uscript-operator">!</span>CheckObstruction<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        GotoState<span class="uscript-operator">(</span><span class="uscript-name">'Driving'</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    Sleep<span class="uscript-operator">(</span><span class="uscript-number">0.5</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">Goto</span><span class="uscript-operator">(</span><span class="uscript-name">'Begin'</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre></div>
<p>Thoughts please.</p>
<h2><a name="0.2"></a>Discussion</h2>
<p><em class="em2">Wormbo:</em> Hi and welcome to the Wiki. <img alt=":)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">Jimboh:</em> Hmm...civilians are surprisingly easy. All you have to do is create a pawn...then create an AIController without the monster states - add the model, and PRESTO! Instant Civilian! Of course then you'd have to create some botpaths for your civvies. I remember in Tanus' Syndicate 2003 MOD he had a tutorial on NPC's...the site is down, so if anyone has the tutorial saved, it would be most helpful...</p>
<p><em class="em2">Sweavo:</em> Hi there, I posted that <a href="mod-ideas-civilians.html">Mod Ideas/Civilians</a> page.  I'm interested in following progress and assisting in this mod.  I'm thinking off-map factories too.  See DM-Autoroute2 for a map that would really benefit from civilians.  I anticipate the <em class="em2">hardest</em> part of this is realistic AI, combining the "milling about" behaviour with the "spooked" to make the civilians look like they have a back-story, .  Once that bit's done, the <em class="em2">most work</em> would likely be coming up with meshes and textures for the pawns and vehicles.  I have no clue when it comes to modelling.  Maybe the unwheel project has spare vehicles that can be adapted.</p>
<p><em class="em2">SuperApe:</em> Hi, Moofed. (Welcome <img alt=":)" src="emoticons/smile.gif" align="middle">)  What Jimboh is saying is true.  It can be easy, but I agree with Sweavo too, in that you'd probably want a different kind of AI.  And I think different models, animations and skins are a good idea too. (animations without weapon-holding for example)  I suggest, because most of what makes up a Bot and xPawn are geared for combat, borrow what you can from them (perhaps use them for testing purposes too) and then begin to implement your own custom stuff.  You and Sweavo should take a look at the <a href="maya-ple-character-model-tu.html">Maya PLE Character Model Tutorial</a>, it should not be too hard to implement a custom civilian model and animation.  And, check out <a href="npc-support.html">NPC Support</a> for ideas.  Can't wait to see what you guys come up with.  It sounds neat. <img alt=":)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">Moofed:</em> Thanks for the warm welcome everyone! <img alt=":cheesy:" src="emoticons/cheesy.gif" align="middle">  I should mention that there are two other people working on the mod, one who is concentrating on building a cityscape map, the other is a modeler and is making a first set of real world vehicles to play with, not to mention some staticmeshes for the map.  I'm already using some of the skidmark code from UnWheel (with permission of course), so I might see about including some of their vehicles as well.  They've been a great help for resolving scaling issues already.  I'll try to get a basic pedestrian working tonight.</p>
<p><em class="em2">Tarquin:</em> Hi, welcome. Interesting project!</p>
<p><em class="em2">Moofed:</em> I thought this would be a simple task, but the FindRandomDest() function insists upon returning nothing but None.  If I extend from MonsterController the function works, but as already stated. we want to extend from Controller.  Help?</p>
<p><em class="em2">SuperApe:</em> Sorry, FindRandomDest() is an EMPTY function.  It's actually used in a few places, but it's completely useless in stock Controller classes.  It must have been defined for subclass use.  But, no big deal.  Finding a <em class="em1">random</em> destination isn't much harder than picking a NavigationPoint that isn't <tt>taken</tt>.  </p>
<pre class="uscript"><span class="uscript-keyword">function</span> NavigationPoint FindRandomDest<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
     <span class="uscript-keyword">local</span> NavigationPoint N<span class="uscript-operator">;</span>
     <span class="uscript-keyword">local</span> <span class="uscript-keyword">array</span><span class="uscript-operator">&lt;</span>NavigationPoint<span class="uscript-operator">&gt;</span> NP<span class="uscript-operator">;</span>
     <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> i<span class="uscript-operator">;</span>

     NP<span class="uscript-operator">.</span><span class="uscript-keyword">Insert</span><span class="uscript-operator">(</span>i<span class="uscript-operator">,</span><span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
     <span class="uscript-keyword">forEach</span> AllActors<span class="uscript-operator">(</span> <span class="uscript-keyword">class</span><span class="uscript-name">'NavigationPoint'</span><span class="uscript-operator">,</span> N <span class="uscript-operator">)</span>
          <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> <span class="uscript-operator">!</span>N<span class="uscript-operator">.</span>taken <span class="uscript-operator">)</span>
          <span class="uscript-operator">{</span>
               NP<span class="uscript-operator">[</span>i<span class="uscript-operator">]</span> <span class="uscript-operator">=</span> N<span class="uscript-operator">;</span>
               i<span class="uscript-operator">++</span><span class="uscript-operator">;</span>
               NP<span class="uscript-operator">.</span><span class="uscript-keyword">Insert</span><span class="uscript-operator">(</span>i<span class="uscript-operator">,</span><span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
          <span class="uscript-operator">}</span>
     <span class="uscript-keyword">return</span> NP<span class="uscript-operator">[</span> FRand<span class="uscript-operator">(</span><span class="uscript-operator">)</span> <span class="uscript-operator">*</span> i <span class="uscript-operator">]</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Re-define as necessary. <img alt=":)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">Moofed:</em> Thanks!  I saw </p>
<pre class="uscript"><span class="uscript-keyword">native</span><span class="uscript-operator">(</span><span class="uscript-number">525</span><span class="uscript-operator">)</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> NavigationPoint FindRandomDest<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span></pre><pre class="paraverbatim"> so I thought it couldn't be overridden and the source would not be available. Maybe it is overridden in yet more native code...</pre><p><em class="em2">SuperApe:</em> Well, whether there is some code to it now or not, I suppose you might as well try to override it for your custom purposes in the Pedestrian/Civilian controller.  If you can't override it, perhaps you can use this code anyway in a similar function.</p>
<p><em class="em2">Draconx:</em> This is what I use in my mod for original UT... assuming it still works (Why wouldn't it...) it is much more efficient than the above foreach AllActors method.</p>
<pre class="uscript"><span class="uscript-keyword">for</span> <span class="uscript-operator">(</span>N <span class="uscript-operator">=</span> Level<span class="uscript-operator">.</span>NavigationPointList<span class="uscript-operator">;</span> N <span class="uscript-operator">!=</span> <span class="uscript-keyword">None</span><span class="uscript-operator">;</span> N <span class="uscript-operator">=</span> N<span class="uscript-operator">.</span>NextNavigationPoint<span class="uscript-operator">)</span></pre><p><em class="em2">SuperApe:</em> That's great! <img alt=":)" src="emoticons/smile.gif" align="middle">  I can use that too.  Thanks.</p>
<hr class="thin"><p><a href="category-personal-page.html">Category Personal Page</a></p>
<script type="text/javascript"><!--
 menuItemAdd("Moofed", "#0.1");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Carjack", "#0.1.1");
menuItemAdd("<tt>&nbsp;&nbsp;&nbsp;&nbsp;</tt>Civilians", "#0.1.1.1");
menuItemAdd("Discussion", "#0.2");
 menuWrite() //--></script></div>
</div>

<div id="footer" class="bar">
	<p><form method="post" action="http://wiki.beyondunreal.com/wiki" enctype="application/x-www-form-urlencoded">
<a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a><br>
Last edited September 28, 2006 12:28 <a href="http://wiki.beyondunreal.com/wiki?action=browse&diff=1&id=Moofed">(diff)</a><br>Search: <input type="text" name="search"  size="20" /><input type="hidden" name="dosearch" value="1"  /><br><br><small><a href="http://wiki.beyondunreal.com/wiki/Moofed">Original page</a> &#150; copy created Sat, Jun 23, 2007</small><div></div>
</form>
	</p>
	<p>Gah - a solution with more questions. (EntropicLqd)
</p>
</div>
</div><!-- close of "scrolling" div -->

<div id="quickbar">
	<div id="logo"><a href="../index.html"><img src="shared/wikilogo.jpg" width="143" height="100" border="0"></a>
		</div>
	<div class="qbsitename">
		<p>The Unreal Engine Documentation Site</p>
	</div>
	<div class="qbsection">
<p><a href="metatopics.html">Wiki Community</a></p>
<p><a href="category-category.html">Topic Categories</a></p>


<p><a href="recent-changes.html">Recent Changes</a></p>
<p><a href="offline-wiki.html">Offline Wiki</a></p>
</div><div class="qbsection">
<p><a href="unreal-engine.html">Unreal Engine</a></p>
<p><a href="console-commands.html">Console Commands</a></p>
<p><a href="terminology.html">Terminology</a></p>
<p><a href="category-faq.html">FAQs</a></p>
<p><a href="help-desk.html">Help Desk</a></p>
</div><div class="qbsection">
<p><a href="topics-on-mapping.html">Mapping Topics</a></p>
<p><a href="mapping-lessons.html">Mapping Lessons</a></p>
<p><a href="unrealed-3.html">UnrealEd Interface</a></p>
</div><div class="qbsection">
<p><a href="unrealscript.html">UnrealScript Topics</a></p>
<p><a href="unrealscript-lessons.html">UnrealScript Lessons</a></p>
<p><a href="making-mods.html">Making Mods</a></p>
<p><a href="class-tree.html">Class Tree</a></p>
</div><div class="qbsection">
<p><a href="topics-on-modeling.html">Modeling Topics</a></p>
</div><div class="qbsection">
<p><a href="chongqing-page.html">Chongqing Page</a></p>
<p><a href="log-in.html">Log In</a></p></div>
</div>

</body></html>
