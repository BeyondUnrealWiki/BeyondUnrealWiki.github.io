<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head lang="en">
	<title>UnrealWiki: Karma Functions And Events</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<link rel="stylesheet" type="text/css" media="screen, print"
		href="shared/stylebase.structural.css">	
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/template-default.css">
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/styles.chblue.css">
	<link rel="stylesheet" type="text/css" media="print"
		href="shared/template-default-print.css">
	<!--[if IE 6]>
			<style>
			/* dirty hack for IE6. */
			#quickbar {
				position: absolute;
				}
			</style>
	<![endif]-->
  <link rel="start" href="http://wiki.beyondunreal.com/">
  <link rel="glossary"  href="http://wiki.beyondunreal.com/wiki/Terminology">
  <link rel="help"  href="http://wiki.beyondunreal.com/wiki/Using_The_Wiki">
<script type="text/javascript" src="shared/dhtml.js"></script>
<script type="text/javascript" src="shared/dhtml-menu.js"></script>
<style type="text/css">#dhtml-menu    { background: #eee; padding: 5px 0px; margin-right: -20px; border: 1px solid #888; border-left: 1px solid #ccc; border-top: 1px solid #ccc;  border-right: 1px solid #888; border-bottom: 1px solid #888 }
#dhtml-menu td { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; padding: 1px 10px; cursor: default }
#dhtml-menu a  { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; text-decoration: none }
#dhtml-menu tt { font-family: monospace; font-size: 9pt }
#dhtml-menu-separator { height: 1px; background: red }
#dhtml-menu-anchor { cursor: default }
</style>
<script type="text/javascript" src="shared/expandable.js"></script>
</head>
<body onLoad="menuInit(); document.cookie='page=Karma_Functions_And_Events; path=/'" class="default">
<div id="scrolling"><!-- contains all except the fixed sidebar -->
<div id="topbar"  class="bar">
	<div class="righthalf">
		<form class="inline" method="post" action="/wiki" enctype="application/x-www-form-urlencoded"><input type="text" name="search"  size="20" /> <input type="submit" name="search" value="search" /></form>
	</div>
	<div class="lefthalf">
		<script type="text/javascript"><!--
			menuAlignRight = false;
		//--></script>
		<span><script type="text/javascript"><!--
 menuWriteAnchor("Quick Navigation") //--></script></span> | <a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a>
	</div>
</div>

<div id="content"><!-- contains the title and article -->
	<h1 class='pagetitle'><a href="http://wiki.beyondunreal.com/wiki?back=Karma Functions And Events">Karma Functions And Events</a></h1>
	<div class="wiki"><p>Below is a listing of the <a href="karma.html">Karma</a> related functions and events. There is a great number of them but most are not particularly useful except in rare circumstances. It is worth noting that these functions often distinguish between "rigid body" Karma objects and Karma ragdolls. A "rigid body" Karma object is essentially and Karma simulated actor that is set to PHYS_Karma, as opposed to PHYS_KarmaRagdoll.</p>
<dl><dt>native final function quat KGetRBQuaternion();</dt><dd>Returns a <a href="quaternion.html">quaternion</a> describing the rotation of a rigid body Karma simulated object.</dd><dt>native final function KGetRigidBodyState(out KRigidBodyState RBstate);</dt><dd>Gets the "state" of a Karma rigid body. This is used primarily for replication. The state includes such things as rotation, velocity, etc. and is used primarily for replication.</dd><dt>native final function KDrawRigidBodyState(KRigidBodyState RBState, bool AltColour);</dt><dd>A slow function. Draws stuff on the screen for debugging Karma rigid bodies. I would not recommend this even for debugging.</dd><dt>native final function vector KRBVecToVector(KRBVec RBvec);</dt><dd>Converts an RBVec to a regular vector. RBVects are more precise than regular vectors and are used primarily for replication.</dd><dt>native final function KRBVec KRBVecFromVector(vector v);</dt><dd>Converts a vector to an RBVec. This is used primarily for replication.</dd><dt>native final function KSetMass( float mass );</dt><dd>Sets the mass of a Karma simulated object. This sets the "KMass" of that object. The regular mass is unaffected.</dd><dt>native final function float KGetMass();</dt><dd>Returns the KMass of a Karma simulated object, in Karma units.</dd><dt>native final function KSetInertiaTensor( vector it1, vector it2 );</dt><dd>Sets the inertia tensor. Unfortunately I don't know what that is. <img alt=":P" src="emoticons/tongue.gif" align="middle"></dd><dt>native final function KGetInertiaTensor( out vector it1, out vector it2 );</dt><dd>Reads the inertia tensor and returns it in the two "out" arguments.</dd><dt>native final function KSetDampingProps( float lindamp, float angdamp );</dt><dd>Sets the linear and angular damping properties of a Karma simulated actor.</dd><dt>native final function KGetDampingProps( out float lindamp, out float angdamp );</dt><dd>Puts the current Linear and Angular damping properties into the two out arguments passed to this function.</dd><dt>native final function KSetFriction( float friction );</dt><dd>Sets the friction of a Karma simulated object. This applies only to surface to surface contact, and has no effect on the air resistance.</dd><dt>native final function float KGetFriction();</dt><dd>Returns the friction, in Karma units.</dd><dt>native final function KSetRestitution( float rest );</dt><dd>Sets the elasticity of this object for collisions. 1 is perfectly elastic, 0 is perfectly solid.</dd><dt>native final function float KGetRestitution();</dt><dd>Returns the elasticity of this object.</dd><dt>native final function KSetCOMOffset( vector offset );</dt><dd>Sets the center of mass of this object, relative to it's center.</dd><dt>native final function KGetCOMOffset( out vector offset );</dt><dd>Puts the center of mass of this object, relative to it's center, into the out argument supplied.</dd><dt>native final function KGetCOMPosition( out vector pos );</dt><dd>Similar to KGetCOMPosition, this sets the argument to the absolute location of the Center of mass, relative to the center of the world.</dd><dt>native final function KSetImpactThreshold( float thresh );</dt><dd>Sets the amount of momentum that must be imparted to this object in a single collision in order to trigger it's KImpact event.</dd><dt>native final function float KGetImpactThreshold();</dt><dd>Returns the amount of momentum that must be imparted to this object in a single collision in order to trigger it's KImpact event.</dd><dt>native final function KWake();</dt><dd>"Wakes up" the actor. This causes the Karma physics to begin simulating after the object has been deemed to be "at rest."</dd><dt>native final function bool KIsAwake();</dt><dd>Returns a boolean value stating whether this Karma simulated actor is simulating or not. It returns true if the object is currently simulating, and false if it is "at rest" and has stopped simulating.</dd><dt>native final function KAddImpulse( vector Impulse, vector Position, optional name BoneName );</dt><dd>Imparts an impulse to the Karma actor. Impulse is the amount of force to apply in Karma units. Position is the location that the impulse should be applied, relative to the center of the world. This does not need to actually be in contact with the Karma object. BoneName, if supplied, is the name of the bone that the impulse should be applied to. This only applies to objects with skeletal information.</dd><dt>native final function KSetStayUpright( bool stayUpright, bool allowRotate );</dt><dd>Sets the "stability" of the object. If StayUpright is set to true, the object will not roll or pitch, it will only yaw. If the second argument, AllowRotate, is set to false, the object will not be able to yaw. If it is set to true the object will yaw as normal. If StayUpright is false, AllowRotate will have no effect.</dd><dt>native final function KSetBlockKarma( bool newBlock );</dt><dd>Sets the bBlockKarma value of an actor.</dd><dt>native final function KSetActorGravScale( float ActorGravScale );</dt><dd>Sets the amount that gravity will be scaled by for this actor.</dd><dt>native final function float KGetActorGravScale();</dt><dd>Returns the amount that gravity will be scaled by for this actors simulation.</dd><dt>native final function KDisableCollision( actor Other );</dt><dd>This will selectively disable collision between this Karma object and another given Karma object. Regular collision is not negated, and collision with objects other than those specified is not altered. This function can be called repeatedly to disable collision with an arbitrary number of Karma objects. By default, collision is enabled with all Karma objects.</dd><dt>native final function KEnableCollision( actor Other );</dt><dd>This will selectively enable collision between this Karma object and another given Karma object. Regular collision is not affected, and collision with objects other than those specified is not altered. This function can be called repeatedly to enable collision with an arbitrary number of Karma objects. By default, collision is enabled with all Karma objects.</dd><dt>native final function KSetSkelVel( vector Velocity, optional vector AngVelocity, optional bool AddToCurrent );</dt><dd>Sets the linear, and optionally also an angular velocity for a Karma object with skeletal information attached. If AddToCurrent is true the velocity is added to the current velocity. If AddToCurrent is false, the current velocity is replaced with the one specified to this function.</dd><dt>native final function float KGetSkelMass();</dt><dd>Returns the mass, in Karma units, of a Karma object with skeletal information.</dd><dt>native final function KFreezeRagdoll();</dt><dd>Freezes a Karma ragdoll. This stops it from simulating immediately when this function is called. Note, however, that KIsAwake may not respond to this until the next tick.</dd><dt>native final function KAddBoneLifter( name BoneName, InterpCurve LiftVel, float LateralFriction, InterpCurve Softness );</dt><dd>Adds a "bone lifter." This is used on Karma ragdolls to make it look like a bone is being lifted. This is used on the de-res effect. The bone lifter acts independant of any other forces or velocities acting on the ragdoll. Note that if you do not set bBlockKarma to false before adding bone lifters, you may have erratic results.</dd><dt>native final function KRemoveLifterFromBone( name BoneName );</dt><dd>Removes a bone lifter from whatever bone you specify.</dd><dt>native final function KRemoveAllBoneLifters();</dt><dd>Removes all bone lifters on the actor which calls this function.</dd><dt>native final function KMakeRagdollAvailable();</dt><dd>Allocates a ragdoll. This is used just before creating a ragdoll and will purge the oldest ragdoll if there is not enough room in the ragdoll queue to create another one.</dd><dt>native final function bool KIsRagdollAvailable();</dt><dd>This function checks to see if the ragdoll queue is full. If it is not full, true is returned. If it is full, false is returned. Attempting to create a ragdoll when one is not availible can have unpredictable results. (SimError or simply failure to simulate.)</dd><dt>event KImpact(actor other, vector pos, vector impactVel, vector impactNorm);</dt><dd>This event is called when the momentum imparted to this object from a single collision exceeds the preset impact threshold, KImpactThreshold. This value is in the KarmaParams of the actor. Note that if you destroy an actor within KImpact, it will crash the engine. This appears to be due to the situation where KImpact is called after the list of potentially colliding actors is generated, and destroying something in that list leaves null pointers in said list.</dd></dl>
<p><em class="em2">Haral:</em> I've found that if you destroy an actor within KImpact, it will cause the game to crash.  I hear this is a known bug (usually referred to as KPerContactCB) but I figured I'd post the obvious hack:  Copy the relevant info of what you're going to do into class variables and then just check for the change in Tick() and destroy it there.  I think that Epic knows about this and it will probably be fixed when 2k4 comes out.</p>
<p><em class="em2">Foxpaw:</em> Indeed it does. I had the same problem a while ago, but apparently I only squirrelled it away on my developer journal and didn't post it here.</p>
<dl><dt>event KVelDropBelow();</dt><dd>This event is called whenever the velocity of the ragdoll drops below a certain threshold which you can set, KVelDropBelowThreshold. This value is in the KarmaParams of the actor.</dd><dt>event KSkelConvulse();</dt><dd>This event is called whenever a KarmaRagdoll Convulses. It is used to draw the lightning effect on the ragdoll but can be used for anything a regular event can be used for.</dd><dt>event KApplyForce(out vector Force, out vector Torque);</dt><dd>This is not an "event" so much, it is called every tick, right before the Karma physics are simulated on this object. It has two "out" variables which allow you to directly apply force and torque to the actor. These values are absolute and will set the value of the force and torque on that actor. Despite the name, the amounts specified are not applied in addition to the existing force and torque, they will overwrite those numbers.</dd><dt>event bool KUpdateState(out KRigidBodyState newState);</dt><dd>This event allows you to manually update the Rigid Body State for a Rigid Body Karma object. I wouldn't particularly recommend using this to set things on a Karma object - KApplyForce, KAddImpulse, etc. are capable of doing the same job with less complication. Regardless of what you set in the newState variable, no changes will take effect if you return false from this function. If you return true, the Karma objects "state" will be replaced with whatever you supplied for the newState argument.</dd></dl>
</div>
</div>

<div id="footer" class="bar">
	<p><form method="post" action="http://wiki.beyondunreal.com/wiki" enctype="application/x-www-form-urlencoded">
<a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a><br>
Last edited December 26, 2004 14:25 <a href="http://wiki.beyondunreal.com/wiki?action=browse&diff=1&id=Karma_Functions_And_Events">(diff)</a><br>Search: <input type="text" name="search"  size="20" /><input type="hidden" name="dosearch" value="1"  /><br><br><small><a href="http://wiki.beyondunreal.com/wiki/Karma_Functions_And_Events">Original page</a> &#150; copy created Sat, Jun 23, 2007</small><div></div>
</form>
	</p>
	<p>I love the smell of UnrealEd crashing in the morning. (tarquin)</p>
</div>
</div><!-- close of "scrolling" div -->

<div id="quickbar">
	<div id="logo"><a href="../index.html"><img src="shared/wikilogo.jpg" width="143" height="100" border="0"></a>
		</div>
	<div class="qbsitename">
		<p>The Unreal Engine Documentation Site</p>
	</div>
	<div class="qbsection">
<p><a href="metatopics.html">Wiki Community</a></p>
<p><a href="category-category.html">Topic Categories</a></p>


<p><a href="recent-changes.html">Recent Changes</a></p>
<p><a href="offline-wiki.html">Offline Wiki</a></p>
</div><div class="qbsection">
<p><a href="unreal-engine.html">Unreal Engine</a></p>
<p><a href="console-commands.html">Console Commands</a></p>
<p><a href="terminology.html">Terminology</a></p>
<p><a href="category-faq.html">FAQs</a></p>
<p><a href="help-desk.html">Help Desk</a></p>
</div><div class="qbsection">
<p><a href="topics-on-mapping.html">Mapping Topics</a></p>
<p><a href="mapping-lessons.html">Mapping Lessons</a></p>
<p><a href="unrealed-3.html">UnrealEd Interface</a></p>
</div><div class="qbsection">
<p><a href="unrealscript.html">UnrealScript Topics</a></p>
<p><a href="unrealscript-lessons.html">UnrealScript Lessons</a></p>
<p><a href="making-mods.html">Making Mods</a></p>
<p><a href="class-tree.html">Class Tree</a></p>
</div><div class="qbsection">
<p><a href="topics-on-modeling.html">Modeling Topics</a></p>
</div><div class="qbsection">
<p><a href="chongqing-page.html">Chongqing Page</a></p>
<p><a href="log-in.html">Log In</a></p></div>
</div>

</body></html>
