<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head lang="en">
	<title>UnrealWiki: AutoLoader/Example</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<link rel="stylesheet" type="text/css" media="screen, print"
		href="shared/stylebase.structural.css">	
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/template-default.css">
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/styles.chblue.css">
	<link rel="stylesheet" type="text/css" media="print"
		href="shared/template-default-print.css">
	<!--[if IE 6]>
			<style>
			/* dirty hack for IE6. */
			#quickbar {
				position: absolute;
				}
			</style>
	<![endif]-->
  <link rel="start" href="http://wiki.beyondunreal.com/">
  <link rel="glossary"  href="http://wiki.beyondunreal.com/wiki/Terminology">
  <link rel="help"  href="http://wiki.beyondunreal.com/wiki/Using_The_Wiki">
<script type="text/javascript" src="shared/dhtml.js"></script>
<script type="text/javascript" src="shared/dhtml-menu.js"></script>
<style type="text/css">#dhtml-menu    { background: #eee; padding: 5px 0px; margin-right: -20px; border: 1px solid #888; border-left: 1px solid #ccc; border-top: 1px solid #ccc;  border-right: 1px solid #888; border-bottom: 1px solid #888 }
#dhtml-menu td { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; padding: 1px 10px; cursor: default }
#dhtml-menu a  { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; text-decoration: none }
#dhtml-menu tt { font-family: monospace; font-size: 9pt }
#dhtml-menu-separator { height: 1px; background: red }
#dhtml-menu-anchor { cursor: default }
</style>
<script type="text/javascript" src="shared/expandable.js"></script>
</head>
<body onLoad="menuInit(); document.cookie='page=AutoLoader/Example; path=/'" class="default">
<div id="scrolling"><!-- contains all except the fixed sidebar -->
<div id="topbar"  class="bar">
	<div class="righthalf">
		<input type="text" name="search"  size="14" /> <input type="button" onclick="location.href='../search-error/index.html';" value="search" />
	</div>
	<div class="lefthalf">
		<script type="text/javascript"><!--
			menuAlignRight = false;
		//--></script>
		<span><script type="text/javascript"><!--
 menuWriteAnchor("Quick Navigation") //--></script></span> | <a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a>
	</div>
</div>

<div id="content"><!-- contains the title and article -->
	<h1 class='pagetitle'><a href="autoloader.html">AutoLoader</a>/<a href="http://wiki.beyondunreal.com/wiki?back=AutoLoader/Example">Example</a></h1>
	<div class="wiki"><p>This is an example based on the <a href="autoloader.html">AutoLoader</a> for ChatFilter</p>
<pre class="uscript"><span class="uscript-keyword">class</span> ChatFilterLoader <span class="uscript-keyword">extends</span> AutoLoader<span class="uscript-operator">;</span>

<span class="uscript-keyword">var</span> <span class="uscript-keyword">config</span> <span class="uscript-type">bool</span> bEnabled<span class="uscript-operator">;</span></pre><p>We use this variable to give the user the ability to enable or disable the server actor from within the WebAdmin. This is just a forward variable, you have to do the check enabled state during the init of your server actor.</p>
<pre class="uscript"><span class="uscript-keyword">event</span> PreBeginPlay<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">class</span><span class="uscript-name">'ChatFilter'</span><span class="uscript-operator">.</span><span class="uscript-keyword">default</span><span class="uscript-operator">.</span>bEnabled <span class="uscript-operator">=</span> bEnabled<span class="uscript-operator">;</span>
  <span class="uscript-keyword">Super</span><span class="uscript-operator">.</span>PreBeginPlay<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Here is where we set the real enabled flag of the server actor. Ofcourse this has effect on the next map.</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> IsActive<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">return</span> <span class="uscript-keyword">true</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>This loader is always active.</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> EnableLoader<span class="uscript-operator">(</span><span class="uscript-keyword">optional</span> <span class="uscript-type">string</span> SpecialActor<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">default</span><span class="uscript-operator">.</span>bEnabled <span class="uscript-operator">=</span> <span class="uscript-keyword">True</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">return</span> <span class="uscript-keyword">true</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">static</span> <span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> DisableLoader<span class="uscript-operator">(</span><span class="uscript-keyword">optional</span> <span class="uscript-type">string</span> SpecialActor<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">default</span><span class="uscript-operator">.</span>bEnabled <span class="uscript-operator">=</span> <span class="uscript-keyword">False</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">return</span> <span class="uscript-keyword">true</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>These are used to toggle the enable status of the server actor, if you don't use an enabled option like I did you can just ignore these. Always return true, unless something failed when setting the enabled status, for example when it requires an other server actor to be active too.</p>
<pre class="uscript"><span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> ApplyUpdate<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">return</span> <span class="uscript-keyword">default</span><span class="uscript-operator">.</span>bEnabled<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Since we always have to change things in the configuration for this ServerActor we always want to apply an update when it's active.</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">function</span> FillPlayInfo<span class="uscript-operator">(</span>PlayInfo PI<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">Super</span><span class="uscript-operator">.</span>FillPlayInfo<span class="uscript-operator">(</span>PI<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  PI<span class="uscript-operator">.</span>AddSetting<span class="uscript-operator">(</span><span class="uscript-string">"Server Actors"</span><span class="uscript-operator">,</span> <span class="uscript-string">"bEnabled"</span><span class="uscript-operator">,</span> <span class="uscript-string">"Chat Filter"</span><span class="uscript-operator">,</span> <span class="uscript-number">10</span><span class="uscript-operator">,</span> <span class="uscript-number">255</span><span class="uscript-operator">,</span> <span class="uscript-string">"Check"</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Add a setting to the default &rarr; server actors page on the WebAdmin to enable/disable this server actor.</p>
<pre class="uscript"><span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> ObjectNeedsUpdate<span class="uscript-operator">(</span>Object O<span class="uscript-operator">,</span> <span class="uscript-type">string</span> PropName<span class="uscript-operator">,</span> <span class="uscript-type">string</span> PropValue<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Caps<span class="uscript-operator">(</span>PropName<span class="uscript-operator">)</span> <span class="uscript-operator">==</span> <span class="uscript-string">"SERVERPACKAGES"</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span><span class="uscript-operator">!</span><span class="uscript-keyword">class</span><span class="uscript-name">'ChatFilter'</span><span class="uscript-operator">.</span><span class="uscript-keyword">default</span><span class="uscript-operator">.</span>bCheckNicknames <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">!</span><span class="uscript-keyword">class</span><span class="uscript-name">'ChatFilter'</span><span class="uscript-operator">.</span><span class="uscript-keyword">default</span><span class="uscript-operator">.</span>bFriendlyMessage <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">!</span><span class="uscript-keyword">Super</span><span class="uscript-operator">.</span>ObjectNeedsUpdate<span class="uscript-operator">(</span>O<span class="uscript-operator">,</span> PropName<span class="uscript-operator">,</span> PropValue<span class="uscript-operator">)</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      RemoveArrayEntry<span class="uscript-operator">(</span>O<span class="uscript-operator">,</span> PropName<span class="uscript-operator">,</span> PropValue<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">return</span> <span class="uscript-keyword">false</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">return</span> <span class="uscript-keyword">Super</span><span class="uscript-operator">.</span>ObjectNeedsUpdate<span class="uscript-operator">(</span>O<span class="uscript-operator">,</span> PropName<span class="uscript-operator">,</span> PropValue<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>ChatFilter requires a ServerPackage for some settings, here we check if it's required to change the value of the ServerPackages. </p>
<pre class="uscript"><span class="uscript-keyword">function</span> <span class="uscript-type">int</span> CheckArrayEntry<span class="uscript-operator">(</span><span class="uscript-type">string</span> PropName<span class="uscript-operator">,</span> <span class="uscript-keyword">array</span><span class="uscript-operator">&lt;</span><span class="uscript-type">string</span><span class="uscript-operator">&gt;</span> PropArray<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> i<span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Caps<span class="uscript-operator">(</span>PropName<span class="uscript-operator">)</span> <span class="uscript-operator">==</span> <span class="uscript-string">"SERVERPACKAGES"</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">for</span> <span class="uscript-operator">(</span>i <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span> i <span class="uscript-operator">&lt;</span> PropArray<span class="uscript-operator">.</span><span class="uscript-keyword">Length</span><span class="uscript-operator">;</span> i<span class="uscript-operator">++</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Caps<span class="uscript-operator">(</span>PropArray<span class="uscript-operator">[</span>i<span class="uscript-operator">]</span><span class="uscript-operator">)</span> <span class="uscript-operator">==</span> <span class="uscript-string">"\"CHATFILTERMSG\""</span><span class="uscript-operator">)</span>
      <span class="uscript-operator">{</span>
        <span class="uscript-keyword">return</span> i<span class="uscript-operator">;</span>
      <span class="uscript-operator">}</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Caps<span class="uscript-operator">(</span>PropArray<span class="uscript-operator">[</span>i<span class="uscript-operator">]</span><span class="uscript-operator">)</span> <span class="uscript-operator">==</span> <span class="uscript-string">"\"CHATFILTERMSG151\""</span><span class="uscript-operator">)</span>
      <span class="uscript-operator">{</span>
        <span class="uscript-keyword">return</span> i<span class="uscript-operator">;</span>
      <span class="uscript-operator">}</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Caps<span class="uscript-operator">(</span>PropArray<span class="uscript-operator">[</span>i<span class="uscript-operator">]</span><span class="uscript-operator">)</span> <span class="uscript-operator">==</span> <span class="uscript-string">"\"CHATFILTERMSG152\""</span><span class="uscript-operator">)</span>
      <span class="uscript-operator">{</span>
        <span class="uscript-keyword">return</span> i<span class="uscript-operator">;</span>
      <span class="uscript-operator">}</span>
    <span class="uscript-operator">}</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">return</span> <span class="uscript-operator">-</span><span class="uscript-number">1</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>ChatFilter had some updates to the server package a couple of time. Because we don't want the old serverpackages still in the list (because we don't need them anyway), we have to remove them. The above routine checks the server actors list for packages with our name (note the double quotes).</p>
<p>Return the index of the entry to want removed from the ini file. Or -1 if you don't want anything removed.</p>
<pre class="uscript"><span class="uscript-keyword">defaultproperties</span>
<span class="uscript-operator">{</span>
  bEnabled<span class="uscript-operator">=</span><span class="uscript-keyword">true</span>
  bIncludeServerActor<span class="uscript-operator">=</span><span class="uscript-keyword">True</span>
  ActorClass<span class="uscript-operator">=</span><span class="uscript-string">"ChatFilter.ChatFilter"</span>
  FriendlyName<span class="uscript-operator">=</span><span class="uscript-string">"ChatFilter"</span>
  ActorDescription<span class="uscript-operator">=</span><span class="uscript-string">"Filter chats on the server"</span>
  RequiredIniEntries<span class="uscript-operator">(</span><span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">=</span><span class="uscript-operator">(</span>ClassFrom<span class="uscript-operator">=</span><span class="uscript-string">"Engine.GameEngine"</span><span class="uscript-operator">,</span>PropName<span class="uscript-operator">=</span><span class="uscript-string">"ServerPackages"</span><span class="uscript-operator">,</span>PropValue<span class="uscript-operator">=</span><span class="uscript-string">"ChatFilterMsg154"</span><span class="uscript-operator">)</span>
<span class="uscript-operator">}</span></pre><p>This is the real magic of the AutoLoader, usualy you only have to use this part to write an AutoLoader.</p>
<dl><dt>bIncludeServerActor</dt><dd>setting this to true will add the ActorClass to the ServerActors list</dd><dt>ActorClass</dt><dd>the class name of the ServerActor that this AutoLoader is for</dd><dt>FriendlyName</dt><dd>the friendly name to be used</dd><dt>ActorDescription</dt><dd>an description for the ServerActor</dd><dt>RequiredIniEntries(0)</dt><dd>This is an dynamic array containing addition changes to the ini file. These entries will automatically be added/removed when the AutoLoader is enabled/disabled.</dd></dl>
<h2><a name="0.1"></a>.int file</h2>
<p>To make this all work you have to create a .int file with the following content</p>
<pre class="uscript"><span class="uscript-operator">[</span>Public<span class="uscript-operator">]</span>
Object<span class="uscript-operator">=</span><span class="uscript-operator">(</span><span class="uscript-keyword">Class</span><span class="uscript-operator">=</span><span class="uscript-keyword">Class</span><span class="uscript-operator">,</span>MetaClass<span class="uscript-operator">=</span>ConfigManager<span class="uscript-operator">.</span>AutoLoader<span class="uscript-operator">,</span><span class="uscript-type">Name</span><span class="uscript-operator">=</span>ChatFilterLoader<span class="uscript-operator">.</span>ChatFilterLoader<span class="uscript-operator">,</span>Description<span class="uscript-operator">=</span><span class="uscript-string">"Filter chats on the server"</span><span class="uscript-operator">)</span></pre><p>Now where the server restarts this new loader will be found.</p>
<script type="text/javascript"><!--
 menuItemAdd(".int file", "#0.1");
 menuWrite() //--></script></div>
</div>

<div id="footer" class="bar">
	<p>
<a href="../index.html">Home Page</a> | <a href="autoloader.html">AutoLoader</a> | <a href="recent-changes.html">Recent Changes</a><br>
Last edited June 5, 2003 6:12 <a href="http://wiki.beyondunreal.com/wiki?action=browse&diff=1&id=AutoLoader/Example">(diff)</a><br>Search: <input type="text" name="search"  size="14" /><input type="button" onclick="location.href='../search-error/index.html';" value="search" /><br><br><small><a href="http://wiki.beyondunreal.com/wiki/AutoLoader/Example">Original page</a> &#150; copy created Sat, Jun 23, 2007</small><div></div>

	</p>
	<p>I'm a doctor, not a mechanic
</p>
</div>
</div><!-- close of "scrolling" div -->

<div id="quickbar">
	<div id="logo"><a href="../index.html"><img src="shared/wikilogo.jpg" width="143" height="100" border="0"></a>
		</div>
	<div class="qbsitename">
		<p>The Unreal Engine Documentation Site</p>
	</div>
	<div class="qbsection">
<p><a href="metatopics.html">Wiki Community</a></p>
<p><a href="category-category.html">Topic Categories</a></p>


<p><a href="recent-changes.html">Recent Changes</a></p>
<p><a href="offline-wiki.html">Offline Wiki</a></p>
</div><div class="qbsection">
<p><a href="unreal-engine.html">Unreal Engine</a></p>
<p><a href="console-commands.html">Console Commands</a></p>
<p><a href="terminology.html">Terminology</a></p>
<p><a href="category-faq.html">FAQs</a></p>
<p><a href="help-desk.html">Help Desk</a></p>
</div><div class="qbsection">
<p><a href="topics-on-mapping.html">Mapping Topics</a></p>
<p><a href="mapping-lessons.html">Mapping Lessons</a></p>
<p><a href="unrealed-3.html">UnrealEd Interface</a></p>
</div><div class="qbsection">
<p><a href="unrealscript.html">UnrealScript Topics</a></p>
<p><a href="unrealscript-lessons.html">UnrealScript Lessons</a></p>
<p><a href="making-mods.html">Making Mods</a></p>
<p><a href="class-tree.html">Class Tree</a></p>
</div><div class="qbsection">
<p><a href="topics-on-modeling.html">Modeling Topics</a></p>
</div><div class="qbsection">
<p><a href="chongqing-page.html">Chongqing Page</a></p>
<p><a href="log-in.html">Log In</a></p></div>
</div>

</body></html>
