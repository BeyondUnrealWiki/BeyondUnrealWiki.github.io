<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head lang="en">
	<title>UnrealWiki: BruteForce/Interpreter</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<link rel="stylesheet" type="text/css" media="screen, print"
		href="shared/stylebase.structural.css">	
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/template-default.css">
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/styles.chblue.css">
	<link rel="stylesheet" type="text/css" media="print"
		href="shared/template-default-print.css">
	<!--[if IE 6]>
			<style>
			/* dirty hack for IE6. */
			#quickbar {
				position: absolute;
				}
			</style>
	<![endif]-->
  <link rel="start" href="http://wiki.beyondunreal.com/">
  <link rel="glossary"  href="http://wiki.beyondunreal.com/wiki/Terminology">
  <link rel="help"  href="http://wiki.beyondunreal.com/wiki/Using_The_Wiki">
<script type="text/javascript" src="shared/dhtml.js"></script>
<script type="text/javascript" src="shared/dhtml-menu.js"></script>
<style type="text/css">#dhtml-menu    { background: #eee; padding: 5px 0px; margin-right: -20px; border: 1px solid #888; border-left: 1px solid #ccc; border-top: 1px solid #ccc;  border-right: 1px solid #888; border-bottom: 1px solid #888 }
#dhtml-menu td { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; padding: 1px 10px; cursor: default }
#dhtml-menu a  { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; text-decoration: none }
#dhtml-menu tt { font-family: monospace; font-size: 9pt }
#dhtml-menu-separator { height: 1px; background: red }
#dhtml-menu-anchor { cursor: default }
</style>
<script type="text/javascript" src="shared/expandable.js"></script>
</head>
<body onLoad="menuInit(); document.cookie='page=BruteForce/Interpreter; path=/'" class="default">
<div id="scrolling"><!-- contains all except the fixed sidebar -->
<div id="topbar"  class="bar">
	<div class="righthalf">
		<input type="text" name="search"  size="14" /> <input type="button" onclick="location.href='../search-error/index.html';" value="search" />
	</div>
	<div class="lefthalf">
		<script type="text/javascript"><!--
			menuAlignRight = false;
		//--></script>
		<span><script type="text/javascript"><!--
 menuWriteAnchor("Quick Navigation") //--></script></span> | <a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a>
	</div>
</div>

<div id="content"><!-- contains the title and article -->
	<h1 class='pagetitle'><a href="bruteforce.html">BruteForce</a>/<a href="http://wiki.beyondunreal.com/wiki?back=BruteForce/Interpreter">Interpreter</a></h1>
	<div class="wiki"><pre class="uscript"><span class="uscript-keyword">class</span> Interpreter <span class="uscript-keyword">extends</span> Object <span class="uscript-keyword">dependsOn</span><span class="uscript-operator">(</span>AST<span class="uscript-operator">)</span> <span class="uscript-keyword">dependsOn</span><span class="uscript-operator">(</span>Scope<span class="uscript-operator">)</span> <span class="uscript-keyword">dependsOn</span><span class="uscript-operator">(</span>Compiler<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

<span class="uscript-keyword">var</span> <span class="uscript-keyword">private</span> AST a<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span> <span class="uscript-keyword">private</span> Scope s<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span> <span class="uscript-keyword">private</span> <span class="uscript-keyword">array</span><span class="uscript-operator">&lt;</span><span class="uscript-type">string</span><span class="uscript-operator">&gt;</span> <span class="uscript-keyword">input</span><span class="uscript-operator">;</span>

<span class="uscript-comment">// keywords</span>
<span class="uscript-keyword">const</span> __BEGIN                 <span class="uscript-operator">=</span> <span class="uscript-string">"begin"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __VAR                   <span class="uscript-operator">=</span> <span class="uscript-string">"var"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __INTEGER               <span class="uscript-operator">=</span> <span class="uscript-string">"int"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __STRING                <span class="uscript-operator">=</span> <span class="uscript-string">"string"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __FLOAT                 <span class="uscript-operator">=</span> <span class="uscript-string">"float"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __BOOLEAN               <span class="uscript-operator">=</span> <span class="uscript-string">"bool"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __FUNC                  <span class="uscript-operator">=</span> <span class="uscript-string">"function"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __BECOMES               <span class="uscript-operator">=</span> <span class="uscript-string">"="</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __WHILE                 <span class="uscript-operator">=</span> <span class="uscript-string">"while"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __IF                    <span class="uscript-operator">=</span> <span class="uscript-string">"if"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __LT                    <span class="uscript-operator">=</span> <span class="uscript-string">"&lt;"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __LE                    <span class="uscript-operator">=</span> <span class="uscript-string">"&lt;="</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __GT                    <span class="uscript-operator">=</span> <span class="uscript-string">"&gt;"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __GE                    <span class="uscript-operator">=</span> <span class="uscript-string">"&gt;="</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __EQ                    <span class="uscript-operator">=</span> <span class="uscript-string">"=="</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __NE                    <span class="uscript-operator">=</span> <span class="uscript-string">"!="</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __AND                   <span class="uscript-operator">=</span> <span class="uscript-string">"&amp;&amp;"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __OR                    <span class="uscript-operator">=</span> <span class="uscript-string">"||"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __PLUS                  <span class="uscript-operator">=</span> <span class="uscript-string">"+"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __MINUS                 <span class="uscript-operator">=</span> <span class="uscript-string">"-"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __MULTIPLY              <span class="uscript-operator">=</span> <span class="uscript-string">"*"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __DIVIDE                <span class="uscript-operator">=</span> <span class="uscript-string">"/"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __MOD                   <span class="uscript-operator">=</span> <span class="uscript-string">"%"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __NOT                   <span class="uscript-operator">=</span> <span class="uscript-string">"!"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __TRUE                  <span class="uscript-operator">=</span> <span class="uscript-string">"true"</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> __FALSE                 <span class="uscript-operator">=</span> <span class="uscript-string">"false"</span><span class="uscript-operator">;</span>
<span class="uscript-comment">// terminals -- end</span></pre><p>These are the keywords that we can encounter in the AST</p>
<pre class="uscript"><span class="uscript-keyword">const</span> FUNCRESULT              <span class="uscript-operator">=</span> <span class="uscript-string">"result"</span><span class="uscript-operator">;</span></pre><p>the name of the default local variable of function, the one that will contain the result.</p>
<pre class="uscript"><span class="uscript-keyword">function</span> Create<span class="uscript-operator">(</span>AST inAst<span class="uscript-operator">,</span> Scope inScope<span class="uscript-operator">,</span> <span class="uscript-keyword">array</span><span class="uscript-operator">&lt;</span><span class="uscript-type">string</span><span class="uscript-operator">&gt;</span> inInput<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  a <span class="uscript-operator">=</span> inAst<span class="uscript-operator">;</span>
  s <span class="uscript-operator">=</span> inScope<span class="uscript-operator">;</span>
  <span class="uscript-keyword">input</span> <span class="uscript-operator">=</span> inInput<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">function</span> Execute<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> i<span class="uscript-operator">;</span>
  <span class="uscript-keyword">for</span> <span class="uscript-operator">(</span>i <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span> i <span class="uscript-operator">&lt;</span> a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">.</span><span class="uscript-keyword">length</span><span class="uscript-operator">;</span> i<span class="uscript-operator">++</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>i<span class="uscript-operator">]</span><span class="uscript-operator">.</span>parent <span class="uscript-operator">==</span> <span class="uscript-operator">-</span><span class="uscript-number">1</span><span class="uscript-operator">)</span> ExecuteRoot<span class="uscript-operator">(</span>i<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
<span class="uscript-operator">}</span></pre><p>Execute will walk through all the tree nodes to search for the main root nodes, without a parent, and execute those.</p>
<pre class="uscript"><span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> ExecuteRoot<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> Scope<span class="uscript-operator">.</span>Declaration d<span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> NT_Keyword<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __VAR<span class="uscript-operator">)</span> _var<span class="uscript-operator">(</span>node<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __BECOMES<span class="uscript-operator">)</span> _assignment<span class="uscript-operator">(</span>node<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __IF<span class="uscript-operator">)</span> _ifthenelse<span class="uscript-operator">(</span>node<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __WHILE<span class="uscript-operator">)</span> _whiledo<span class="uscript-operator">(</span>node<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __FUNC<span class="uscript-operator">)</span> _function<span class="uscript-operator">(</span>node<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> NT_Function<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d <span class="uscript-operator">=</span> _functioncall<span class="uscript-operator">(</span>node<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
<span class="uscript-operator">}</span></pre><p>This will execute a root node. A root node can be a variable or function declaration, an assigment, if statement , while statement or a function call.</p>
<p>Each node type has it's own way of handling, but basically it's all the same. Each function will be called with the current AST node to use.</p>
<pre class="uscript"><span class="uscript-comment">/**
  returns the value of the nth child
*/</span>
<span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> <span class="uscript-type">string</span> ChildValue<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">,</span> <span class="uscript-keyword">optional</span> <span class="uscript-type">int</span> n<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">return</span> a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>children<span class="uscript-operator">[</span>n<span class="uscript-operator">]</span><span class="uscript-operator">]</span><span class="uscript-operator">.</span>value<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-comment">/**
  returns the id of the nth child
*/</span>
<span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> <span class="uscript-type">int</span> Child<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">,</span> <span class="uscript-keyword">optional</span> <span class="uscript-type">int</span> n<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">return</span> a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>children<span class="uscript-operator">[</span>n<span class="uscript-operator">]</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>These two function has as only purpose to keep the code below a bit more readable. Just imagine what a mess it would be if I repeated the above code in the rest of the class.</p>
<pre class="uscript"><span class="uscript-comment">/**
  converts BruteForce bool to UScript bool
*/</span>
<span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> boolean<span class="uscript-operator">(</span><span class="uscript-type">string</span> in<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">return</span> <span class="uscript-operator">!</span><span class="uscript-operator">(</span>in <span class="uscript-operator">~=</span> __FALSE<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-comment">/**
  uscript bool to BruteForce bool
*/</span>
<span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> <span class="uscript-type">string</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">bool</span> in<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>in<span class="uscript-operator">)</span> <span class="uscript-keyword">return</span> __TRUE<span class="uscript-operator">;</span>
  <span class="uscript-keyword">else</span> <span class="uscript-keyword">return</span> __FALSE<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>We can't use the built-in boolean type cast because out bools are <em class="em1">true</em> and <em class="em1">false</em> instead of <em class="em1">not 0</em> and <em class="em1">0</em>.</p>
<pre class="uscript"><span class="uscript-comment">/**
  Convert from one type to the other
*/</span>
<span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> Scope<span class="uscript-operator">.</span>Declaration typeCast<span class="uscript-operator">(</span>Scope<span class="uscript-operator">.</span>Declaration d<span class="uscript-operator">,</span> Scope<span class="uscript-operator">.</span>DeclarationType type<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> type<span class="uscript-operator">)</span> <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">else</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Int<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">else</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Float<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> DT_String<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value <span class="uscript-operator">!=</span> <span class="uscript-string">""</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">!=</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> DT_Float<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">!=</span> <span class="uscript-number">0.0</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">else</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Bool<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_String<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_String<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>This function makes type completeness possible, each type will be converted into an other type.</p>
<pre class="uscript"><span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> _var<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">,</span> <span class="uscript-keyword">optional</span> <span class="uscript-type">string</span> initval<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
                   <span class="uscript-comment">// name                                 value</span>
  s<span class="uscript-operator">.</span>newDeclaration<span class="uscript-operator">(</span>ChildValue<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> s<span class="uscript-operator">.</span>stringToType<span class="uscript-operator">(</span>ChildValue<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> initval<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Declare a new variable in the current scope. The optional initval is used during the passing of the function arguments.</p>
<pre class="uscript"><span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> _assignment<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>                  <span class="uscript-comment">// name              expression            left hand type</span>
  s<span class="uscript-operator">.</span>setDeclaration<span class="uscript-operator">(</span>ChildValue<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> typeCast<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> s<span class="uscript-operator">.</span>getType<span class="uscript-operator">(</span>ChildValue<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">.</span>value <span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> _ifthenelse<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>boolean<span class="uscript-operator">(</span>typeCast<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> DT_Bool<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-comment">//if true</span>
  <span class="uscript-operator">{</span>
    _codeblock<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span> <span class="uscript-comment">// then</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>children<span class="uscript-operator">.</span><span class="uscript-keyword">length</span> <span class="uscript-operator">&gt;=</span> <span class="uscript-number">3</span><span class="uscript-operator">)</span> <span class="uscript-comment">// else</span>
  <span class="uscript-operator">{</span>
    _codeblock<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
<span class="uscript-operator">}</span></pre><p>Check if the first child node evaluates to <em class="em1">true</em>, and if so execute the second child node which is the <em class="em1">then</em> statement. If not check if there's a third child (the optional <em class="em1">else</em> part), and execute it.</p>
<pre class="uscript"><span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> _whiledo<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">while</span> <span class="uscript-operator">(</span>boolean<span class="uscript-operator">(</span>typeCast<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> DT_Bool<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-comment">//while true</span>
  <span class="uscript-operator">{</span>
    _codeblock<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span> <span class="uscript-comment">// do</span>
  <span class="uscript-operator">}</span>  
<span class="uscript-operator">}</span>

<span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> _codeblock<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> i<span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> NT_Keyword<span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __BEGIN<span class="uscript-operator">)</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">for</span> <span class="uscript-operator">(</span>i <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span> i <span class="uscript-operator">&lt;</span> a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>children<span class="uscript-operator">.</span><span class="uscript-keyword">length</span><span class="uscript-operator">;</span> i<span class="uscript-operator">++</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      ExecuteRoot<span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>children<span class="uscript-operator">[</span>i<span class="uscript-operator">]</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span> <span class="uscript-operator">{</span>
    ExecuteRoot<span class="uscript-operator">(</span>node<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
<span class="uscript-operator">}</span></pre><p>If the current node is a <em class="em1">begin</em> root node we will execute all it's children, if not it's just a single statement and we execute that one.</p>
<p>Note that I just call the ExecuteRoot function, this means that there is a possibility for inline variable and function declaration even tho the language specification doesn't allow it the interpreter accepts it.</p>
<pre class="uscript"><span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> Scope<span class="uscript-operator">.</span>Declaration _expr<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">,</span> <span class="uscript-keyword">optional</span> Scope<span class="uscript-operator">.</span>DeclarationType type<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">return</span> _boolex<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> Scope<span class="uscript-operator">.</span>Declaration _boolex<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">,</span> <span class="uscript-keyword">optional</span> Scope<span class="uscript-operator">.</span>DeclarationType type<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> Scope<span class="uscript-operator">.</span>Declaration d<span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> NT_Keyword<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __LT<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d <span class="uscript-operator">=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      type <span class="uscript-operator">=</span> d<span class="uscript-operator">.</span>type<span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">&lt;</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Float<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">&lt;</span> <span class="uscript-type">Float</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">&lt;</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_String<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value <span class="uscript-operator">&lt;</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Bool<span class="uscript-operator">;</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __LE<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d <span class="uscript-operator">=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      type <span class="uscript-operator">=</span> d<span class="uscript-operator">.</span>type<span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">&lt;=</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Float<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">&lt;=</span> <span class="uscript-type">Float</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">&lt;=</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_String<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value <span class="uscript-operator">&lt;=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Bool<span class="uscript-operator">;</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __GT<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d <span class="uscript-operator">=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      type <span class="uscript-operator">=</span> d<span class="uscript-operator">.</span>type<span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">&gt;</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Float<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">&gt;</span> <span class="uscript-type">Float</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">&gt;</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_String<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value <span class="uscript-operator">&gt;</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Bool<span class="uscript-operator">;</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __GE<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d <span class="uscript-operator">=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      type <span class="uscript-operator">=</span> d<span class="uscript-operator">.</span>type<span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">&gt;=</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Float<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">&gt;=</span> <span class="uscript-type">Float</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">&gt;=</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_String<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value <span class="uscript-operator">&gt;=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Bool<span class="uscript-operator">;</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __EQ<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d <span class="uscript-operator">=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      type <span class="uscript-operator">=</span> d<span class="uscript-operator">.</span>type<span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">==</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Float<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">==</span> <span class="uscript-type">Float</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">==</span> Boolean<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_String<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Bool<span class="uscript-operator">;</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __NE<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d <span class="uscript-operator">=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      type <span class="uscript-operator">=</span> d<span class="uscript-operator">.</span>type<span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">!=</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Float<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">!=</span> <span class="uscript-type">Float</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">!=</span> Boolean<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_String<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value <span class="uscript-operator">!=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Bool<span class="uscript-operator">;</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __AND<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d <span class="uscript-operator">=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span> Boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> Boolean<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Bool<span class="uscript-operator">;</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __OR<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d <span class="uscript-operator">=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> boolToString<span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">||</span> Boolean<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Bool<span class="uscript-operator">;</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">return</span> _accum<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Right hand side will be type casted to the left hand side, that's why we temporarily save the result of the left hand side so that we can pass the type to the right hand side.</p>
<pre class="uscript"><span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> Scope<span class="uscript-operator">.</span>Declaration _accum<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">,</span> <span class="uscript-keyword">optional</span> Scope<span class="uscript-operator">.</span>DeclarationType type<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> Scope<span class="uscript-operator">.</span>Declaration d<span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> NT_Keyword<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __PLUS<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d <span class="uscript-operator">=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      type <span class="uscript-operator">=</span> d<span class="uscript-operator">.</span>type<span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">+</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Float<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">+</span> <span class="uscript-type">Float</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">!</span>Boolean<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_String<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">$</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">;</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __MINUS<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d <span class="uscript-operator">=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      type <span class="uscript-operator">=</span> d<span class="uscript-operator">.</span>type<span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">-</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Float<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">-</span> <span class="uscript-type">Float</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">!</span>Boolean<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_String<span class="uscript-operator">)</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">;</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">return</span> _mult<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> Scope<span class="uscript-operator">.</span>Declaration _mult<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">,</span> <span class="uscript-keyword">optional</span> Scope<span class="uscript-operator">.</span>DeclarationType type<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> Scope<span class="uscript-operator">.</span>Declaration d<span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> NT_Keyword<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __MULTIPLY<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d <span class="uscript-operator">=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      type <span class="uscript-operator">=</span> d<span class="uscript-operator">.</span>type<span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">*</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Float<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">*</span> <span class="uscript-type">Float</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">||</span> Boolean<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span> 
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_String<span class="uscript-operator">)</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span> <span class="uscript-comment">// ??</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __DIVIDE<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d <span class="uscript-operator">=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      type <span class="uscript-operator">=</span> d<span class="uscript-operator">.</span>type<span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span>  <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Float<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-type">Float</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span>Boolean<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">||</span> <span class="uscript-operator">!</span>Boolean<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span> 
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_String<span class="uscript-operator">)</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span> <span class="uscript-comment">//?</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __MOD<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d <span class="uscript-operator">=</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      type <span class="uscript-operator">=</span> d<span class="uscript-operator">.</span>type<span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Int<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span>  <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">%</span> <span class="uscript-type">Int</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Float<span class="uscript-operator">)</span> d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-type">Float</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span> <span class="uscript-operator">%</span> <span class="uscript-type">Float</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_Bool<span class="uscript-operator">)</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span> <span class="uscript-comment">// ??</span>
      <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>type <span class="uscript-operator">==</span> DT_String<span class="uscript-operator">)</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span> <span class="uscript-comment">//?</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">return</span> _preop<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> Scope<span class="uscript-operator">.</span>Declaration _preop<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">,</span> <span class="uscript-keyword">optional</span> Scope<span class="uscript-operator">.</span>DeclarationType type<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> Scope<span class="uscript-operator">.</span>Declaration d<span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> NT_Keyword<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">==</span> __NOT<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
      d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Bool<span class="uscript-operator">;</span>
      d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> BoolToString<span class="uscript-operator">(</span><span class="uscript-operator">!</span>Boolean<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> DT_Bool<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
      <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">return</span> _operand<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> Scope<span class="uscript-operator">.</span>Declaration _operand<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">,</span> <span class="uscript-keyword">optional</span> Scope<span class="uscript-operator">.</span>DeclarationType type<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> Scope<span class="uscript-operator">.</span>Declaration d<span class="uscript-operator">;</span>
  d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value<span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> NT_Identifier<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d <span class="uscript-operator">=</span> s<span class="uscript-operator">.</span>getDeclaration<span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> NT_String<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_String<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> NT_Boolean<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Bool<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> NT_Integer<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Int<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> NT_Float<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Float<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>type <span class="uscript-operator">==</span> NT_Function<span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d <span class="uscript-operator">=</span> _functioncall<span class="uscript-operator">(</span>node<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span> <span class="uscript-operator">{</span>
    Warn<span class="uscript-operator">(</span><span class="uscript-string">"Unexpected node:"</span><span class="uscript-operator">@</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">Assert</span><span class="uscript-operator">(</span><span class="uscript-keyword">false</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>type <span class="uscript-operator">!=</span> DT_None<span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>type <span class="uscript-operator">!=</span> type<span class="uscript-operator">)</span><span class="uscript-operator">)</span> d <span class="uscript-operator">=</span> typeCast<span class="uscript-operator">(</span>d<span class="uscript-operator">,</span> type<span class="uscript-operator">)</span><span class="uscript-operator">;</span> <span class="uscript-comment">// from to</span>
  <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> Scope<span class="uscript-operator">.</span>Declaration _functioncall<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> Scope<span class="uscript-operator">.</span>Declaration d<span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">~=</span> <span class="uscript-string">"print"</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d <span class="uscript-operator">=</span> typeCast<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> DT_String<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    log<span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">~=</span> <span class="uscript-string">"argc"</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_Int<span class="uscript-operator">;</span>
    d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-type">String</span><span class="uscript-operator">(</span><span class="uscript-keyword">input</span><span class="uscript-operator">.</span><span class="uscript-keyword">length</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">~=</span> <span class="uscript-string">"argv"</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d<span class="uscript-operator">.</span>type <span class="uscript-operator">=</span> DT_String<span class="uscript-operator">;</span>
    d<span class="uscript-operator">.</span>value <span class="uscript-operator">=</span> <span class="uscript-keyword">input</span><span class="uscript-operator">[</span><span class="uscript-type">Int</span><span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> DT_Int<span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">]</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">~=</span> <span class="uscript-string">"int"</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d <span class="uscript-operator">=</span> typeCast<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> DT_Int<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">~=</span> <span class="uscript-string">"float"</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d <span class="uscript-operator">=</span> typeCast<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> DT_Float<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">~=</span> <span class="uscript-string">"string"</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d <span class="uscript-operator">=</span> typeCast<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> DT_String<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value <span class="uscript-operator">~=</span> <span class="uscript-string">"bool"</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    d <span class="uscript-operator">=</span> typeCast<span class="uscript-operator">(</span>_expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> DT_Bool<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span> <span class="uscript-operator">{</span>
    d <span class="uscript-operator">=</span> s<span class="uscript-operator">.</span>getDeclaration<span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value<span class="uscript-operator">,</span> DT_Function<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    d <span class="uscript-operator">=</span> _execfunction<span class="uscript-operator">(</span><span class="uscript-type">int</span><span class="uscript-operator">(</span>d<span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">,</span> node<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  Warn<span class="uscript-operator">(</span><span class="uscript-string">"Undeclared function:"</span><span class="uscript-operator">@</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>node<span class="uscript-operator">]</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">Assert</span><span class="uscript-operator">(</span><span class="uscript-keyword">false</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>First check if the function call is a built-in function, otherwise look if there's a custom function defined. If so, execute that node.</p>
<pre class="uscript"><span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> _function<span class="uscript-operator">(</span><span class="uscript-type">int</span> node<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-comment">//               function name        </span>
  s<span class="uscript-operator">.</span>newDeclaration<span class="uscript-operator">(</span>ChildValue<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">,</span> DT_Function<span class="uscript-operator">,</span> <span class="uscript-type">string</span><span class="uscript-operator">(</span>node<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>A function declaration, just take the first node and skip the rest. We only need to read the rest when the function is executed.</p>
<pre class="uscript"><span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> Scope<span class="uscript-operator">.</span>Declaration _execfunction<span class="uscript-operator">(</span><span class="uscript-type">int</span> func<span class="uscript-operator">,</span> <span class="uscript-type">int</span> node<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> Scope<span class="uscript-operator">.</span>Declaration d<span class="uscript-operator">;</span>
  <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> i<span class="uscript-operator">,</span> j<span class="uscript-operator">;</span>
  s<span class="uscript-operator">.</span>openScope<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>                      
  s<span class="uscript-operator">.</span>newDeclaration<span class="uscript-operator">(</span>FUNCRESULT<span class="uscript-operator">,</span> s<span class="uscript-operator">.</span>stringToType<span class="uscript-operator">(</span>ChildValue<span class="uscript-operator">(</span>func<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span> <span class="uscript-comment">// return type</span>
  j <span class="uscript-operator">=</span> Child<span class="uscript-operator">(</span>func<span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">for</span> <span class="uscript-operator">(</span>i <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span> i <span class="uscript-operator">&lt;</span> a<span class="uscript-operator">.</span>tree<span class="uscript-operator">[</span>j<span class="uscript-operator">]</span><span class="uscript-operator">.</span>children<span class="uscript-operator">.</span><span class="uscript-keyword">length</span><span class="uscript-operator">;</span> i<span class="uscript-operator">++</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    _var<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>j<span class="uscript-operator">,</span> i<span class="uscript-operator">)</span><span class="uscript-operator">,</span> _expr<span class="uscript-operator">(</span>Child<span class="uscript-operator">(</span>node<span class="uscript-operator">,</span> i<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">.</span>value<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  <span class="uscript-keyword">for</span> <span class="uscript-operator">(</span>i <span class="uscript-operator">=</span> <span class="uscript-number">2</span><span class="uscript-operator">;</span> i <span class="uscript-operator">&lt;</span> a<span class="uscript-operator">.</span>tree<span class="uscript-operator">[</span>func<span class="uscript-operator">]</span><span class="uscript-operator">.</span>children<span class="uscript-operator">.</span><span class="uscript-keyword">length</span><span class="uscript-operator">;</span> i<span class="uscript-operator">++</span><span class="uscript-operator">)</span> <span class="uscript-comment">// 0 = return type, 1 = function name</span>
  <span class="uscript-operator">{</span>
    ExecuteRoot<span class="uscript-operator">(</span>a<span class="uscript-operator">.</span>Tree<span class="uscript-operator">[</span>func<span class="uscript-operator">]</span><span class="uscript-operator">.</span>children<span class="uscript-operator">[</span>i<span class="uscript-operator">]</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>
  d <span class="uscript-operator">=</span> s<span class="uscript-operator">.</span>getDeclaration<span class="uscript-operator">(</span>FUNCRESULT<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  s<span class="uscript-operator">.</span>closeScope<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">return</span> d<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Jump to the node where the function is declared. We need node of the function call because we need to input arguments. We only read the number of argument that are defined. So it's possible to enter more arguments in a function call than required, we just ignore them.</p>
<p>Each function argument is a local variable with an initial value, which would be the result of the expression passed to it.</p>
<p>When we enter the function we will first open a new scope level, this is to distinguish local and global variables. A local and global variable may have the same name, but the most local variable is just.</p>
</div>
</div>

<div id="footer" class="bar">
	<p>
<a href="../index.html">Home Page</a> | <a href="bruteforce.html">BruteForce</a> | <a href="recent-changes.html">Recent Changes</a><br>
Last edited April 24, 2003 11:40 <a href="http://wiki.beyondunreal.com/wiki?action=browse&diff=1&id=BruteForce/Interpreter">(diff)</a><br>Search: <input type="text" name="search"  size="14" /><input type="button" onclick="location.href='../search-error/index.html';" value="search" /><br><br><small><a href="http://wiki.beyondunreal.com/wiki/BruteForce/Interpreter">Original page</a> &#150; copy created Sat, Jun 23, 2007</small><div></div>

	</p>
	<p>Mostly Harmless
</p>
</div>
</div><!-- close of "scrolling" div -->

<div id="quickbar">
	<div id="logo"><a href="../index.html"><img src="shared/wikilogo.jpg" width="143" height="100" border="0"></a>
		</div>
	<div class="qbsitename">
		<p>The Unreal Engine Documentation Site</p>
	</div>
	<div class="qbsection">
<p><a href="metatopics.html">Wiki Community</a></p>
<p><a href="category-category.html">Topic Categories</a></p>


<p><a href="recent-changes.html">Recent Changes</a></p>
<p><a href="offline-wiki.html">Offline Wiki</a></p>
</div><div class="qbsection">
<p><a href="unreal-engine.html">Unreal Engine</a></p>
<p><a href="console-commands.html">Console Commands</a></p>
<p><a href="terminology.html">Terminology</a></p>
<p><a href="category-faq.html">FAQs</a></p>
<p><a href="help-desk.html">Help Desk</a></p>
</div><div class="qbsection">
<p><a href="topics-on-mapping.html">Mapping Topics</a></p>
<p><a href="mapping-lessons.html">Mapping Lessons</a></p>
<p><a href="unrealed-3.html">UnrealEd Interface</a></p>
</div><div class="qbsection">
<p><a href="unrealscript.html">UnrealScript Topics</a></p>
<p><a href="unrealscript-lessons.html">UnrealScript Lessons</a></p>
<p><a href="making-mods.html">Making Mods</a></p>
<p><a href="class-tree.html">Class Tree</a></p>
</div><div class="qbsection">
<p><a href="topics-on-modeling.html">Modeling Topics</a></p>
</div><div class="qbsection">
<p><a href="chongqing-page.html">Chongqing Page</a></p>
<p><a href="log-in.html">Log In</a></p></div>
</div>

</body></html>
