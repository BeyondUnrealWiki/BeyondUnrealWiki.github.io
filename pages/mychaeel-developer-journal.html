<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head lang="en">
	<title>UnrealWiki: Mychaeel/Developer Journal</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<link rel="stylesheet" type="text/css" media="screen, print"
		href="shared/stylebase.structural.css">	
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/template-default.css">
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/styles.chblue.css">
	<link rel="stylesheet" type="text/css" media="print"
		href="shared/template-default-print.css">
	<!--[if IE 6]>
			<style>
			/* dirty hack for IE6. */
			#quickbar {
				position: absolute;
				}
			</style>
	<![endif]-->
  <link rel="start" href="http://wiki.beyondunreal.com/">
  <link rel="glossary"  href="http://wiki.beyondunreal.com/wiki/Terminology">
  <link rel="help"  href="http://wiki.beyondunreal.com/wiki/Using_The_Wiki">
<script type="text/javascript" src="shared/dhtml.js"></script>
<script type="text/javascript" src="shared/dhtml-menu.js"></script>
<style type="text/css">#dhtml-menu    { background: #eee; padding: 5px 0px; margin-right: -20px; border: 1px solid #888; border-left: 1px solid #ccc; border-top: 1px solid #ccc;  border-right: 1px solid #888; border-bottom: 1px solid #888 }
#dhtml-menu td { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; padding: 1px 10px; cursor: default }
#dhtml-menu a  { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; text-decoration: none }
#dhtml-menu tt { font-family: monospace; font-size: 9pt }
#dhtml-menu-separator { height: 1px; background: red }
#dhtml-menu-anchor { cursor: default }
</style>
<script type="text/javascript" src="shared/expandable.js"></script>
</head>
<body onLoad="menuInit(); document.cookie='page=Mychaeel/Developer_Journal; path=/'" class="default">
<div id="scrolling"><!-- contains all except the fixed sidebar -->
<div id="topbar"  class="bar">
	<div class="righthalf">
		<form class="inline" method="post" action="/wiki" enctype="application/x-www-form-urlencoded"><input type="text" name="search"  size="20" /> <input type="submit" name="search" value="search" /></form>
	</div>
	<div class="lefthalf">
		<script type="text/javascript"><!--
			menuAlignRight = false;
		//--></script>
		<span><script type="text/javascript"><!--
 menuWriteAnchor("Quick Navigation") //--></script></span> | <a href="(start).html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a> | <a href="http://wiki.beyondunreal.com/wiki?action=editprefs">Preferences</a>
	</div>
</div>

<div id="content"><!-- contains the title and article -->
	<h1 class='pagetitle'><a href="mychaeel.html">Mychaeel</a>/<a href="http://wiki.beyondunreal.com/wiki?back=Mychaeel/Developer+Journal">Developer Journal</a></h1>
	<div class="wiki"><blockquote><p><em class="em1">Don't edit my journal entries, but feel free to add comments.</em></p>
</blockquote><h2><a name="0.1"></a>December 14, 2002</h2>
<blockquote><p>Read over your compositions, and wherever you meet with a passage which you think is particularly fine, strike it out.</p>
<p class="indent1"><em class="em1"><span class="interwiki"><img 
      alt="Wikipedia logo"
      title="Wikipedia"
      src="shared//InterWiki-Wikipedia.png">&nbsp;<a href="http://www.wikipedia.com/wiki/Samuel Johnson">Samuel Johnson</a></span></em></p>
</blockquote><p>No effort is wasted if you've learned something from it.  (Though that doesn't mean that the same time couldn't have been spent more effectively.)</p>
<p>Occasionally I'm stuck in a dead end of my own design and can't seem to find my way out of it.  The way in there is plastered with a few truly elegant thoughts and implementations that I don't want to tread on.  So I linger a bit longer and cudgel my brains for some <em class="em1">other</em> way to reach my goal than backing up.</p>
<p>Deleting an evening's worth of good code requires an effort, but if it relieves me of a week's worth of trying not to scratch it, it's worth it.</p>
<h3><a name="0.1.1"></a>Comments</h3>
<p><em class="em2">Tarquin:</em>  "The way in there is plastered with a few truly elegant thoughts and implementations that I don't want to tread on. " &ndash; I do that all the time in mapping. I end up with multiple copies of the same area, each one trying a different solution...  What usually happens is I eventually work up the courage to start from scratch.</p>
<p><em class="em2">Mychaeel:</em> That's exactly what happens to me too.  <img alt=":-)" src="emoticons/smile.gif" align="middle">  Realizing when it's better to scratch a few good ideas in favor of an entirely different approach (maybe even one with a slightly different outcome than what I originally figured) is a learning process.</p>
<h2><a name="0.2"></a>December 20, 2002</h2>
<p>Note to self:  Not assuming that other people's contributions to a testing environment are free of bugs can be a huge time saver.</p>
<h2><a name="0.3"></a>January 17, 2003</h2>
<p>Incidentally I dug out the code I scratched in the first entry on this page and used it for a related, but different purpose where it actually fits in.  (Good thing I never really delete something for good unless I'm <em class="em1">absolutely</em> sure it won't ever be of any use anymore.)</p>
<p>The code is part of Jailbreak's bot support and is supposed to let bots make an educated guess where an enemy player is currently located after the enemy gave his position away by triggering a release switch.  Naturally, if there's only a single relase switch, all that boils down to a single possible location.  Where it gets interesting is if there are <em class="em1">multiple</em> release switches and the bots actually have to <em class="em1">guess</em> which one the player triggered.</p>
<p>My code does that based on the last known location of a player (directly after a round starts, or after a spawn in freedom after winning an arena match, or after being released from jail), the walking distance (using the path network) to all of the release switches and the time that passed since the player's location was known last.  With that and a more or less arbitrarily chosen probability distribution for a player's distance from his starting point after a given amount of time (something based on half a Gaussian) bots take a random guess weighed by the respective probability of the enemy being at any of the possible switches.</p>
<h2><a name="0.4"></a>January 18, 2003</h2>
<p>Wrote about <a href="a-bugs-life.html">A Bug's Life</a> hoping that it'll inspire our bug hunters to posting better bug reports than they occasionally did for Jailbreak III.</p>
<h2><a name="0.5"></a>January 23, 2003</h2>
<p>UT2003's speech menu redefines the terms "non-extensible" and "hard-coded."  I'm sure there's a way into it though &ndash; I just haven't worked it out yet.  (Subclassing ExtendedConsole<a href="http://wiki.beyondunreal.com/wiki?action=edit&id=ExtendedConsole&referrerid=Mychaeel/Developer_Journal">?</a> is, hardly surprising, not an option.)</p>
<h2><a name="0.6"></a>January 24, 2003</h2>
<div class="floatimages"><table border=0 cellspacing=0 cellpadding=0 width="100%"><tr valign=top><td class="floatimages-left" align=left width=1><div><img alt="[speechmenuhack-ordermenu]" src="images/speechmenuhack-ordermenu.jpeg"></div>
</td>
<td class="floatimages-text" width="100%"><p>Apparently there <em class="em1">is</em> a way.  The "Team tactics" menu item here opens a submenu where you can select one of a set of tactics for your team.  (All other menu items open a list of players you can order.)</p>
<p>Getting it to display your own entries is the easy part, to be sure &ndash; being notified when the player selects one of the entries requires some more code insight.  It is possible though, and I'm just about to implement it.</p>
<p>If this works out, I'll describe the hack in detail somewhere on the Wiki.</p>
</td>
</tr>
</table>
</div>
<h2><a name="0.7"></a>January 25, 2003</h2>
<div class="floatimages"><table border=0 cellspacing=0 cellpadding=0 width="100%"><tr valign=top><td class="floatimages-text" width="100%"><p>It works.  When you select one of the entries in the tactics menu displayed to the right, SetOrders in <a href="teamai.html">TeamAI</a> is notified and gets a chance to intercept the selection.  The default implementation of SetOrders puts the following message into the log:</p>
<pre class="paraverbatim">  ScriptLog: Team New orders TacticsNormal JB-IronMan.xPlayer0</pre><p>TacticsNormal is a label I assigned to that menu item; everything else in that message is from Epic's own code.  Any unwanted cosmetic side effects can be controlled by overwriting SetOrders with your own code.</p>
<p>There's relatively little code involved in the whole hack:  One piece of code that's executed in some actor's client-side Tick (I used Tick in our HudBTeamDeathMatch<a href="http://wiki.beyondunreal.com/wiki?action=edit&id=HudBTeamDeathMatch&referrerid=Mychaeel/Developer_Journal">?</a> subclass, but it could be anywhere) that modifies the speech menu's behavior; and a piece of code that modifies some properties of <a href="bot.html">Bot</a>s when they're spawned.  And, of course, the code in SetOrders in <a href="teamai.html">TeamAI</a> that does whatever you want your custom menu item to do.</p>
<p>Modifying the speech menu that way has its limitations, of course.  There are only very few "slots" left for custom notifications (exactly nine), and custom submenus like my "Team Tactics" menu are only possible for menu items in the "Orders" submenu.  Details to follow.</p>
</td>
<td class="floatimages-right" align=right width=1><div><img alt="[speechmenuhack-tacticsmenu]" src="images/speechmenuhack-tacticsmenu.jpeg"></div>
</td>
</tr>
</table>
</div>
<h2><a name="0.8"></a>February 3, 2003</h2>
<p>So little time, and so much to do... but I don't regret spending the last weekend skiing in Tyrol.  <img alt=";-)" src="emoticons/wink.gif" align="middle"></p>
<p><a href="umake.html">UMake</a> should be updated and released in version 1.2.  <a href="spectate-bots.html">Spectate Botmatch</a> has a host of new functionality to be implemented, despite Epic refitting a "Spectate" button in the Instant Action dialog with the last patch.  Deathball needs some small code tweaks on my part.  <a href="jailbreak.html">Jailbreak</a> development must continue.  And in addition to that there's some Perl coding work I'll actually get paid for and whose deadline is approaching sometime in mid-February.</p>
<h2><a name="0.9"></a>February 10, 2003</h2>
<p>If you want to make <em class="em1">absolutely sure</em> that a certain thread in a forum remains undiscovered, stick it to the top and place the words "Read this before posting" in its subject.</p>
<h2><a name="0.10"></a>February 14, 2003</h2>
<p>Bots in jail (in Jailbreak) should idly walk around, occasionally lie down and sleep, and engage in hammer fights if there's an eligible opponent.</p>
<p>It seems to me that maybe the best way to achieve all this is creating several custom <a href="scriptedsequence.html">ScriptedSequence</a> subclasses, one for "walking around" (to select roam destinations in jail only), one for "lying down and sleeping" and one for "engage in jail fight (and stop when the opponent opts out)".  The latter two will probably require custom scripted <em class="em1">actions</em> too:  "start sleeping," "wait and occasionally snore" and "stand up"; and whatever is required to make a bot attack an opponent with an arbitrary melee or non-melee weapon.</p>
<p>Sounds like I'll better release alpha 4 <em class="em1">before</em> tackling that...</p>
<h2><a name="0.11"></a>February 15, 2003</h2>
<p>UT2003 bots don't really support being animated by means of a <a href="scriptedsequence.html">ScriptedSequence</a> &ndash; even if you manage to make them play a certain animation, the <a href="xpawn.html">xPawn</a> reverts to an idling pose as soon as that animation has ended.  In addition, those idling animations are natively "physics controlled."</p>
<p>What's possible though is temporarily resetting the <em class="em1">names</em> of the idling animations to refer to non-existent animations.  That's a pretty heavy-handed approach, but it works (and puts a bunch of warning messages into the log).</p>
<p><em class="em2">Update:</em>  ZappyAd pointed me to the bPhysicsAnimUpdate flag in class <a href="pawn.html">Pawn</a>.  Setting it to False disables the native "physics-controlled" animations, and indeed, it works well.</p>
<h2><a name="0.12"></a>February 17, 2003</h2>
<p>Scratched sleeping bots.  Implemented bots that hammer-fight in jail with human players instead.  Much more fun and rewarding.</p>
<h2><a name="0.13"></a>February 24, 2003</h2>
<p>I figured out the hard way that even custom game types can't simply replace the game's <a href="teaminfo.html">TeamInfo</a> actors by subclassing xTeamRoster<a href="http://wiki.beyondunreal.com/wiki?action=edit&id=XTeamRoster&referrerid=Mychaeel/Developer_Journal">?</a>.  One of our bug hunters reported that setting up a game with custom bots broke crucial parts of the gameplay, and a look into the log revealed that UT2003 didn't use Jailbreak's custom TeamInfo subclass as configured in the the game type's DefaultEnemyRosterClass variable but instances of TeamBlueConfigured<a href="http://wiki.beyondunreal.com/wiki?action=edit&id=TeamBlueConfigured&referrerid=Mychaeel/Developer_Journal">?</a> and TeamRedConfigured<a href="http://wiki.beyondunreal.com/wiki?action=edit&id=TeamRedConfigured&referrerid=Mychaeel/Developer_Journal">?</a> instead.</p>
<p>So, once more, I'm ending up <em class="em1">attaching</em> an actor of mine to a stock UT2003 actor instead of replacing the stock actor's class by my own.  Jailbreak did so with several other gameplay-relevant classes (not just TeamInfo) before already &ndash; PlayerReplicationInfo, for one, instead of introducing a custom PlayerReplicationInfo subclass.</p>
<p>In Unreal Tournament "attaching" an actor to another actor was more or less limited to the possibility of setting the attached actor's owner to the actor it was attached to and then using the ChildActors iterator to retrieve the attached actor when requested.  (Or any variant of that, though those that come into my mind are all equally inefficient.)</p>
<p>In UT2003 however every actor can have its own inventory by means of the Inventory variable which is declared in class <a href="actor.html">Actor</a>.  Traveling an actor's inventory chain is fast and efficient compared to using an iterator, so I implemented a generic abstract superclass for info actors that are "attached" to another actor, including code that automatically sets up a linked list of all "actor tag" actors of the same class and a mechanism that, if so desired, communicates registration and unregistration of an "actor tag" to all clients even during its lifetime.</p>
<p>Well, anyway, the TeamInfo problem was quickly fixed thanks to that mechanism.</p>
<h3><a name="0.13.1"></a>Comments</h3>
<p><em class="em2">Wormbo:</em> Actually the inventory chain was available to all actors in Unreal v205 already. (Yes, I really have that code here... <img alt=":D" src="emoticons/biggrin.gif" align="middle">)</p>
<p><em class="em2">Mychaeel:</em> Hmm.  I don't, but I do have the Unreal Tournament sources and... behold, you're right.  Oh well.  <img alt=":-)" src="emoticons/smile.gif" align="middle"></p>
<h2><a name="0.14"></a>March 17, 2003</h2>
<p>When I was implementing a new feature yesterday I noticed that I had to change a remotely related part of the code in order to avoid some small lag in a visual effect &ndash; no big deal, but something that deserved to be fixed.  So I opened the class responsible for the delay, found the place where I had not anticipated the need for some direct connection between two pieces of code in my original design, and added it.</p>
<p>Then I realized that this was the third or fourth time I had added a bit of code at that place to accommodate a new requirement that had popped up since I had initially designed that class.  Each time I had addressed a small particular problem, each time I had added a bit of code to fix it; and while each of those changes were small and simple, the whole code grew more complicated and less elegant with every change I applied to it.</p>
<p>Time to scratch that part of the code and rethink its design with all old <em class="em1">and</em> new requirements in mind.</p>
<p>Changing, fixing and tweaking code a small part at a time inevitably leads to bloated, unelegant, bug-prone constructions sooner or later.  That's commonly called <a href="http://info.astrian.net/jargon/terms/f/feature_creep.html">[feature creep]</a> &ndash; and after a time any software suffering from it becomes so unmaintainable that adding, testing and debugging a new feature becomes almost as much work as rewriting everything from scratch.  It's a developer's nightmare.</p>
<p>So sometimes it really pays off to start redesigning parts of a program before feature creep sets in.  The difficult part is to realize that before it's too late; and even more so for people not directly involved in the development process who can't relate to the idea of elegant, straightforward and bug-resistant program design.  Coding for a mod whose development is being slowly ground to a halt by somebody in charge adding more and more features that were never part of the original design can be a pretty frustrating experience.</p>
<h2><a name="0.15"></a>May 4, 2003</h2>
<p>ElapsedTime and RemainingTime in <a href="gamereplicationinfo.html">GameReplicationInfo</a> aren't replicated all the time in <a href="unreal-tournament.html">UT</a> and <a href="unreal-tournament-2003.html">UT2003</a> &ndash; that's for saving bandwidth, I suppose, and that must be a good thing.</p>
<p>Bad thing is that it doesn't work too well.  The idea is that ElapsedTime and RemainingTime are replicated <em class="em1">once</em> when the whole GameReplicationInfo actor is initially replicated to the client, and then the client increases ElapsedTime and decreases RemainingTime once per second all by itself.  Sounds simple enough, but somehow the initial value replication doesn't seem to work &ndash; and that's not just in Jailbreak, it's exactly the same in vanilla Deathmatch.  Consequently, the time display in the scoreboard is out of sync with the actual game time.</p>
<p>The programmer who thought that up at Digital Extremes or Epic must have anticipated some of those problems though, because it actually gets a bit more complicated than what I described above.  In addition to ElapsedTime and RemainingTime there's a variable called RemainingMinute that is replicated every time it is changed.  The Timer event in <a href="deathmatch.html">DeathMatch</a> sets it to the current value of RemainingTime every full minute.  GameReplicationInfo in turn picks it up and copies the replicated value of RemainingMinute to the client's local RemainingTime, thus re-syncronizing RemainingTime with the game's actual time.</p>
<p>Since I'd like Jailbreak's spiffy game time clock in the scoreboard to show the right time at <em class="em1">all</em> times though I guess I'll have to look for a fix.</p>
<p><em class="em2">Update:</em>  Two distinct problems there:  Firstly, the initially replicated value of RemainingMinute always resets RemainingTime to the last full minute on mid-game connect; secondly, there can be an almost arbitrary delay for precaching textures and other content between PostNetBeginPlay (when the values for ElapsedTime and RemainingTime have just been replicated) and the first call of Timer (where they're updated client-side).</p>
<h2><a name="0.16"></a>May 7, 2003</h2>
<p>...so in Jailbreak the client sends a replicated function call to the server which directly responds by sending another replicated function call back to the client along with the current server time.  The client calculates a time offset between itself and the server; and if it also takes the time into account it took the response function to be called on the client after the synchronization request had been issued, it's possible to synchronize client and server time to a precision of approximately a tenth of a second.</p>
<p>That happens once a client has finished loading and precaching the game.  <a href="gamereplicationinfo.html">GameReplicationInfo</a> only replicates the server time the match started, and determines ElapsedTime and RemainingTime based on the current client time and its offset to the server time.</p>
<h3><a name="0.16.1"></a>Comments</h3>
<p><em class="em2">Kuhal:</em> I am interested in the replication behaviour you have discovered here.  It may lead to an explanation of some behaviour I am getting during a pause in a network game.  The client's countdown clock rapidly counts down the seconds that have passed while the match was paused.  While I am certain the remaining time on the server has indeed been paused, it seems that the client thinks it knows better and catches up.  The weird thing is that the game ends "on time" when the client ramaining time reaches 00:00.  Are there any more references to how these attributes work in UT?</p>
<h2><a name="0.17"></a>May 22, 2003</h2>
<p>"All you can eat" for 5 ? in the uni's cafeteria today.  Burp.</p>
<p>Jailbreak's <a href="http://www.planetjailbreak.com/misc/jailbreak2003-scores-5.jpg?link">[scoreboard]</a> displays a minimap showing the current locations of your teammates.  In network games that means that those positions have to be replicated to all clients.  That leads to jerky movement of the dots on the minimap because the locations are updated only every couple of frames, not every (client-side) frame.</p>
<p>That problem can be somewhat relieved by using the <a href="pawn.html">Pawn</a>s' actual positions when they happen to be present on the respective client; but the other player positions still jerk.  Some sort of motion prediction or motion interpolation should be built in; and preferably in a way that does not multiply the bandwidth requirements of the whole separate location replication business &ndash; my bandwidth conscience is striking already without that.  That rules out simply replicating the player's velocity along with their position.</p>
<p>Since the minimap is by design mini, the updates usually don't go beyond a movement of a couple of pixels each time; and it's more to show the players' rough current whereabouts anyway, not their precise locations.  Maybe an algorithm that "learns" about the frequency of the position updates and interpolates between the <em class="em1">last two</em> replicated known points (and beyond if the next update isn't received in time) might yield smooth and reasonably accurate results.</p>
<p>Unrelated to that I also wonder whether I should keep up the splines connecting the player names to their location dots on the minimap.  I'm starting to think that simply attaching a small tag with the player's name and possibly a health bar would be nicer.</p>
<h2><a name="0.18"></a>May 24, 2003</h2>
<p>The principle works, but the movement is still jerky.  Motion prediction doesn't work well because the time that passes between a replicated variable being set on server-side and its new value being received client-side varies wildly:  So even when the player is moving in a straight line at a constant velocity, the client-side predicted location has to be corrected with every update.</p>
<p>Now I'm pursuing a different idea &ndash; adding the received location updates to a client-side list and trying to have the client interpolate along that list of locations, choosing its velocity independently as to keep up with the succession of new locations that are added to the list.</p>
<p>When the client-side interpolated location information reaches the last known location in the list and the player is not known to have stopped moving server-side, it extrapolates the player's movement using the last known direction and velocity.  That can even be used to save bandwidth:  The server only sends another update when it expects the client-side extrapolation to have deviated from the player's actual location too much.</p>
<h2><a name="0.19"></a>May 25, 2003</h2>
<p>To my mild surprise what I've implemented now works much better than I had dared to hope.</p>
<p>The server sends occasional location updates to all clients; and in addition to that, the absolute value of the player's movement velocity.  The <em class="em1">direction</em> of the player's movement is derived from the succession of location updates; as described in the previous entry it's impractical to derive the velocity as well from the location updates because time differences can't be relied upon when network replication is concerned.</p>
<p>Using the absolute value of the player's velocity instead of the velocity vector itself saves some bandwidth &ndash; two thirds in the size of the replicated data item alone (vector consists of three floats, its absolute value of only one), and it's also much less likely to change (the absolute value remains the same even when the player changes his movement direction or strafes).</p>
<p>Still, with every location update there's bound to be a small deviation between the client-side extrapolated location and the updated absolute location sent by the server.  Client-side, that deviation is simply smoothed out on a short time scale &ndash; that way the client-side motion simulation never suffers of any jerking motions, only small variations in movement speed which are virtually impossible to notice.</p>
<p>What I haven't implemented yet is the aforementioned optimization of location updates when a player keeps moving on a straight line for a while, thus making the client-side linear extrapolation sufficiently accurate even for longer periods between updates.  No actual player does that in a firefight, of course; but it's not all that unlikely to happen in general, especially given that without that optimization location updates would be sent with a frequency of about five times per second.</p>
<p><em class="em2">Update:</em>  Reducing the number of location updates that way works fine as well.  When moving on a straight line several seconds may pass between two location updates while the client-side minimap location indicator still accurately shows the moving player's constantly changing location, smoothly picking up a later change in the player's movement direction.</p>
<h2><a name="0.20"></a>May 26, 2003</h2>
<p>Would it still be fun if there weren't always more problems awaiting a solution?</p>
<p>When reading my code again I realized that it wasn't at all robust against server-side updates that never reached a particular client.  While the mechanism doesn't rely on the time between two received updates anymore, it still assumes that the client gets to see every update the server sends &ndash; and that may not necessarily be the case.  If the client misses one update, the client's idea of the player's movement direction will be completely off, especially since the server already sends only the minimum amount of updates that can be used to derive the direction.</p>
<p>So I have to make sure that the engine itself takes care that all clients always have a consistent set of information &ndash; the engine must know that if a client misses one or several updates it is necessary to send the last <em class="em1">two</em> location updates to that client next time.  The easiest way to achieve that is by having two replicated location variables that are alternatingly set to the player's most current location &ndash; the other one then contains the location one step earlier.</p>
<p>However, the problem isn't completely solved already by that.  Since those two variables (a two-element array, actually) are set alternatingly server-side (so that on each step only one of the values changes and has to be replicated), the client has no way to know which of the two replicated locations is the most current one &ndash; and so it can only derive the axis on which the player is moving, but not whether the player is moving "forward" or "backward" on that axis.  The client needs one bit of extra information to resolve that ambiguity.</p>
<p>It's not as trivial as it may sound to derive a consistent notion of "forward" or "backward" for any given non-zero vector.  Simply trying to define "forward" and "backward" in respect to a certain fixed direction is ambiguous as soon as a vector is lying in the plane perpendicular to the chosen direction; so that won't work (or rather, it will, but only in <em class="em1">almost</em> all cases, which is unfortunately not enough &ndash; Murphy knows).  So, the method I've chosen to define "forward" and "backward" takes the signum of the first vector component (X, Y, or Z, in that order) that is not zero &ndash; that's guaranteed to be non-zero for any non-zero vector, and the resultant value changes its own sign when the vector does.</p>
<p>To sum it up, the client now has <em class="em1">two</em> replicated location values without knowing which one is the most current one; so it calculates the vector difference between those two and applies the notion of "forward" or "backward" on it (described above), checks it against the separately replicated bit of information sent by the server and changes the vector's sign if necessary.  And Bob's your uncle.  (See what Terry Pratchett does to one's vocabulary?)</p>
<p>But... wouldn't it have been much easier and just as effective if I had simply replicated an extra bit of information telling the client which of the two locations is the most current one, instead of laboriously introducing weird notions of "forward" and "backward" vectors? &ndash; Easier it would be but not as effective.  That bit would have to be changed every single time the server does an update even if the player only made a slight correction in his movement direction; the method I've chosen only changes that bit when the player's movement direction changes from "forward" to "backward" (in the special absolute sense described above), so it only <em class="em1">occasionally</em> requires a change instead of <em class="em1">always</em>.</p>
<p><em class="em2">Addendum:</em>  I actually have it implemented by replicating that extra bit of orientation information as <em class="em1">the velocity's signum</em> &ndash; in an attempt to save bandwidth when both velocity and orientation change at the same time (and it also wouldn't take any more bandwidth when the velocity alone changes).  Upon writing about it here it suddenly occurred to me that this maybe wasn't all that smart after all &ndash; if <em class="em1">only</em> the orientation changes but the velocity doesn't, the engine still has to replicate an entire float value even though only a single bit changed.  Would it be more efficient to go the straightforward way and use a separately replicated bool variable?  I'll keep a close eye on which updates actually need to be sent by the server in a real-game situation and decide then...</p>
<p>(And that's also why writing in this "developer journal" is worth the effort even if nobody's actually reading it &ndash; it makes me critically review what I've coded.  It's a one-person code audit, so to speak.)</p>
<h2><a name="0.21"></a>May 30, 2003</h2>
<p>So, at last, the scoreboard is feature-complete.  Phew.  I dread writing the log for the CVS commit and getting JDN up to date... but the sooner I start, the sooner I'll be finished.</p>
<p>Showing the Jailbreak scoreboard has a noticeable impact on framerate at the moment &ndash; I haven't been able to spot a certain, single part of the code that's responsible for the majority of the framerate hit.  Disabling certain scoreboard elements one at the time shows that the clock takes as much performance as the dotted splines do, and the code that updates the scoreboard's state with the game's live information isn't far behind.  The performance hit seems to be evenly spread over most the code.</p>
<p>Especially something like the clock could benefit from some sort of graphics cache &ndash; it changes only once per second, but has to be rendered every frame.  If I could draw the clock on a <a href="scriptedtexture.html">ScriptedTexture</a> and then on the screen, and update the ScriptedTexture only once per second, that might save several milliseconds per frame... given that I'd manage to get alpha transparency to work on a ScriptedTexture; I wouldn't like the clock to be displayed on a rectangular black background, not even for performance's sake.</p>
<p>Maybe there is a way to use alpha transparency on a ScriptedTexture.  During my experiments around drawing a map screenshot on a ScriptedTexture for the scoreboard minimap I noticed that the ScriptedTexture's DrawPortal function did, somehow, alter the ScriptedTexture's alpha plane &ndash; it seems that wherever DrawPortal renders a normal solid texture, the ScriptedTexture will be completely transparent, but where an alpha-masked texture is drawn on the ScriptedTexture by DrawPortal the ScriptedTexture adopts its alpha mask there.  It's all pretty strange.</p>
<p>I also remember that in Unreal Tournament a ScriptedTexture could have a "background texture" that was used to initialize the ScriptedTexture canvas every frame.  I haven't found a corresponding property in UT2003's ScriptedTexture class, but maybe it's reusing an inherited property for that purpose &ndash; FallbackMaterial maybe?  Gotta try that when I'm home.</p>
<h2><a name="0.22"></a>May 31, 2003</h2>
<p>I've finally decided that the manual implementation docs I had put on JDN have outlived their purpose &ndash; they originally were the detailed specifications for the code before UT2003 was released, but after the classes were actually created there's little point in still keeping the specs around and manually up-to-date.</p>
<p>I tried <a href="uncodex.html">UnCodeX</a>'s HTML export, and while it works fine, it's information overflow.  I think people interested in Jailbreak 2003 implementation details do better with syntax-highlighted source code alone &ndash; I tried to document it well after all.</p>
<p>The Wiki script running JDN now supports an extra parameter for the <code>&lt;uscript&gt;</code> tag that directly takes the sources from the CVS repository and renders them on the page.  It looks pretty neat and saves me lots of time keeping the specs consistent with the code.  Maybe I'll later add a DHTML feature for "collapsing" function bodys to keep only the comment headers visible by default.</p>
<p><em class="em2">Update:</em>  Oh, and FallbackMaterial as a <a href="scriptedtexture.html">ScriptedTexture</a>'s background texture does not work.  Guess I'm out of luck.</p>
<h2><a name="0.23"></a>June 4, 2003</h2>
<p>I want to keep players from using their translocator to get out of jail the easy way, and I don't want them to be able to telefrag Bonus Pack monsters.</p>
<p>Unreal Tournament had a handy AllowTranslocation query function in <a href="deathmatchplus.html">DeathMatchPlus</a> for that.  Whenever anybody, player or bot, tried to translocate, this function was called and had the opportunity to prevent the translocation attempt.</p>
<p>Unfortunately, there's nothing like that left in UT2003.  The only thing that remains is a function in <a href="squadai.html">SquadAI</a> that's queried for whether a bot will try to translocate.  The code that prevents players from telefragging teammates is buried in the Translocate function in class TransRecall<a href="http://wiki.beyondunreal.com/wiki?action=edit&id=TransRecall&referrerid=Mychaeel/Developer_Journal">?</a> &ndash; it's basically a hard-coded check whether two players' collision cylinders impinge.</p>
<p>The only <em class="em1">possible</em> way into this code is via the SameTeamAs function (class <a href="controller.html">Controller</a>) used there that in turn calls IsOnTeam (class <a href="gameinfo.html">GameInfo</a>).  The game could pretend that monsters are on the same team as any player trying to telefrag them, but SameTeamAs is used by other parts of the game code as well, which makes (ab)using it to prevent monster telefrags not straightforward.</p>
<p>And it still leaves me with the question how to prevent players from translocating out of jail...</p>
<p><em class="em2">Update:</em>  I've ended up with removing the translocator from jailed players' inventories.  It's not all that messy after all.</p>
<h3><a name="0.23.1"></a>Comments</h3>
<p><em class="em2">ZxAnPhOrIaN:</em> Maybe make an actor or volume that kills the translocator beakon when you try to teleport out, killing the person.</p>
<p><em class="em2">ZedSquared</em> (from a UT classic point of view, dunno if any of this is feasable in 2003) Have a spawnnotify that catches transloctargets and modifies their velocity to kick them back to the owner (or the middle of jail) if they're in the jail zone perhaps ... or maybe subclass translocator, give the modified one as default inv, and override the fire function to not work in jail ... probably duff ideas, just thinking aloud late at night <img alt=":)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">Mychaeel:</em> I'd rather try not to replace the normal translocator to achieve the effect I'm looking for (plus, there's nothing like SpawnNotify in UT2003)... and I'd also like not to require mappers to put in special zones or volumes.  (Right now jails work with any volume or zone a mapper places &ndash; <a href="match-these-tags.html">attaching</a> them to a JBInfoJail actor makes them part of a jail.) &ndash; I could simply take a player's translocator away when he enters jail and give it back when he leaves jail, but that seems a bit messy.</p>
<p><em class="em2">Foxpaw:</em> I don't see the problem - can't you just disallow translocator use in jail like in Jailbreak for UT?</p>
<p><em class="em2">Wormbo:</em> That's exactly the problem, there is no AllowTranslocation function like in UT which allows the gametype to prevent translocation or add various other effects like flagdrop etc.</p>
<p><em class="em2">Foxpaw:</em> Well, in that case why not allow translocation in jail, and just have surfaces that make up the jail solid? That way the translocator beacon would not be able to be launched out of the prison so a player couldn't escape merely by translocating.</p>
<p><em class="em2">Mychaeel:</em> That would be a mapper-based solution, but the past (Jailbreak III) has shown that even in jails that were meant to be airtight (and must have been in editor terms since there a jail was defined by a distinct zone) occasionally had collision "gaps" in them that allowed players to shoot or, possibly, throw a translocator target outside (JB-Raid).  Even if a jail really is airtight it may be possible to place the translocator target so that translocating to it will place the player outside jail (JB-Antipody).  Besides, some jails are meant to have open windows to the outside or escape routes that players should be able to walk, but not translocate through.</p>
<h2><a name="0.24"></a>June 6, 2003</h2>
<p>The Jailbreak core to-do list has become pretty short.  Maybe, maybe, in a few weeks...</p>
<h2><a name="0.25"></a>June 8, 2003</h2>
<p>BeyondUnreal's forum breakdown will leave Jailbreak's development forums completely empty when they're back up.  Most of the hundreds of postings in there I'd have liked to keep mainly to keep a history of Jailbreak 2003 development; but some of them were ongoing discussions and long-term documentation.</p>
<p>Unrelated to that, early this afternoon my personal computer at home broke down as well; that leaves the CVS server and Jailbreak Developer Network offline too.  Fortunately the data itself wasn't lost; just my computer won't work.  If I'm lucky it's only either the power supply or the mainboard.  The bad thing is that tomorrow is a holiday here, so I'll need to stick with this notebook as a temporary measure till I have a chance to buy replacement parts.</p>
<h3><a name="0.25.1"></a>Comments</h3>
<p><em class="em2">Tarquin:</em> I'll do my best to remember what's been going on. [Jailbreak rescue]<a href="http://wiki.beyondunreal.com/wiki?action=edit&id=Jailbreak_Rescue&referrerid=Mychaeel/Developer_Journal">?</a></p>
<p><em class="em2">Mychaeel:</em> That's a great idea.</p>
<p><em class="em2">Tarquin:</em> Maybe I shouldn't put code dev topics on a public wiki though. I can just scribble a text file, or on the JDN</p>
<p><em class="em2">Mychaeel:</em> JDN is down along with my computer, I'm afraid.  Tahngarth has set up a temporary Core Dev forum at <a href="http://www.planetjailbreak.com/tempforum/">http://www.planetjailbreak.com/tempforum/</a> &ndash; register there and meet Tahngarth or me in chat to get access.</p>
<h2><a name="0.26"></a>June 9, 2003</h2>
<p>After finishing some Perl coding work (which I'm actually getting paid for) I'll see that my computer is restored to working order or that I at least find out which component exactly needs to be replaced.</p>
<p><em class="em2">Update:</em>  The computer boots up with an old PCI video card; but as soon as I replace it by a AGP video card (either my current GeForce 4400 Ti or an older GeForce 2 MX), I only get either a strange creaking sound from the PC speaker or nothing at all.  Only the fans work.</p>
<p>A friend of mine who's professionally dealing quite frequently with broken PCs suggests that it might be either the power supply that doesn't manage the AGP cards' load anymore, or the mainboard for some reason doesn't like AGP cards anymore.  Unfortunately I don't have a spare ATX power supply at hand, so I won't be able to test that theory until tomorrow at the earliest.</p>
<p>In case it's the mainboard I'll at least use the opportunity to upgrade my old Athlon 800 MHz to whatever it is you can currently still get in a regular computer hardware shop &ndash; apparently it's hard to find anything slower than 2.0 GHz nowadays.</p>
<h2><a name="0.27"></a>June 10, 2003</h2>
<p>My computer is up and working again.  I was surprised that for not more than about 180 ? I got a new processor (Athlon XP 2000+) along with a mainboard, silent cooler and memory (512 MB).  I could even keep my previous 235 W power supply.  By accident the processor is currently underclocked to 1.25 GHz (its normal clock rate would be 1.67 GHz) &ndash; I'm not even sure whether I can be bothered to open the case once more and set the jumpers correctly.</p>
<p>So far the system seems to be stable.  Time will tell.</p>
<h2><a name="0.28"></a>June 11, 2003</h2>
<p>Bots should simply try to avoid being killed when "evasive" team tactics are selected.  (Useful when a team has a narrow lead shortly before the time limit runs out.)</p>
<p>I got that to work reasonably well with relatively little effort, code-wise:  Set the bots' aggressiveness to a really low value to ensure they don't feel inclined to engage in fights; then overwrite PickRetreatDestination and make it react in a suitably cowardly manner if the bot is seeing an enemy.  Right now they simply pick the <a href="navigationpoint.html">NavigationPoint</a> among their current MoveTarget's <a href="reachspec.html">ReachSpec</a>s that's farthest away from the enemy, or the closest one that provides cover.  Effectively that makes bots run away from an approaching enemy and make turns in order to move out of the enemy's firing line.</p>
<p>While it's fun (for a while) to chase bots around in a test map, I've come across one or two situations where bots are effectively stuck and too easy a prey to approaching enemies.  First I'll have to have bots detect this; then I'll have to have them react to it suitably, for instance by either simply choosing another way out or by acting like a cornered beast and falling back to normal dogfighting tactics until they're either dead or the threat is gone.  (Tomorrow more &ndash; I'm tired.)</p>
<h2><a name="0.29"></a>June 13, 2003</h2>
<p>I found one reproducible situation in which bots are stuck in a tight loop of pathnodes they visit:  A bot sees an enemy, turns to flee, runs into cover; arrived there it wonders what to do next and decides to go on an inventory hunt, which leads it back into the enemy's sight &ndash; ad inf.</p>
<p>The bad thing is that bots (or rather the native function FindBestInventoryPath in <a href="controller.html">Controller</a>) are not smart enough to check whether they even have the chance to pick up the inventory when they've reached it &ndash; otherwise they wouldn't even try to reach it more than once in a row, and my problem would be a non-issue.</p>
<h2><a name="0.30"></a>June 14, 2003</h2>
<p>A comment in <a href="bot.html">Bot</a> hints that Epic meant to add a function called FindPathAwayFrom at some time &ndash; alas, they didn't yet.  That leaves me with either sticking to my simple escaping algorithm from above (and its flaws) or creating a path finding function myself, in UnrealScript.</p>
<p>I've started giving the latter a try.  The idea is to recursively search the path network for <a href="navigationpoint.html">NavigationPoint</a>s that provide cover from the enemy, starting at the bot's current MoveTarget.  Some first test runs seem to indicate that it works, and it seems to have negligible impact on the performance so far.  (The Clock/UnClock mechanism described on <a href="code-optimization.html">Code Optimization</a> proves pretty useful for such profiling.)</p>
<p><em class="em2">Update:</em>  If a bot doesn't find cover nearby and realizes that the enemy must have seen it (because it isn't looking the other way right now), the bot panics and reverts to normal attack mode until the enemy is dead or out of sight.  I've put all that into CheckSquadObjectives now, and it seems to work pretty well testing it with a single masterful bot.</p>
<h2><a name="0.31"></a>June 16, 2003</h2>
<p>Hmm.  Why on earth does the game rules tab maintain its settings in separate config variables instead of taking and storing them in the game type's own configuration?</p>
<h2><a name="0.32"></a>June 17, 2003</h2>
<p>Why does filling the mutator list box on the "Mutators" tab involve two other separate classes?  Why is reading a list of available mutators a native function?</p>
<h3><a name="0.32.1"></a>Comments</h3>
<p><em class="em2">Wormbo:</em> I guess it's supposed to speed up loading of mutator classes, but it's not really that much of a boost compared to the "old" GetNextInt(Desc) method because now the mutators' code packages have to be loaded in order to find the mutators' names, descriptions and groups.</p>
<p><em class="em2">Mychaeel:</em> I wonder whether that native function (GetMutatorList in xUtil<a href="http://wiki.beyondunreal.com/wiki?action=edit&id=XUtil&referrerid=Mychaeel/Developer_Journal">?</a>) does indeed load the mutator name to get the mutator name and description &ndash; a comment says it does <em class="em1">not</em> fill in the MutClass element of the MutatorRecord structure, which would make little sense if the class is loaded anyway.  (Unless GetMutatorList was internally "optimized" only to look up the class's default properties without loading the class; but I'd be a bit sceptical as to the wisdom of <em class="em1">that</em> optimization.  But maybe it has to do with cheat protection validating all loaded code...?  Gah.) &ndash; There's an UnrealScript function LoadClasses in xMutatorList<a href="http://wiki.beyondunreal.com/wiki?action=edit&id=XMutatorList&referrerid=Mychaeel/Developer_Journal">?</a> that would load the mutator classes, but it doesn't seem to be actually used.</p>
<p><em class="em2">Wormbo:</em> It's not the only questionable optimization. (Still remember "<code>// FIXME THIS SUCKS</code>"?) <a href="guicontroller.html">GUIController</a>.GetWeaponList also is a native function and it definately loads and returns weapon classes. I can't see any real optimization over Unreal's or UT's code here.</p>
<h2><a name="0.33"></a>June 18, 2003</h2>
<p>I'd like to intercept when somebody is clicking on a checkbox &ndash; not just the part with the check mark but its label.</p>
<p>It took a while until I figured out that the bAcceptsInput flag must be set to True for any of a <a href="guicomponent.html">GUIComponent</a>'s delegates to be called.  (Mmph.)</p>
<h2><a name="0.34"></a>June 23, 2003</h2>
<p>The OnDraw delegate is called for custom <a href="guipanel.html">GUIPanel</a> subclasses but not for direct subclasses of its parent class, <a href="guimulticomponent.html">GUIMultiComponent</a>.  Does that have a deeper sense or did just somebody forget to add a call to the delegate in <a href="guimulticomponent.html">GUIMultiComponent</a>'s native Draw implementation?</p>
<p><em class="em2">Update:</em>  Is it just me or does setting the TextFont property in <a href="guilabel.html">GUILabel</a> (and, thus, the LabelFont property in <a href="guimenuoption.html">GUIMenuOption</a>) have no effect at all?  (Obsoleted by the introduction of <a href="guistyles.html">GUIStyles</a> maybe?)  All labels in the game seem to have the same font, even those where Epic's own UnrealScript code decrees otherwise by setting TextFont.</p>
<h2><a name="0.35"></a>June 28, 2003</h2>
<p>This one has me baffled (in a <a href="webapplication.html">WebApplication</a> subclass):</p>
<pre class="uscript"><span class="uscript-keyword">function</span> QuerySomething<span class="uscript-operator">(</span>WebResponse WebResponse<span class="uscript-operator">)</span> <span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> <span class="uscript-type">string</span> ResultTemplate<span class="uscript-operator">;</span>
  ResultTemplate <span class="uscript-operator">=</span> <span class="uscript-string">"should be overwritten by the next statement"</span><span class="uscript-operator">;</span>
  ResultTemplate <span class="uscript-operator">=</span> WebResponse<span class="uscript-operator">.</span>LoadParsedUHTM<span class="uscript-operator">(</span><span class="uscript-string">"something.inc"</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span></pre><p>Now I'd expect ResultTemplate to contain the result of parsing the file something.inc... right?  And so it does, but <em class="em2">appended to the previous value of the variable.</em>  The resultant value of ResultTemplate is something like this:</p>
<pre class="paraverbatim">  should be overwritten by the next statementContents of something.inc</pre><p>Is that an engine bug?  Some arcane feature?  How can using LoadParsedUHTM on the right side of an assignment change the way the assignment operator works (given that the return value of LoadParsedUHTM is a mere string)?</p>
<p>However, the following workaround solves the problem:</p>
<pre class="uscript">  ResultTemplate <span class="uscript-operator">=</span> <span class="uscript-string">""</span> <span class="uscript-operator">$</span> WebResponse<span class="uscript-operator">.</span>LoadParsedUHTM<span class="uscript-operator">(</span><span class="uscript-string">"something.inc"</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span></pre><p>Trying to cast the right side to string in an attempt to do the same ironically yields a "No need to cast StrProperty to itself" compiler error.</p>
<h2><a name="0.36"></a>July 3, 2003</h2>
<p>Working on an HTML parser and formatter in UnrealScript again.  This time it'll be standalone and not part of <a href="screen.html">Screen</a>, even though I intend to use it for that end as well; and this time it's possible to use it on both <a href="scriptedtexture.html">ScriptedTexture</a>s and a regular <a href="canvas.html">Canvas</a>.</p>
<p>I hope I'll get around to implementing tables and floating images as well this time.  The base architecture I'm currently designing and coding takes the requirements for those features into account already, so it should be straightfoward to even follow W3C's specification of <a href="http://www.w3.org/TR/html401/struct/tables.html#h-11.2.4.4">[calculating the width of columns]</a> according to the standard.</p>
<h2><a name="0.37"></a>July 5, 2003</h2>
<p>The native Split and Divide functions turn out to be extremely handy for the kind of text parsing I'm doing at the moment.  (But I still want my native regular expression support in UnrealScript... mmph.)</p>
<h3><a name="0.37.1"></a>Comments</h3>
<p><em class="em2">El Muerte TDS:</em> Nah, regular expression suck for text parsing, they are only useful for match (and replace). Using a <a href="tokenizer.html">tokenizer</a> is much better for text parsing. It would be better if the native tokenizer was available in uscript.</p>
<p><em class="em2">Mychaeel:</em> I dare say that depends on how you'd use regular expressions.  The _nextToken function in your tokenizer could be formulated much more efficiently using regular expressions, for instance.  (Though I agree that the availability of regular expressions might lead some people to creating terribly inefficient parsers.)</p>
<p>For that matter, my prime concern about this HTML parser is its performance, so parsing through the input stream character by character in UnrealScript is something I'm determined to avoid.  (The first version of <a href="screen.html">Screen</a>'s ScreenSlidePage HTML parser did that, and it was slow as hell for anything exceeding <em class="em1">very</em> few kilobytes of input text.)</p>
<h2><a name="0.38"></a>July 6, 2003</h2>
<p>The HTML parser works like a charm since yesterday and nicely dumps the structure of a parsed HTML file, though I haven't made any performance evaluations yet; but in any case there's even some potential for optimization still (like identifying a tag's handler class by something faster than the sequential search I've settled for until the rest works, like binary search &ndash; did I mention that native hash support would be a great addition to UnrealScript too?).</p>
<h3><a name="0.38.1"></a>Comments</h3>
<p><em class="em2">El Muerte TDS:</em> There is a type called map, but it's only native atm (just like dynamic array used to be).</p>
<h2><a name="0.39"></a>July 9, 2003</h2>
<p>As usual it's not the <em class="em1">normal</em> case that makes implementing something a challenge; it's the <em class="em1">pathological</em> cases that do.</p>
<p>The obvious step after implementing an HTML parser is creating a formatter for the parsed HTML element tree.  The old one I made for <a href="screen.html">Screen</a> (one of my first UnrealScript projects altogether) has no concept of tables or floating boxes, but this time I'm determined to add support for those and so I have to deal with the conceptual odds and ends that come with it.</p>
<p>A floating box is actually a pretty straightforward concept:  It's a rectangle that's placed at the left or right edge of the containing box starting at the vertical position of the text line it's defined in.  That technique is most commonly used to have text flow around an image on a website.</p>
<p>Normally, a web designer adds floating elements at the very start of a paragraph so the boxes are placed already when the formatter starts wrapping lines between them.</p>
<p>The beginning of a paragraph is, however, not the only valid place for floating boxes:  They can just as well be defined in the middle of a line, and that's where the trouble starts.  As long as the current line is short enough to fit next to the box, everything is still fine; just add the floating box and shorten the line box accordingly.</p>
<p>But what if the floating box is too wide to fit next to the text line where it's defined in?  The HTML standards document says that the box is then to start directly <em class="em1">below</em> the line it is defined in; that's simple enough to implement... but subsequent text after the definition of the floating box is still to be added to the very same line <em class="em1">above</em> the box, and according to Murphy's law somebody is bound to have some item in that line after the floating box definition that increases its line height.  That means, basically, that the absolute position of the floating box may not be completely determined at the time it is added.  Consequently, it may be necessary to shift the box down <em class="em1">after</em> it has been rendered.</p>
<h2><a name="0.40"></a>July 14, 2003</h2>
<p>I just realized that I failed to enter <a href="umake.html">UMake</a> for the contest.  Ah well &ndash; it sorely needs an update anyway given the huge list of pending fixes and improvements, and there's a lot of time till the deadline of phase two.</p>
<p>It's a bit of a pity that <a href="meshmaker.html">MeshMaker</a> isn't eligible.  It might have had a chance to win something.</p>
<h3><a name="0.40.1"></a>Comments</h3>
<p><em class="em2">Haral:</em> FYI, the deadline for the contest is tomorrow.  You can still enter, I do think.</p>
<p><em class="em2">Mychaeel:</em> It is?  Well &ndash; hardly enough time to give it the overhaul it deserves unless I was <em class="em1">really</em> desperate to enter it in phase one, but since there are two more phases to go, I think I'll just target phase two for now.  But thanks for the correction.  <img alt=":-)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">Haral:</em> Those were my sentiments as well.  There's a lot of work to do on my mod, playable as it might be, before I'll feel it's ready for any sort of release.  Thanks for moving that comment btw, my brain doesn't exactly work well while I'm at work.  Anyway, time to get back at it, if I want to be ready by October.</p>
<h2><a name="0.41"></a>July 16, 2003</h2>
<p>Trying to read a binary file in UnrealScript.</p>
<p>The LoadParsedUHTM function in a freshly created <a href="webresponse.html">WebResponse</a> object does well enough for text files, but I ran against a fundamental problem of UnrealScript's string data type here:  Obviously it's not as high-level as it should be in a language like UnrealScript and doesn't handle embedded null bytes (<code>Chr(0)</code>) well.  A null byte terminates a string for all UnrealScript-related intents and purposes; so the content of the binary file I read is clipped off after a few bytes when the first null byte appears.</p>
<p>The only solution for that I can currently think of is briefly opening a TCP link from the game to itself, serving the binary file using the IncludeBinaryFile function in WebResponse and receiving it with a simultaneously spawned TCPLink<a href="http://wiki.beyondunreal.com/wiki?action=edit&id=TCPLink&referrerid=Mychaeel/Developer_Journal">?</a> in binary mode.  But that's not only quite cumbersome, there's also a chance that some people's personal firewalls might complain about it (even though it's nothing but a local intra-process connection)...</p>
<h3><a name="0.41.1"></a>Comments</h3>
<p><em class="em2">Wormbo:</em> AFAIK Quake 3 only works like this, even a single player game connects to a local game server, and when playing a skirmish game with open slots other players could join it, expanding it to a network game.</p>
<p><em class="em2">Nytro:</em> I <em class="em1">think</em> this now constitutes more than "short thoughts that popped up during Jailbreak development." <img alt="o_O" src="emoticons/ohoh.gif" align="middle"></p>
<p><em class="em2">Mychaeel:</em> You're right.  I've scratched the "short" part in the description.</p>
<p><em class="em2">Nytrogen:</em> I hate to continue to bother you... I don't own UT, and I can't find a decent description of <a href="screen.html">Screen</a>. Would you mind giving me a link or quick 'Screen overview' blurb?</p>
<p><em class="em2">Wormbo:</em> You just linked to it. There are links to the Screen website and forum. You should find any information you need there.</p>
<p><em class="em2">Birelli:</em> Specifically the "about" page: <a href="http://www.planetunreal.com/screen/about.html">http://www.planetunreal.com/screen/about.html</a> on the Screen website.</p>
<h2><a name="0.42"></a>October 1, 2003</h2>
<p>This morning I officially handed in three copies of the physics diploma thesis I had been working on for the last year (and which had kept me off anything Unreal-related for the last two months).  For those interested, it's about <em class="em1">Metal-Induced Crystallization of Silicon-Germanium Layers</em> &ndash; fundamental research for the next ('third') generation of solar cells which will be far more efficient and much cheaper to produce than what's currently on the market.</p>
<p>Well.  <em class="em1">[takes a deep breath]</em>  This concludes more than half a decade of studies of mine at the Technische Universitt Mnchen (I recently learned that they attach great importance to not being called "Technical University Munich" or something like that even on the cover sheet of English-language publications such as my thesis).  I guess it'll take a couple of days until I have really, deeply grasped the significance of this.  Right now, I'm mostly just relieved, happy, and tired.</p>
<p>One thing is sure, though:  I'm ready to get back into the Unreal community.  Even though I had been preoccupied by other things, I've really missed it.  <img alt=":-)" src="emoticons/smile.gif" align="middle">  It'll take me a few days to catch up, however, and there's also a lot more in my life which somewhat suffered during the last few weeks and which I have to catch up with, so be gentle.</p>
<h3><a name="0.42.1"></a>Comments</h3>
<p><em class="em2">Sobiwan:</em> Solar cells: nice.  Enough of this fossil fuel baloney.  I hope your thesis helps push research and/or development further.  </p>
<p><em class="em2">Tarquin:</em> Yay! Welcome back Mych. Good work saving the planet <img alt=":)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">El Muerte TDS:</em> heh, it's not like this is the only planet we have <img alt=";)" src="emoticons/wink.gif" align="middle"> About the uni name, ofcourse they want it to be the german names, the english name is too easy to write, it doesn't have  and . They want you to put effort in typing the name.</p>
<p><em class="em2">Mychaeel:</em> Well, I got a German keyboard here, so effort is not an issue. &ndash; The <a href="http://www.wsi.tum.de/E25/research/theses.htm">[Walter Schottky Institute]</a> where I worked, on the other hand, does not have any problems with officially allowing the English name <em class="em1">Walter Schottky Institute for Fundamental Research in Semiconductor Electronics</em>. &ndash; But then again, its name doesn't have any s and s in it, so your argument still holds.  <img alt=";-)" src="emoticons/wink.gif" align="middle"></p>
<p><em class="em2">Tahngarth:</em> Well I hope you get an A (or whatever the best grade is) <img alt=":)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">GRAF1K:</em> Good, NOW GET TO WORK ON JAILBREAK!!! <img alt=":P" src="emoticons/tongue.gif" align="middle"> Glad you're back. <img alt=":-)" src="emoticons/smile.gif" align="middle"> </p>
<h2><a name="0.43"></a>March 1, 2004</h2>
<p><em class="em1">* Mychaeel blows the dust from his developer journal, opens it and continues writing.</em></p>
<p>Just checked in some actual, new, original Jailbreak code again yesterday.  Quite an elevating feeling.</p>
<p>It's a facility for our audio announcements.  We noticed that the number of distinct announcements grew exponentially as we thought of more and more situations in which one would make sense.  Some documentation of the system is available on <a href="http://www.planetjailbreak.com/jdn/JBSpeechClient">[JDN: JBSpeechClient]</a>.</p>
<h3><a name="0.43.1"></a>Comments</h3>
<p><em class="em2">Tarquin:</em> Wow! <img alt=":)" src="emoticons/smile.gif" align="middle"> Looks cool!</p>
<h2><a name="0.44"></a>April 1, 2004</h2>
<p>Short of a few rather small features and known bugs, Jailbreak 2003 is finally feature-complete.  Yay!</p>
<p>The transition from UT2003 to UT2004 has put a big item on our to-do list again, though.  Epic has broken source code compatibility on several places, and other problems seem to stem from binary incompatibility (the <code>Ping</code> variable in <a href="playerreplicationinfo.html">PlayerReplicationInfo</a> suddenly transmogrified from an int to a byte, which breaks the score display in our scoreboard).</p>
<p>It's strange, yet interesting and somewhat impressive, that UT2004 manages to load and run the game anyway.  At the surface, Jailbreak 2003 runs well under UT2004 already, even though it <em class="em1">looks</em> like Jailbreak 2003, at least HUD-wise.  Of course we're going to make Jailbreak 2004 blend in with UT2004 as well as Jailbreak 2003 does with UT2003.</p>
<p>If possible without too much pain I'd very much like to release Jailbreak 200x as a combined UT2003/UT2004 release.  The changes are small enough that it would be a shame to abandon all UT2003 users who didn't have the chance or the money to upgrade to UT2004 yet.</p>
<p>I'm looking into the details of <a href="cvs.html">CVS</a> branching right now.  Our "main line of development" will become UT2004, but we'll keep a UT2003 branch and take care to merge any generic changes into it.  ...if that works the way I hope it does.</p>
<h2><a name="0.45"></a>April 23, 2004</h2>
<p>The Jailbreak to-do list is empty, and I'm out of work.  (You bet.)  Guess it's beta time now.  Yay!  <img alt=":-)" src="emoticons/smile.gif" align="middle"></p>
<p>Currently working on a Perl script that automatically updates all required modules from CVS, checks for uncommitted changes, rebuilds them if necessary and automatically creates the distribution packages.  I hope to be done with that sometime tonight.  My girlfriend made us a spiffy installer logo &ndash; I'm looking forward to hearing what the others say about it...</p>
<h3><a name="0.45.1"></a>Comments</h3>
<p><em class="em2">Corran:</em> That's great news (for us anyway <img alt=":D" src="emoticons/biggrin.gif" align="middle">).  I can't wait for this.</p>
<p><em class="em2">GRAF1K:</em> What he said. My mouth is watering. <img alt=":D" src="emoticons/biggrin.gif" align="middle"></p>
<p>BTW, did you know that UW is integated with the UT2004 UDE? Click on the Documentation tab in the code editing area and and there's unDox and Unreal Wiki. Sweet. <img alt=":)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">Corran:</em> Yeah, it's been integrated into WotGreal fo a while now.</p>
<p><em class="em2">GRAF1K:</em> Who cares about WOTgreal... UDE is official. <img alt=":D" src="emoticons/biggrin.gif" align="middle"></p>
<p><em class="em2">DJPaul:</em> WOTgreal <em class="em1">is</em> the UDE.</p>
<p><em class="em2">Guest:</em> Like the core of the application changes anything whatsoever... <img alt="O_o" src="emoticons/ohoh.gif" align="middle"></p>
<p><em class="em2">Wormbo:</em> c-24-7-171-253.client.comcast.net (Guest above), will you <em class="em1">please</em> stop deleting Murphy from this page?</p>
<h2><a name="0.46"></a>May 17, 2004</h2>
<p>Let it never be said again that modifying the mid-game menu in UT2003 requires a custom <a href="playercontroller.html">PlayerController</a> subclass...</p>
<div class="floatimages"><table border=0 cellspacing=0 cellpadding=0 align=center width=1><tr valign=top><td class="floatimages-block"><div><img alt="[mychaeel-ut2003midgamemenu]" src="images/mychaeel-ut2003midgamemenu.jpeg"></div>
</td>
</tr>
</table>
</div>
<h2><a name="0.47"></a>May 19, 2004</h2>
<p>I'm practically out of ideas what else could be added to Jailbreak &ndash; almost time to release now...</p>
<p>Last thing we implemented were custom loading screens &ndash; it's actually pretty straightforward to replace the default images displayed while a map loads by custom ones at runtime.</p>
<p>We've even managed to create one loading screen per bundled map and have the corresponding screen shown when the map loads &ndash; and I've added a means for mappers to <a href="http://www.planetjailbreak.com/jdn/Loading_Screen">[embed a custom loading screens into their map]</a> which is displayed when that map loads.  Given that the necessary information is all there and is just being ignored by UT2004 stock code, I wonder why Epic didn't do that themselves...</p>
<h3><a name="0.47.1"></a>Comments</h3>
<p><em class="em2">GRAF1K:</em> Epic wanted to include their uber-1337 Photoshop lensflares though! <img alt=";)" src="emoticons/wink.gif" align="middle"></p>
<p>Looks like a <em class="em1">very</em> nice release coming up from you guys over at Jailbreak. I'd count off the minutes if I only knew when...</p>
<p><em class="em2">Note:</em> I am indeed the M*rphy killer. Buggy 3rd-party software... <img alt=":pissed:" src="emoticons/pissed.gif" align="middle"> I'll get it fixed. For now though, I can't even replace the M*rphy's once I've killed them. Just revert once you see this.</p>
<p><em class="em2">Mychaeel:</em> Argh... what kind of bug would <em class="em1">specifically</em> replace occurrences of the string "Murphy" in a text...?  <img alt="o_O" src="emoticons/ohoh.gif" align="middle"></p>
<p><em class="em2">GRAF1K:</em> Well, it's not the bug directly that's doing that. The bug is me not being able to turn the feature off. The feature in question is a privacy feature that blocks sending of personal info (like the owner's name).</p>
<p><em class="em2">Mychaeel:</em> So is it safe to deduce that your name is Murphy?  (Way to go for a privacy feature... <img alt=":-p" src="emoticons/tongue.gif" align="middle">)</p>
<p><em class="em2">GRAF1K:</em> LOL. I was going to disable that feature anyhow. The app does a lot more than that. Besides, my last name isn't Mrphy, but the account is under someone who's is. <img alt=":)" src="emoticons/smile.gif" align="middle"></p>
<h2><a name="0.48"></a>May 20, 2004</h2>
<p>Naturally, any display of hubris such as making the statement "I'm out of bugs" angers the Gods, so the to-do list has a few more now.  Fortunately, they're all pretty small yet, and I'm out to squish them before they get any bigger...  <img alt=";-)" src="emoticons/wink.gif" align="middle"></p>
<h2><a name="0.49"></a>May 23, 2004</h2>
<p>You have no idea how glad I am that we're making a UT2003/UT2004 release of Jailbreak &ndash; if only for the reason that on both my desktop computer and my notebook with their measly 512 MB of RAM starting UT2004 (or even UT2004 server and client at the same time) takes <em class="em1">ages</em> while the system swaps like crazy &ndash; and loading UT2003, even server and client, works without any swapping at all.  UT2004 is a monster...</p>
<h3><a name="0.49.1"></a>Comments</h3>
<p><em class="em2">El Muerte:</em> I don't have any swap issues when running UT2004 on my laptop (512MB ram). Haven't done much client+server testing, but the client takes quite some time to join the server (/me blames slow laptop HD). On my desktop I can run a server and two clients without any serious problems (1GB ram). I think windows is to blame <img alt=":P" src="emoticons/tongue.gif" align="middle"></p>
<h2><a name="0.50"></a>May 27, 2004</h2>
<p>Jailbreak is out.  We assume full responsibility for all bugs that were left in.  <img alt=":-p" src="emoticons/tongue.gif" align="middle"></p>
<p>Seriously though &ndash; everything went reasonably smoothly, and while there <em class="em1">are</em> some bugs we'll have to fix, nothing really serious has popped up yet.  Feedback is very positive; feels good.  <img alt=":-)" src="emoticons/smile.gif" align="middle"></p>
<p>I've submitted Jailbreak 2004 for the MSU contest.  Perhaps we'll win something.</p>
<h2><a name="0.51"></a>May 29, 2004</h2>
<p>There's a known issue in UT2004 which prevents anybody who ever selected a third-party gametype in the server browser from joining any other game of a different gametype.</p>
<p>This happens since, when a gametype is selected, its <a href="gameinfo.html">GameInfo</a> class is loaded and its static FillPlayInfo function is called.  After adding its settings to the <a href="playinfo.html">PlayInfo</a> object, the GameInfo class remains loaded in memory (probably because it's somehow still referenced by the PlayInfo object and thus cannot be garbage-collected), and when the player tries joining a server running a different gametype, that'll fail because the third-party gametype's package is still loaded.</p>
<p>I haven't been able yet to find out <em class="em1">why</em> exactly FillPlayInfo is called at this point by the server browser and which part of the code does anything with the data saved in the PlayInfo object referenced by the <code>FilterInfo</code> variable.  However, simply avoiding to actually add anything to the PlayInfo object seems to solve the problem without any noticable side effect, so the following chunk of code makes everything work as it should:</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">function</span> FillPlayInfo<span class="uscript-operator">(</span>PlayInfo PlayInfo<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> UT2K4ServerBrowser UT2K4ServerBrowser<span class="uscript-operator">;</span>

  <span class="uscript-comment">// check whether we are called from a server browser</span>
  <span class="uscript-keyword">foreach</span> <span class="uscript-keyword">Default</span><span class="uscript-operator">.</span><span class="uscript-keyword">Class</span><span class="uscript-operator">.</span>AllObjects<span class="uscript-operator">(</span><span class="uscript-keyword">Class</span><span class="uscript-name">'UT2K4ServerBrowser'</span><span class="uscript-operator">,</span> UT2K4ServerBrowser<span class="uscript-operator">)</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>UT2K4ServerBrowser<span class="uscript-operator">.</span>FilterInfo <span class="uscript-operator">==</span> PlayInfo<span class="uscript-operator">)</span>
      <span class="uscript-keyword">return</span><span class="uscript-operator">;</span>  <span class="uscript-comment">// ignore because called from server browser</span>

  <span class="uscript-comment">// now do the usual stuff</span>
  <span class="uscript-keyword">Super</span><span class="uscript-operator">.</span>FillPlayInfo<span class="uscript-operator">(</span>PlayInfo<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

  PlayInfo<span class="uscript-operator">.</span>AddSetting<span class="uscript-operator">(</span><span class="uscript-keyword">Default</span><span class="uscript-operator">.</span>GameGroup<span class="uscript-operator">,</span> <span class="uscript-operator">.</span><span class="uscript-operator">.</span><span class="uscript-operator">.</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  PlayInfo<span class="uscript-operator">.</span>AddSetting<span class="uscript-operator">(</span><span class="uscript-keyword">Default</span><span class="uscript-operator">.</span>GameGroup<span class="uscript-operator">,</span> <span class="uscript-operator">.</span><span class="uscript-operator">.</span><span class="uscript-operator">.</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h2><a name="0.52"></a>May 31, 2004</h2>
<p>While fixing some netcode I found out that in one of my classes a certain variable was constantly, over and over again, replicated to all clients &ndash; several times per second; that class had <code>bNetNotify</code> activated, and PostNetReceive was called every other tick.</p>
<p>What baffled me was that this variable wasn't even changed server-side; nor did it change on client side.</p>
<p>It took me a while to find out what was happening:  This variable which was replicated over and over again was a <a href="pawn.html">Pawn</a> reference.  As soon as the Pawn it pointed to was destroyed, the variable was duly set to <code>None</code> on both server and client &ndash; but the server kept replicating its value to the clients.  And at the end of the day, the follwing slightly weird piece of code fixed it all:</p>
<pre class="uscript"><span class="uscript-comment">// fixes replicating over and over when referenced actor has been destroyed</span>
<span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>PawnObjectiveGuessed <span class="uscript-operator">==</span> <span class="uscript-keyword">None</span><span class="uscript-operator">)</span>
  PawnObjectiveGuessed <span class="uscript-operator">=</span> <span class="uscript-keyword">None</span><span class="uscript-operator">;</span></pre><p>The Unreal engine is full of mysteries...</p>
<h3><a name="0.52.1"></a>Comments</h3>
<p><em class="em2">Mysterial:</em> That works because UnrealScript returns <code>None</code> when accessing a property pointing to an <a href="actor.html">Actor</a> with bDeleteMe == true. Internally, the <a href="actor.html">Actor</a> is in fact still referenced by that property until the <a href="actor.html">Actor</a> is truly deleted. It getting continually replicated might be a bug in the engine. Can you try to create a small reproduction case and send it to me?</p>
<p><em class="em2">Mychaeel:</em> Will do.  <img alt=":-)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">Mychaeel:</em> Hrmph... making a simple test case is not as straightforward as I thought.  Then again, if it was an obvious bug, it probably wouldn't be in there...  <img alt=";-)" src="emoticons/wink.gif" align="middle"></p>
<h2><a name="0.53"></a>May 31, 2004</h2>
<p>Argh!  People report server crashes, and every single crash log has the following lines at its end:</p>
<pre>
  Critical: UObject::ProcessEvent
  Critical: (JBCameraArena JB-Heights.JBCameraArena, Function Jailbreak.JBCameraArena.Tick)
  Critical: AActor::Tick
  Critical: TickAllActors
  Critical: ULevel::Tick
  Critical: (NetMode=1)
  Critical: TickLevel
  Critical: UGameEngine::Tick
  Critical: Level Abandoned Heights
  Critical: UpdateWorld
  Critical: UServerCommandlet::Main
  Exit: Executing UObject::StaticShutdownAfterError
  Exit: Exiting.</pre><p>That Tick event in question doesn't do anything special that I'd be aware of &ndash; it certainly doesn't destroy the actor or anything like that.  And I cannot reproduce it at all in a local client/server testing environment, and it only happens infrequently on other servers anyway.</p>
<p>There may be one thing:  The Tick event calls a function within an <a href="editinline.html">editinline</a> object (which was created along with the JBCamera actor as a <a href="subobject.html">subobject</a>).  Perhaps, when JBCameraArena.Destroy() is called, that subobject reference somehow becomes invalid and crash-prone under certain circumstances?</p>
<p class="indent1"><em class="em2">Update:</em>  I just found out that all my JBCameraArena actors <em class="em2">share the same subobject</em> &ndash; unlike what I expected, seeing that spawning <a href="emitter.html">Emitter</a> subclasses creates <em class="em1">distinct</em> instances of their <a href="particleemitter.html">ParticleEmitter</a> subobjects.  While I'm not sure whether that's responsible for the crashes, it's definitely not what I had in mind and it's a bug when more than one JBCameraArena is active at the same time.</p>
<p>To make it worse, those error messages don't really indicate what <em class="em1">kind</em> of error happened (the lines preceding them are different and nothing out of the usual in every case &ndash; such as players joining or leaving; unfortunately I have no indication whether there's a temporal relationship between the events logged before the error and the error, but I believe there's not).</p>
<p>Is there anyone out there with Unreal-engine insight who might be able to tell me which kinds of errors would trigger those server log messages?</p>
<h2><a name="0.54"></a>June 2, 2004</h2>
<p>Phew.  The Jailbreak server crashes are <em class="em2">fixed</em> (and stress-tested successfully on MyUnreal's ever-full server), and so are the "web admin does not come up again after level change" and "server does not react to UDP requests after a while" bugs.  Those were the toughest ones to crack, mostly because I was fixing in the dark; the others were, while partly annoying, peanuts.</p>
<p>In retrospect it seems that the latter two bugs stemmed from the engine not fully cleaning up the previous level; and that, in turn, was apparently due to my storing some actor references in the <em class="em1">class default</em> values of a class &ndash; I did that only to compare the stored references to given ones for caching a function's return value over subsequent calls.  Even if the actors were destroyed between two calls, I'd expect a comparison simply to fail.</p>
<p>After I worked around that problem (by storing the actors' locations in the cache &ndash; in this case that worked just as well), suddenly those both bugs (web server not coming up again, UdpGameSpyQuery failing to bind its port after a while) were gone all by themselves.  So, note for the future:  <em class="em2">Never store actor references in default properties!</em></p>
<h3><a name="0.54.1"></a>Comments</h3>
<p><em class="em2">Foxpaw:</em> That's interesting. I've stored actor references in default properties lots. (For instance, any actor can get a reference to the level's backdrop in my case by accessing class'Base.Backdrop'.default.Reference. Perhaps this behaviour is limited to certain classes?</p>
<p><em class="em2">Mychaeel:</em> Perhaps, but I don't think so.  The effect of doing that is hardly noticable in local testing conditions, in any case (otherwise I'd have seen it a lot earlier) &ndash; as I wrote, the most noticable effect was that the web admin <a href="webserver.html">WebServer</a> didn't get cleaned up on level change and that &ndash; after many level changes &ndash; a server just didn't respond to UDP requests anymore.  Otherwise, everything worked great.</p>
<p><em class="em2">Mysterial:</em> Since classes are non-Actor objects, the usual issues with storing <a href="actor.html">Actor</a> references in them apply. I'm somewhat surprised it didn't crash. Perhaps because the engine doesn't actually destroy the class objects as it would most other objects you'd store references in, since you're playing another Jailbreak game so it wouldn't ever unload the resources.</p>
<p><em class="em2">Mychaeel:</em> Frankly, I wasn't ever aware of "the usual issues" with storing Actor references in non-Actor objects &ndash; Jailbreak code still does that on several occasions (<a href="levelinfo.html">LevelInfo</a> and <a href="teaminfo.html">TeamInfo</a> references in the non-Actor objects which represent the small player icons on the HUD, and in at least one other place too).  Are you saying that referencing an Actor from a non-Actor object is always crash-prone and not supported by the engine?</p>
<p><em class="em2">Mysterial:</em> <a href="actor.html">Actor</a> references in non-Actor subclasses don't get automatically cleaned up by the engine, so they work just like C++ pointers in that accessing them after they've been deleted has horrible, unpredictable effects (generally crashing). Additionally, since part of garbage collection is traversing every object reference property that exists, you need to clean up any such references before a level change or you'll either get frequent serialization crashes or prevent the previous level from unloading, creating huge memory leaks, as you unfortunately found out.</p>
<h2><a name="0.55"></a>June 8, 2004</h2>
<p>With the stress of releasing Jailbreak over, I'm free to look into some of my old mutator ideas again.  One of them is <em class="em2">SprayPaint</em> &ndash; a simple idea actually, borrowed from Half Life where the ability to spray-paint your clan logo on walls was built-in functionality.  I want to port that idea to UT2004.</p>
<p>This would be pretty straight-forward and quite uninteresting if I hadn't put it into my mind that it should be possible to customize the spray-painted images by simply dropping a BMP file (1-bit, 64x64 pixels) into a directory; and, if that's done by a client in a network game, all other clients should be able to see the same image too.  The latter is just some replication acrobatics; the former is where I saw my challenge.</p>
<p>Reading arbitrary files in UnrealScript isn't really supported, but if you need to do it for text files, instantiating a <a href="webresponse.html">WebResponse</a> object and using its LoadParsedUHTM function works quite well.  However, UnrealScript strings aren't binary safe &ndash; null bytes act as end-of-string tokens and thus cannot be included in a string.  Attempting to load a binary file such as a BMP image with LoadParsedUHTM results in a byte string truncated at the first null byte.</p>
<p>I've worked around that problem now by spawning a local <a href="webserver.html">WebServer</a> listening on a random free port, delivering files as "application/octet-stream" with WebResponse's function IncludeBinaryFile, and a <a href="tcplink.html">TcpLink</a> operating in MODE_Binary to receive the binary data from the local web server.  In theory this setup is able to read the contents of any binary file within the UT2004 directory hierarchy into an UnrealScript byte array, and it's working great for my purposes.</p>
<h3><a name="0.55.1"></a>Comments</h3>
<p><em class="em2">EntropicLqd:</em> Can you see outside of the UT2004 directory structure with that technique?  Cunning solution btw</p>
<p><em class="em2">Mychaeel:</em> Frighteningly enough, I can read <em class="em1">any</em> file that way.  (I had actually &ndash; and perhaps naively &ndash; assumed that the IncludePath in WebResponse would not allow UnrealScript code to travel beyond the UT2004 base directory...) &ndash; Perhaps it'd be best to let Epic know about this and to remove this last "Developer Journal" entry for the time being...</p>
<p><em class="em2">EntropicLqd:</em> I'd definitely let Epic know about it (I guess you have already).  Allowing access above the 2K4 root directory is an astonishing lapse on Epics part.  I was expecting a <em class="em1">ho ho ho ofcourse not</em> response.  Wonder if you could write a remote file browser...</p>
<p><em class="em2">Mychaeel:</em> Without having a way to generically get full directory listings, I'm afraid (or rather, glad) that's not possible &ndash; StreamInterface<a href="http://wiki.beyondunreal.com/wiki?action=edit&id=StreamInterface&referrerid=Mychaeel/Developer_Journal">?</a> only provides a way to list directories (and a limited set of other file types, though I haven't been able to get that to work for anything except said directories and .mp3 files).</p>
<p><em class="em2">Mychaeel:</em> The LoadParsedUHTM method works on any file on a given partition too, given the right IncludePath setting (e.g. "C:/") in a subclass and without all the local web server hassle.</p>
<p><em class="em2">Mychaeel:</em> I've sent a mail to Joe Wilcox.</p>
<h2><a name="0.56"></a>July 12, 2004</h2>
<p>Jailbreak 2004 is one of the gametype finalists in the MSU contest.  That's nice and I hope we'll win something too, but I find it more notable that Jailbreak got a honorable mention in the "FPS Mod" category.  I didn't check that box when I entered Jailbreak 2004 into the contest; it must have been the judges' decision to put it there too...</p>
<p>In completely unrelated news, I've been turning some of my spare attention to attempting to write a couple of extensions for Thunderbird to make my life easier (on the long run; you know, that "impatience, hubris" part that occasionally pops up in a Larry Wall quote at the bottom of an Unreal Wiki page).  Phew.  If you ever thought that UnrealScript was a humongous, complex and for the most part poorly documented heap of code already, do look at <a href="http://lxr.mozilla.org">http://lxr.mozilla.org</a> for an upgrade.</p>
<h3><a name="0.56.1"></a>Comments</h3>
<p><em class="em2">Tarquin:</em> I don't know about you, but I am finding the Jailbreak community very quiet these days. I'm sure there was way more activity (posts, maps, discussion) in the days of JBIII. But I suppose that was the 3rd release and we are only on the first. BTW, if you have some spare time, do you think you could look at the Wookee class tree generator? It would be nice if the text of the tree was parsed for wiki links, so we could use it for Unreal classes here &ndash; but I'm afraid I've not been able to work out how to do it. It's WookeeTree.pm in your CVS. <img alt=":)" src="emoticons/smile.gif" align="middle"> </p>
<h2><a name="0.57"></a>July 14, 2004</h2>
<p>My support for Opera 6 has finally broken down after the last vBulletin 3 update which made <code>[code]</code> tags unreadable, and I've made the switch to Firefox.  I'm loving it already.</p>
<p>It has gone quite a long way since the last time I gave it a try (must have been around version 0.6), and most of the reasons I didn't want to switch to it then have gone meanwhile.  I'm especially fond of the ability to selectively skin websites with custom CSS (using the "uriid" extension and a specially crafted userContent.css), and I just <em class="em1">have</em> to love a program which allows me to tweak its user interface appearance by editing a CSS file...</p>
<p>In completely unrelated news, Fraunhofer IGD (whom I had sent an unsolicited application about three months ago and never heard back of) has offered me a job... working on a project in Seoul, South Korea.  Imagine my surprise.  I might even have considered it if I hadn't found another job in the meantime already <em class="em1">and</em> if I didn't specifically want to move closer to my girlfriend in the Frankfurt area.  Still, quite interesting...</p>
<p>(Is this developer journal turning into a blog...?)</p>
<h3><a name="0.57.1"></a>Comments</h3>
<p><em class="em2">Tarquin:</em> Bwahahahaha! I knew we'd convert you in the end.... <img alt=":P" src="emoticons/tongue.gif" align="middle"></p>
<p><em class="em2">MythOpus:</em> Consider this a reminder from the entire wiki to update the Wookee download zip <img alt=";)" src="emoticons/wink.gif" align="middle"></p>
<h2><a name="0.58"></a>August 20, 2004</h2>
<p>When you think you're finally out of bugs, Atari QA will come and send you a new bunch of them.  <img alt=":-p" src="emoticons/tongue.gif" align="middle"></p>
<p>No, actually, it's not that bad.  It boils down to one actual code bug and a bunch of map-related things in the order of "graphic seams flicker in and out around the pipelines."  Still, I was surprised when I got that mail...</p>
<h3><a name="0.58.1"></a>Comments</h3>
<p><em class="em2">GRAF1K:</em> Why would Atari be interested in sending you bug reports?</p>
<p><em class="em2">Wormbo:</em> One code bug and one code thing I wouldn't call a bug. (no weapon in celebration screen)<br>They most likely sent the reports because they tested Jailbreak 2004. <img alt=";)" src="emoticons/wink.gif" align="middle"></p>
<p><em class="em2">Mychaeel:</em> ...and they tested Jailbreak 2004 because they want to include it in the Editor's Choice Edition.  Sorry, I kinda implied this.  <img alt=";-)" src="emoticons/wink.gif" align="middle"></p>
<p><em class="em2">Guest:</em> I figured ECE was the reason but wasn't sure. Congrats then. <img alt=":D" src="emoticons/biggrin.gif" align="middle"></p>
<h2><a name="0.59"></a>September 5, 2004</h2>
<p>Picking up my old SprayPaint mutator idea again.  To reiterate, it's about being able to spray logos on walls &ndash; the logos must be provided as monochrome bitmaps (i.e. bitmaps with 1-bit color depth) in a certain UT2004 subdirectory, and you can spray them on walls in a color of your choice; and the best thing is that other players on the server would see the exact same thing even though they don't have the source bitmap on their system.  On the long run I even want the sprayed images to persist across matches.</p>
<p>There's a bit of replication acrobatics involved in making that work, but so far it works nicely &ndash; the data is loaded client-side, transmitted to the server via a replicated function in "bunches" of no more than 64 bytes a tick, and then left to the engine to be replicated back to all (non-bNetOwner) clients.</p>
<p>Two things I noticed doing that were that, firstly, the engine only replicates the first 256 bytes of an array of 512 byte values (where I don't know exactly whether it's the number of elements or their total size which is limited by the engine); and secondly, that passing a byte array via a replicated function call will only actually replicate the first value of that array, not the entire array.  However, if the array is part of a struct which is passed through the replicated function, everything works fine (hence my "bunches" of data).</p>
<p>The user interface for that thing is keeping me thinking.  Right now I figure that pressing your usual "talk" key ("T", for instance) quickly twice in a row (like a double-click) would pop up a window where you could select which image to spray (using the mouse or arrow/movement keys), but that idea is subject to change.  For now, the "mutate SprayImage &lt;filename&gt; &lt;color&gt;" console command does the trick.</p>
<h2><a name="0.60"></a>November 17, 2004</h2>
<p>I've moved into my new apartment last Sunday, and today I got ISDN and DSL activated.  Thus, JDN is up again &ndash; whatever caused my computer to break down two weeks ago is mysterious to me.  Maybe my video card overheated after all after having been running non-stop for months without a monitor attached to it... still, not really a satisfactory explanation.</p>
<p>Now that my home computer has been hosting CVS, an Apache webserver with JDN and other services and an ISDN calling machine and fax server for quite a while and across several hardware updates, I've been thinking &ndash; it's getting harder and harder to keep the noise level coming from this machine at a level I'm willing to bear in my living room.  Plus, most of the time the computer is merely converting electric power into noise and heat via a video card and processor which are ridiculously overpowered for something acting as a web/fax/CVS server most of the time.</p>
<p>...so &ndash; *drumroll* &ndash; I've got that fabulous idea of building a small machine out of spare parts mostly left over from hardware upgrades of my main PC over the years.  I've got two mainboards/processors to choose from (a Pentium 200 MHz and an Athlon 800 MHz which I could underclock to 500 MHz), some left-over RAM, an ethernet card (my latest mainboard had that on-board) and a simple video card (an ATI XPert@Work sporting a 3D chipset with the staggering amount of 8 MB VRAM).  I also have a midi-tower computer case somewhere.  What I need is a silent power supply and &ndash; probably &ndash; a new harddisk (especially if this thing is to act as a file server as well) unless I find a suitable one in my pile of used hardware.</p>
<p>I figure I'll install Debian Linux on it &ndash; with that awesome 3 MBit/s downstream I've got I can even download it without much hassle.</p>
<p><em class="em2">Update:</em>  Wow.  Silent 80 GB harddisks come for less than 60 EUR these days?  <img alt="o_O" src="emoticons/ohoh.gif" align="middle"></p>
<h2><a name="0.61"></a>March 8, 2005</h2>
<p>*blows dust off this page*</p>
<p>*cough*<br>*cough*</p>
<p>Remember the Palpable mutator for Unreal Tournament?  Probably not, because I never actually released it, and the BuF mess-up two years ago ate all remaining evidence for it.</p>
<p>Basically, it allowed the user to see stereo 3D by displaying two versions of the current scene rendered from slightly different points of view.  You had to squint to see the effect, just like for <a href="http://www.brossco.fi/janne/eclipse99/budapest/bu_3d.html">[these photos]</a>.</p>
<p>I tried to implement the same thing for UT2004 on Sunday.  To the degree that two viewports were rendered on the screen next to each other, it was a piece of cake; but, having the HUD render within one of those viewports prove to be impossible.  In Unreal Tournament, it was basically just a matter of setting <a href="canvas.html">Canvas</a>.OrgX/OrgY and ClipX/ClipY right &ndash; but UT2004's HUD makes heavy use of the native DrawSpriteWidget function which, while honoring OrgX/OrgY and ClipX/ClipY, doesn't take the reduced size of a viewport defined through those properties into account when positioning and scaling the widgets.</p>
<p>So, no way.  Well, it was just an experiment anyway.  The 3D effect itself is pretty cool, though, even if it strains the eyes to squint that way for an extended period of time...</p>
<p>In other news, after a period of consideration, I bought a digital piano today &ndash; a <a href="http://www.rolandus.com/products/ck_details.asp?CatID=11&SubCatID=45&ProdID=HP-101">[Roland HP-101]</a>.  I played the piano for years before leaving my parents' home to go to university, and I want to pick this hobby up again.  And, wow, those digital pianos nowadays really do sound and feel like the real thing &ndash; down to subtle details like the slight resonance you hear after releasing a key, or that the keys for the deep tones react with slightly more resistance to being pressed down than the high-pitched keys...</p>
<h3><a name="0.61.1"></a>Comments</h3>
<p><em class="em2">Birelli:</em> I remember Palpable, I think a couple of us on IRC tested it for you one time. It's definitely a cool effect, but it gave me a headache after about 15 minutes of playing. Probably not something people want to use all the time. Also it takes a bit of practice before you can train your mind into not forcing one eye dominant over the other, so at first it's basically impossible to run in a straight line.</p>
<h2><a name="0.62"></a>April 19, 2005</h2>
<p>Those who have followed <a href="http://www.planetjailbreak.com/?news=275">[PlanetJailbreak news]</a> are aware of what I've been working on recently: the visuals of freezing and shattering a player model.  Part of the problem is to overlay the player model and the weapon it holds with an "ice" texture that gradually fades in.</p>
<p>My first idea was creating a <a href="shader.html">Shader</a>, setting its <code>Diffuse</code> material to the player's skin texture, the <code>Specular</code> material to my alpha-blended "ice" texture and use a <a href="constantcolor.html">ConstantColor</a> as its <code>SpecularityMask</code> material to control the fading.  That works fine for the player model, but utterly fails for the weapon &ndash; the weapon's textures are implicitly defined through the mesh, and there's no way UnrealScript code can get hold of them (not even anything similar to <a href="dynamicly-accessing-origina.html">this method</a>).</p>
<p>So, that approach fell somewhat short of what I had envisioned.</p>
<p>But there's <code>OverlayMaterial</code> defined in <a href="actor.html">Actor</a>, along with a <code>SetOverlayMaterial</code> method, which is used (among others) by the UDamage to produce that "energy" overlay effect on players and weapons.  I had previously found out already that using a plain texture as <code>OverlayMaterial</code> will simply replace the model's skin by that texture (instead of overlaying it) &ndash; not what I intended, so I had put that approach aside.  Now, I picked it up again.</p>
<p>After some lucky experimentation, I found that I was able to use a <a href="shader.html">Shader</a> as an <code>OverlayMaterial</code> whose <code>Specular</code> material was set to my "ice" texture.  Funnily, I noted that:</p>
<ul><li>The <code>Diffuse</code> material I tried to set was automatically overwritten with a reference to the overlaid actor's skin (the skin part with the highest ordinal number in the meshmap, I guess).  So, here's a way to find the original skins of a non-static mesh if you need to.</li>
<li>The <code>A</code> (alpha) member of the <code>Color</code> property of a <a href="constantcolor.html">ConstantColor</a> material I tried to use as the shader's <code>SpecularityMask</code> was immediately reset to zero whenever I attempted to set it to something different.  Why would the engine do such a thing...?</li>
</ul>
<p>So, that didn't work the way I had it intended to.  Neither did any attempts to replace the plain "ice" texture in the <code>Specular</code> slot by a <a href="modifier.html">Modifier</a> of any kind.</p>
<p>Then, in a last futile attempt, I tried using a <a href="fadecolor.html">FadeColor</a> in the <code>SpecularityMask</code> slot (instead of a <a href="constantcolor.html">ConstantColor</a> as before), and lo!, when I set its <code>FadePeriod</code> to something other than the default, zero, it worked!  Well, of course I had a pulsing overlay now, but setting both <code>Color1</code> and <code>Color2</code> to the same color fixed that.</p>
<p>So, now I've got a texture overlay on both player and weapon which I can smoothly fade in (and out, if there was any need) and which still lets the original textures shine through.</p>
<h3><a name="0.62.1"></a>Comments</h3>
<p><em class="em2">Wormbo:</em> Interesting hack. <img alt=":)" src="emoticons/smile.gif" align="middle"> The engine uses the ConstantColor in the SpecularityMask slot to fade out the overlay effect when the actor's overlay timer drops below 1 or so.</p>
<h2><a name="0.63"></a>May 1, 2005</h2>
<p>Microsoft has a pretty good reputation on IDEs, but <em class="em1">Microsoft eMbedded Visual C++</em> really has at least one major quirk which makes working with it a pain unless you either know how to avoid it or unwittingly got around it by failing to customize your workspace too much.  I didn't fall into the second group, and it took me until today to become part of the first.</p>
<p>I'm developing a small smartphone application to remote-control MP3 playback on the Linux server which sits quietly in my closet via Bluetooth.</p>
<p>The <em class="em1">Smartphone 2003 SDK</em> comes with a smartphone emulator.  That's very nice, but it becomes pretty frustrating once it stops working &ndash; which, for me, happened basically whenever I started the IDE for the second time after installing it:  Whenever I wanted to run my program, I got an error dialog telling me one of the following things:</p>
<blockquote><p>Cannot find a default device. Please create one or more from the Platform Manager.</p>
</blockquote><p></p>
<blockquote><p>There is no device installed. Please go to Configure Platform Manager to add a device.</p>
</blockquote><p>Obviously there were still the same devices as the last time, and I certainly hadn't changed configurations since last successfully running the program in the emulator.  So, almost each time I wanted to work on my project, I had to uninstall the entire IDE and reinstall all of it &ndash; two installers, one of them badly made, and a service pack; half an hour work just to get the IDE to work again.  Needless to say, I didn't do that very often.</p>
<p>Of course, I googled for a solution.  Nothing to find except for two postings from people with the same problem without any replies to them.  At least I wasn't alone; little consolation there, though.</p>
<p>Today, I got that second error message from above for the first time, and that was my luck.  Googling for <em class="em1">that</em> finally led me to a newsgroup message with the solution:  If you disable the WCE Configuration toolbar, the (unlabeled) "default device" drop-down box (the rightmost one) <em class="em2">will automatically revert to "Smartphone 2003 Device."</em>  Set it back to "Smartphone 2003 Emulator" and everything works again.  There's no menu command for that option.</p>
<p>"Son of a gun!", to say it in the original newsgroup poster's words.  What an unnecessary annoyance.</p>
<h2><a name="0.64"></a>November 3, 2005</h2>
<p>Today at around 11:15 AM, I successfully completed my twenty-ninth year of life (for a suitable definition of "successfully" <img alt=":-P" src="emoticons/tongue.gif" align="middle">), heading into the thirtieth without hesitation. Happy birthday to me <img alt=";-)" src="emoticons/wink.gif" align="middle"></p>
<h3><a name="0.64.1"></a>Comments</h3>
<p><em class="em2">El Muerte:</em> damn you're old <img alt=";)" src="emoticons/wink.gif" align="middle"></p>
<p><em class="em2">EntropicLqd:</em> Happy birthday youngster (for a given value of young).  Give it another few years and you'll feel like you are falling apart <img alt=":)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">Sweavo:</em> phew it's not just me then Entropic <img alt=":-)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">Tarquin:</em> Happy birthday Mych! The big 30 next year <img alt=";)" src="emoticons/wink.gif" align="middle"> It's not as awful as it sounds <img alt=":)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">Mychaeel:</em> Hehe, thanks y'all <img alt=":-)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">MythOpus:</em> I saw it awhile ago, but I was always on my dads Linux computer so I haven't been able to... WISH YOU A HAPPY BIRTHDAY!</p>
<p><em class="em2">Mychaeel:</em> I'll take good wishes at any time, so: thank you as well <img alt=":-D" src="emoticons/biggrin.gif" align="middle"></p>
<p><em class="em2">Sweavo:</em> in that case, have had a happy birthday <img alt=":-)" src="emoticons/smile.gif" align="middle"></p>
<h2><a name="0.65"></a>April 24, 2006</h2>
<p>Setting a data structure element of a replicated array element won't actually make the engine replicate that array element.  You'll have to set the <em class="em1">whole</em> array element to make the engine notice that it has changed:</p>
<pre class="uscript"><span class="uscript-keyword">function</span> TouchElement<span class="uscript-operator">(</span><span class="uscript-type">int</span> iElement<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> TElement ElementTemp<span class="uscript-operator">;</span>

  ElementTemp <span class="uscript-operator">=</span> Elements<span class="uscript-operator">[</span>iElement<span class="uscript-operator">]</span><span class="uscript-operator">;</span>
  Elements<span class="uscript-operator">[</span>iElement<span class="uscript-operator">]</span> <span class="uscript-operator">=</span> ElementTemp<span class="uscript-operator">;</span>  <span class="uscript-comment">// prod!</span>
<span class="uscript-operator">}</span></pre><p>Has anybody else ever had that problem?</p>
<h3><a name="0.65.1"></a>Comments</h3>
<p><em class="em2">EricBlade:</em> I haven't personally had a reason to make an array of structs yet, but it sounds like it could be related somehow to the problem of not being able to replicate -just- a struct, without some other var?</p>
<p><em class="em2">Wormbo:</em> That seems to be a general problem of struct replication, not only structs as array elements. The code <code>Elements[iElement] = Elements[iElement]</code> seems to be enough to cause replication though, whether anything actually changed or not.</p>
<p><em class="em2">Mychaeel:</em> Yes, I also realized that the detour over a temporary local variable probably wasn't necessary at all &ndash; I was still under the influence of the <code>SwapElements</code> function which actually <em class="em1">needed</em> one.  I've occasionally replicated (individual instances of) structs without problems, though &ndash; you only have to be aware that changing any struct element will cause the entire struct to be replicated.  (Actually, I've used that as a feature occasionally.)</p>
<h2><a name="0.66"></a>July 15, 2006</h2>
<p>I found the following function in <a href="http://mychaeel.no-ip.com/source/Jailbreak/Jailbreak/Classes/JBTagPlayer.uc?rev=1.58&view=auto">[some source code]</a> I had written years ago:</p>
<pre class="uscript"><span class="uscript-comment">// ============================================================================</span>
<span class="uscript-comment">// CalcOrientation</span>
<span class="uscript-comment">//</span>
<span class="uscript-comment">// Calculates and returns an artificial value representing the orientation of</span>
<span class="uscript-comment">// a vector. The returned value has the following properties:</span>
<span class="uscript-comment">//</span>
<span class="uscript-comment">//   * Non-zero for any non-zero vector. Zero for the zero vector.</span>
<span class="uscript-comment">//   * Negating the argument yields the negative result.</span>
<span class="uscript-comment">//</span>
<span class="uscript-comment">// Those properties allow to use this function to make any difference between</span>
<span class="uscript-comment">// two given points in space unambiguous by passing a single additional binary</span>
<span class="uscript-comment">// bit of information.</span>
<span class="uscript-comment">// ============================================================================</span>

<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> <span class="uscript-type">float</span> CalcOrientation<span class="uscript-operator">(</span>vector VectorInput<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> vector VectorTranslated<span class="uscript-operator">;</span>

  VectorTranslated<span class="uscript-operator">.</span>X <span class="uscript-operator">=</span> VectorInput <span class="uscript-operator">dot</span> <span class="uscript-keyword">vect</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>VectorTranslated<span class="uscript-operator">.</span>X <span class="uscript-operator">!=</span> <span class="uscript-number">0.0</span><span class="uscript-operator">)</span> <span class="uscript-keyword">return</span> VectorTranslated<span class="uscript-operator">.</span>X<span class="uscript-operator">;</span>
  VectorTranslated<span class="uscript-operator">.</span>Y <span class="uscript-operator">=</span> VectorInput <span class="uscript-operator">dot</span> <span class="uscript-keyword">vect</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">,</span><span class="uscript-operator">-</span><span class="uscript-number">1</span><span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>VectorTranslated<span class="uscript-operator">.</span>Y <span class="uscript-operator">!=</span> <span class="uscript-number">0.0</span><span class="uscript-operator">)</span> <span class="uscript-keyword">return</span> VectorTranslated<span class="uscript-operator">.</span>Y<span class="uscript-operator">;</span>
  VectorTranslated<span class="uscript-operator">.</span>Z <span class="uscript-operator">=</span> VectorInput <span class="uscript-operator">dot</span> <span class="uscript-keyword">vect</span><span class="uscript-operator">(</span><span class="uscript-number">0</span><span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">,</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>VectorTranslated<span class="uscript-operator">.</span>Z <span class="uscript-operator">!=</span> <span class="uscript-number">0.0</span><span class="uscript-operator">)</span> <span class="uscript-keyword">return</span> VectorTranslated<span class="uscript-operator">.</span>Z<span class="uscript-operator">;</span>

  <span class="uscript-keyword">return</span> <span class="uscript-number">0.0</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>It's part of Jailbreak's player movement extrapolation code which is designed to provide a smooth client-side representation of a player's position with as little network traffic as possible.  The extrapolated player position is used by the <a href="http://mychaeel.no-ip.com/jailbreak/JBPanorama">[scoreboard minimap]</a> and <a href="http://mychaeel.no-ip.com/jailbreak/JBScreen">[JBScreen]</a>.</p>
<p>Well, what the <em class="em1">heck</em> was I thinking?</p>
<p>Obviously, instead of using a local vector variable, I could have used a simple float; the function calculates each component of the local vector, immediately uses it, and then never uses it again.  Plus, looking more closely at what's actually done there, it looks as if I could simply have used the original vector's components instead of (sloppily) translating it into a rotated coordinate system first.</p>
<p>It took me a while to get behind what I had thought several years ago.  I should comment more.</p>
<p>Using a local vector instead of a float was halfway between being an artifact of the way my mind had gone before arriving at this code and being self-documenting code.  (Sure enough the latter could have been achieved just as well with less bytecode overhead by just adding a comment.)</p>
<p>Translating the input vector into a coordinate system rotated 45 away from the main axes was done to make changes in the signum of the return value less common.  If there's any directional bias in a player's movement at all, it's usually along the main axes, following a hallway a mapper will generally have aligned along the coordinate system.  Strafing left and right even just a bit while moving along one of the coordinate axes (say, the Y axis), would change the signum of one of the other coordinate components (the X component) frequently.</p>
<p>If the axes are rotated 45 about the vertical (Z) axis, chances are better that you stay "left" or "right" of an axis while moving, leaving the signum of the return value of this function unchanged.  Any change in the signum needs to be replicated to all clients (as the signum of the scalar player velocity they use to extrapolate the player's position); so this coordinate rotation reduces the frequency of updates required to send to the clients.</p>
<p>Phew.</p>
<p>I remember experimenting with different replication and extrapolation mechanisms, using some of UT2003's more obscure logging parameters to get network traffic detail into UT2003.log.  This optimization actually <em class="em1">did</em> reduce the amount of updates sent across the network for this detail.  I never got around to actually measuring whether it made any relevant difference in the <em class="em1">total</em> amount of network traffic, though.  I suppose this could be just one of the cases where I indulged in premature optimization just for the fun of it.</p>
<hr class="thin"><p><a href="category-journal.html">Category Journal</a></p>
<script type="text/javascript"><!--
 menuItemAdd("December 14, 2002", "#0.1");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.1.1");
menuItemAdd("December 20, 2002", "#0.2");
menuItemAdd("January 17, 2003", "#0.3");
menuItemAdd("January 18, 2003", "#0.4");
menuItemAdd("January 23, 2003", "#0.5");
menuItemAdd("January 24, 2003", "#0.6");
menuItemAdd("January 25, 2003", "#0.7");
menuItemAdd("February 3, 2003", "#0.8");
menuItemAdd("February 10, 2003", "#0.9");
menuItemAdd("February 14, 2003", "#0.10");
menuItemAdd("February 15, 2003", "#0.11");
menuItemAdd("February 17, 2003", "#0.12");
menuItemAdd("February 24, 2003", "#0.13");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.13.1");
menuItemAdd("March 17, 2003", "#0.14");
menuItemAdd("May 4, 2003", "#0.15");
menuItemAdd("May 7, 2003", "#0.16");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.16.1");
menuItemAdd("May 22, 2003", "#0.17");
menuItemAdd("May 24, 2003", "#0.18");
menuItemAdd("May 25, 2003", "#0.19");
menuItemAdd("May 26, 2003", "#0.20");
menuItemAdd("May 30, 2003", "#0.21");
menuItemAdd("May 31, 2003", "#0.22");
menuItemAdd("June 4, 2003", "#0.23");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.23.1");
menuItemAdd("June 6, 2003", "#0.24");
menuItemAdd("June 8, 2003", "#0.25");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.25.1");
menuItemAdd("June 9, 2003", "#0.26");
menuItemAdd("June 10, 2003", "#0.27");
menuItemAdd("June 11, 2003", "#0.28");
menuItemAdd("June 13, 2003", "#0.29");
menuItemAdd("June 14, 2003", "#0.30");
menuItemAdd("June 16, 2003", "#0.31");
menuItemAdd("June 17, 2003", "#0.32");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.32.1");
menuItemAdd("June 18, 2003", "#0.33");
menuItemAdd("June 23, 2003", "#0.34");
menuItemAdd("June 28, 2003", "#0.35");
menuItemAdd("July 3, 2003", "#0.36");
menuItemAdd("July 5, 2003", "#0.37");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.37.1");
menuItemAdd("July 6, 2003", "#0.38");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.38.1");
menuItemAdd("July 9, 2003", "#0.39");
menuItemAdd("July 14, 2003", "#0.40");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.40.1");
menuItemAdd("July 16, 2003", "#0.41");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.41.1");
menuItemAdd("October 1, 2003", "#0.42");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.42.1");
menuItemAdd("March 1, 2004", "#0.43");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.43.1");
menuItemAdd("April 1, 2004", "#0.44");
menuItemAdd("April 23, 2004", "#0.45");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.45.1");
menuItemAdd("May 17, 2004", "#0.46");
menuItemAdd("May 19, 2004", "#0.47");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.47.1");
menuItemAdd("May 20, 2004", "#0.48");
menuItemAdd("May 23, 2004", "#0.49");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.49.1");
menuItemAdd("May 27, 2004", "#0.50");
menuItemAdd("May 29, 2004", "#0.51");
menuItemAdd("May 31, 2004", "#0.52");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.52.1");
menuItemAdd("May 31, 2004", "#0.53");
menuItemAdd("June 2, 2004", "#0.54");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.54.1");
menuItemAdd("June 8, 2004", "#0.55");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.55.1");
menuItemAdd("July 12, 2004", "#0.56");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.56.1");
menuItemAdd("July 14, 2004", "#0.57");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.57.1");
menuItemAdd("August 20, 2004", "#0.58");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.58.1");
menuItemAdd("September 5, 2004", "#0.59");
menuItemAdd("November 17, 2004", "#0.60");
menuItemAdd("March 8, 2005", "#0.61");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.61.1");
menuItemAdd("April 19, 2005", "#0.62");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.62.1");
menuItemAdd("May 1, 2005", "#0.63");
menuItemAdd("November 3, 2005", "#0.64");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.64.1");
menuItemAdd("April 24, 2006", "#0.65");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Comments", "#0.65.1");
menuItemAdd("July 15, 2006", "#0.66");
 menuWrite() //--></script></div>
</div>

<div id="footer" class="bar">
	<p><form method="post" action="http://wiki.beyondunreal.com/wiki" enctype="application/x-www-form-urlencoded">
<a href="(start).html">Home Page</a> | <a href="mychaeel.html">Mychaeel</a> | <a href="recent-changes.html">Recent Changes</a> | <a href="http://wiki.beyondunreal.com/wiki?action=editprefs">Preferences</a><br>
<a href="http://wiki.beyondunreal.com/wiki?action=edit&id=Mychaeel/Developer_Journal">Edit text of this page</a> | <a href="http://wiki.beyondunreal.com/wiki?action=history&id=Mychaeel/Developer_Journal">View other revisions</a><br>Last edited July 15, 2006 12:52 <a href="http://wiki.beyondunreal.com/wiki?action=browse&diff=1&id=Mychaeel/Developer_Journal">(diff)</a><br>Search: <input type="text" name="search"  size="20" /><input type="hidden" name="dosearch" value="1"  /><br><br><small><a href="http://wiki.beyondunreal.com/wiki/Mychaeel/Developer_Journal">Original page</a> &#150; copy created Sat, Jun 23, 2007</small><div></div>
</form>
	</p>
	<p>Worst-case scenario: the UEd Goblin wipes the map and burns down your house.
</p>
</div>
</div><!-- close of "scrolling" div -->

<div id="quickbar">
	<div id="logo"><a href="http://wiki.beyondunreal.com/"><img src="shared/wikilogo.jpg" width="143" height="100" border="0"></a>
		</div>
	<div class="qbsitename">
		<p>The Unreal Engine Documentation Site</p>
	</div>
	<div class="qbsection">
<p><a href="metatopics.html">Wiki Community</a></p>
<p><a href="category-category.html">Topic Categories</a></p>
<p><a href="/cgi-bin/imageupload.cgi/wiki-ext/imageupload.htt" target="_blank ">Image Uploads</a></p>
<p><a href="http://wiki.beyondunreal.com/wiki?action=random">Random Page</a></p>
<p><a href="recent-changes.html">Recent Changes</a></p>
<p><a href="offline-wiki.html">Offline Wiki</a></p>
</div><div class="qbsection">
<p><a href="unreal-engine.html">Unreal Engine</a></p>
<p><a href="console-commands.html">Console Commands</a></p>
<p><a href="terminology.html">Terminology</a></p>
<p><a href="category-faq.html">FAQs</a></p>
<p><a href="help-desk.html">Help Desk</a></p>
</div><div class="qbsection">
<p><a href="topics-on-mapping.html">Mapping Topics</a></p>
<p><a href="mapping-lessons.html">Mapping Lessons</a></p>
<p><a href="unrealed-3.html">UnrealEd Interface</a></p>
</div><div class="qbsection">
<p><a href="unrealscript.html">UnrealScript Topics</a></p>
<p><a href="unrealscript-lessons.html">UnrealScript Lessons</a></p>
<p><a href="making-mods.html">Making Mods</a></p>
<p><a href="class-tree.html">Class Tree</a></p>
</div><div class="qbsection">
<p><a href="topics-on-modeling.html">Modeling Topics</a></p>
</div><div class="qbsection">
<p><a href="chongqing-page.html">Chongqing Page</a></p>
<p><a href="log-in.html">Log In</a></p></div>
</div>

</body></html>
