<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head lang="en">
	<title>UnrealWiki: UArch/USRender</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<link rel="stylesheet" type="text/css" media="screen, print"
		href="shared/stylebase.structural.css">	
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/template-default.css">
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/styles.chblue.css">
	<link rel="stylesheet" type="text/css" media="print"
		href="shared/template-default-print.css">
	<!--[if IE 6]>
			<style>
			/* dirty hack for IE6. */
			#quickbar {
				position: absolute;
				}
			</style>
	<![endif]-->
  <link rel="start" href="http://wiki.beyondunreal.com/">
  <link rel="glossary"  href="http://wiki.beyondunreal.com/wiki/Terminology">
  <link rel="help"  href="http://wiki.beyondunreal.com/wiki/Using_The_Wiki">
<script type="text/javascript" src="shared/dhtml.js"></script>
<script type="text/javascript" src="shared/dhtml-menu.js"></script>
<style type="text/css">#dhtml-menu    { background: #eee; padding: 5px 0px; margin-right: -20px; border: 1px solid #888; border-left: 1px solid #ccc; border-top: 1px solid #ccc;  border-right: 1px solid #888; border-bottom: 1px solid #888 }
#dhtml-menu td { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; padding: 1px 10px; cursor: default }
#dhtml-menu a  { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; text-decoration: none }
#dhtml-menu tt { font-family: monospace; font-size: 9pt }
#dhtml-menu-separator { height: 1px; background: red }
#dhtml-menu-anchor { cursor: default }
</style>
<script type="text/javascript" src="shared/expandable.js"></script>
</head>
<body onLoad="menuInit(); document.cookie='page=UArch/USRender; path=/'" class="default">
<div id="scrolling"><!-- contains all except the fixed sidebar -->
<div id="topbar"  class="bar">
	<div class="righthalf">
		<input type="text" name="search"  size="14" /> <input type="button" onclick="location.href='../search-error/index.html';" value="search" />
	</div>
	<div class="lefthalf">
		<script type="text/javascript"><!--
			menuAlignRight = false;
		//--></script>
		<span><script type="text/javascript"><!--
 menuWriteAnchor("Quick Navigation") //--></script></span> | <a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a>
	</div>
</div>

<div id="content"><!-- contains the title and article -->
	<h1 class='pagetitle'><a href="uarch.html">UArch</a>/<a href="http://wiki.beyondunreal.com/wiki?back=UArch/USRender">USRender</a></h1>
	<div class="wiki"><h2><a name="0.1"></a>UnrealScript Renderer</h2>
<p>it is not an actual render device, but instead draws the entire scene onto the canvas</p>
<p>the calculations are all per-pixel which gives the renderer realtime lighting and shadows specular and hopefully other effects in the future <img alt=":P" src="emoticons/tongue.gif" align="middle"></p>
<p>the renderer is extremely slow (for obvious reasons) and the renderer runs best at 40x30 to 64x48 it cannot render meshes(only renders the collision cylinders) which makes it quite useless really <img alt="=P" src="emoticons/tongue.gif" align="middle"> but it was intresting to make</p>
<p>will update description later</p>
<h3><a name="0.1.1"></a>First Test version</h3>
<p>black and white lighting only, very simple lighting calculations (no surface normal taken into account) so surfaces lack definition</p>
<p><img alt="[usrender_v1_00]" src="images/usrender-v1-00.jpeg" class="image-inline"></p>
<p>the cylinder on the bottom left picture is a bot <img alt=";)" src="emoticons/wink.gif" align="middle"></p>
<p>a short video is available here:</p>
<p><a href="http://uarch.dyndns.org/ur/_Render.avi">http://uarch.dyndns.org/ur/_Render.avi</a> 3.3MB</p>
<h3><a name="0.1.2"></a>Second version</h3>
<p>huge step up from the previous version with colored lighting, specular, and distance fog</p>
<p>this version also lets you take screnshots much larger than the "render resolution" and has settings to enable/disable certain features</p>
<p>some higher resolution pictures which were taken at 256x192(i think) (actual render resolution was 40x30)</p>
<p><img alt="[usrender_v2_00]" src="images/usrender-v2-00.jpeg" class="image-inline"></p>
<p><img alt="[usrender_v2_01]" src="images/usrender-v2-01.jpeg" class="image-inline"></p>
<p>also below are 4 comparison screenshots, taken from DM-TDC-Derdak made by Derdak2rot for the theme design contest pack which is available at nalicity <a href="http://nalicity.beyondunreal.com/map_hub.php?mid=9122">http://nalicity.beyondunreal.com/map_hub.php?mid=9122</a></p>
<p>on the left are normal screenshots of the map and on the right are screenshots with the unrealscript renderer</p>
<p><img alt="[compare_00]" src="images/compare-00.jpeg" class="image-inline"></p>
<p><img alt="[compare_01]" src="images/compare-01.jpeg" class="image-inline"></p>
<h3><a name="0.1.3"></a>Future plans</h3>
<p>volumetric and raytraced fog and possibly some additional lighting effects like coronas or bloom</p>
<p>will probably move this to 2k4 for performance reasons</p>
<h3><a name="0.1.4"></a>The Code</h3>
<table border=0 cellspacing=0 cellpadding=0 class="wookee-expandable"><tr><td valign=top><p>Light Calculation</p>
</td>
<td valign=top>&nbsp;<a class="wookee-expandable-label" labelfor="wookee-expandable-44" onclick="toggleElementExpanded(event);">&gt;&gt;</a></td>
</tr>
</table>
<div id="wookee-expandable-44" class="wookee-expandable-body expandable"><pre class="uscript"><span class="uscript-comment">//Made By UArch ;P</span>
<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> calclighting<span class="uscript-operator">(</span>actor a<span class="uscript-operator">,</span>vector loc<span class="uscript-operator">,</span>vector norm<span class="uscript-operator">,</span>vector mirror<span class="uscript-operator">,</span><span class="uscript-keyword">out</span> color lightcolor<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> lr<span class="uscript-operator">,</span>lg<span class="uscript-operator">,</span>lb<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> fscale<span class="uscript-operator">;</span> <span class="uscript-comment">//fogdist thingy</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> <span class="uscript-operator">dot</span><span class="uscript-operator">,</span>dotm<span class="uscript-operator">;</span> <span class="uscript-comment">//dot and specular dot</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> dist<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> vector dir<span class="uscript-operator">;</span> <span class="uscript-comment">//direction from the "sample location" to lightsource</span>
    <span class="uscript-keyword">local</span> urlight l<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> specstart<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">bool</span> bshad<span class="uscript-operator">,</span>bspec<span class="uscript-operator">,</span>bdfog<span class="uscript-operator">,</span>bvfog<span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>a<span class="uscript-operator">==</span><span class="uscript-keyword">none</span><span class="uscript-operator">)</span> <span class="uscript-comment">//ph33r</span>
    <span class="uscript-keyword">return</span><span class="uscript-operator">;</span>

    bshad<span class="uscript-operator">=</span><span class="uscript-keyword">class</span><span class="uscript-name">'ursettings'</span><span class="uscript-operator">.</span><span class="uscript-keyword">default</span><span class="uscript-operator">.</span>shadows<span class="uscript-operator">;</span>
    bspec<span class="uscript-operator">=</span><span class="uscript-keyword">class</span><span class="uscript-name">'ursettings'</span><span class="uscript-operator">.</span><span class="uscript-keyword">default</span><span class="uscript-operator">.</span>specular<span class="uscript-operator">;</span>
    bdfog<span class="uscript-operator">=</span><span class="uscript-keyword">class</span><span class="uscript-name">'ursettings'</span><span class="uscript-operator">.</span><span class="uscript-keyword">default</span><span class="uscript-operator">.</span>DistanceFog<span class="uscript-operator">;</span>

    <span class="uscript-keyword">foreach</span> a<span class="uscript-operator">.</span>radiusactors<span class="uscript-operator">(</span><span class="uscript-keyword">class</span><span class="uscript-name">'urlight'</span><span class="uscript-operator">,</span>l<span class="uscript-operator">,</span><span class="uscript-number">8192</span><span class="uscript-operator">,</span>loc<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>

        <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingradius<span class="uscript-operator">&lt;=</span><span class="uscript-number">0</span><span class="uscript-operator">||</span><span class="uscript-operator">(</span><span class="uscript-operator">!</span>l<span class="uscript-operator">.</span>bfixeddir<span class="uscript-operator">&amp;&amp;</span>vsize<span class="uscript-operator">(</span>loc<span class="uscript-operator">-</span>l<span class="uscript-operator">.</span>location<span class="uscript-operator">)</span><span class="uscript-operator">&gt;=</span>l<span class="uscript-operator">.</span>lightingradius<span class="uscript-operator">)</span><span class="uscript-operator">||</span><span class="uscript-operator">(</span>bshad<span class="uscript-operator">&amp;&amp;</span>l<span class="uscript-operator">.</span>bcastshadows<span class="uscript-operator">&amp;&amp;</span><span class="uscript-operator">!</span>a<span class="uscript-operator">.</span>fasttrace<span class="uscript-operator">(</span>loc<span class="uscript-operator">,</span>l<span class="uscript-operator">.</span>location<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span>
            <span class="uscript-keyword">continue</span><span class="uscript-operator">;</span>

        dir <span class="uscript-operator">=</span> l<span class="uscript-operator">.</span>location<span class="uscript-operator">-</span>loc<span class="uscript-operator">;</span>

        <span class="uscript-operator">dot</span> <span class="uscript-operator">=</span> normal<span class="uscript-operator">(</span>dir<span class="uscript-operator">)</span> <span class="uscript-operator">dot</span> normal<span class="uscript-operator">(</span>norm<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

        <span class="uscript-keyword">if</span><span class="uscript-operator">(</span><span class="uscript-operator">dot</span><span class="uscript-operator">&lt;</span><span class="uscript-number">0</span><span class="uscript-operator">)</span>
            <span class="uscript-operator">dot</span><span class="uscript-operator">=</span><span class="uscript-number">0</span><span class="uscript-operator">;</span>

        specstart<span class="uscript-operator">=</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">-</span>l<span class="uscript-operator">.</span>specularlevel<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

        <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>specstart<span class="uscript-operator">&lt;</span><span class="uscript-number">1</span><span class="uscript-operator">&amp;&amp;</span>bspec<span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            dotm <span class="uscript-operator">=</span> normal<span class="uscript-operator">(</span>dir<span class="uscript-operator">)</span> <span class="uscript-operator">dot</span> normal<span class="uscript-operator">(</span>mirror<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

            <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>dotm<span class="uscript-operator">&lt;</span><span class="uscript-number">0</span><span class="uscript-operator">)</span>
                dotm<span class="uscript-operator">=</span><span class="uscript-number">0</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>

        dist <span class="uscript-operator">=</span> vsize<span class="uscript-operator">(</span>dir<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

        <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>bspotlight<span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            <span class="uscript-comment">//spotlight calc, not done yet</span>
        <span class="uscript-operator">}</span>
        <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>bfixeddir<span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            <span class="uscript-comment">//fixed directional light calc, not done yet</span>
        <span class="uscript-operator">}</span>
        <span class="uscript-keyword">else</span>
        <span class="uscript-operator">{</span>
            <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>bsimple<span class="uscript-operator">)</span>
            <span class="uscript-operator">{</span>

                lr<span class="uscript-operator">+=</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>r<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">-</span><span class="uscript-type">float</span><span class="uscript-operator">(</span>dist<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingradius<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-type">float</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>r<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-number">255</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
                lg<span class="uscript-operator">+=</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>g<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">-</span><span class="uscript-type">float</span><span class="uscript-operator">(</span>dist<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingradius<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-type">float</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>g<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-number">255</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
                lb<span class="uscript-operator">+=</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>b<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">-</span><span class="uscript-type">float</span><span class="uscript-operator">(</span>dist<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingradius<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-type">float</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>b<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-number">255</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

                <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>bspec<span class="uscript-operator">&amp;&amp;</span>dotm<span class="uscript-operator">&gt;=</span>specstart<span class="uscript-operator">)</span>
                <span class="uscript-operator">{</span>
                    lr<span class="uscript-operator">+=</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>r<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">/</span>specstart<span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span>dotm<span class="uscript-operator">-</span>specstart<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span>l<span class="uscript-operator">.</span>specularscale<span class="uscript-operator">;</span>
                    lg<span class="uscript-operator">+=</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>g<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">/</span>specstart<span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span>dotm<span class="uscript-operator">-</span>specstart<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span>l<span class="uscript-operator">.</span>specularscale<span class="uscript-operator">;</span>
                    lb<span class="uscript-operator">+=</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>b<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">/</span>specstart<span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span>dotm<span class="uscript-operator">-</span>specstart<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span>l<span class="uscript-operator">.</span>specularscale<span class="uscript-operator">;</span>
                <span class="uscript-operator">}</span>

            <span class="uscript-operator">}</span>
            <span class="uscript-keyword">else</span>
            <span class="uscript-operator">{</span>

                lr<span class="uscript-operator">+=</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>r<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">-</span><span class="uscript-type">float</span><span class="uscript-operator">(</span>dist<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingradius<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-type">float</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>r<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-number">255</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span>l<span class="uscript-operator">.</span>lightingscale<span class="uscript-operator">*</span><span class="uscript-operator">dot</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
                lg<span class="uscript-operator">+=</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>g<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">-</span><span class="uscript-type">float</span><span class="uscript-operator">(</span>dist<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingradius<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-type">float</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>g<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-number">255</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span>l<span class="uscript-operator">.</span>lightingscale<span class="uscript-operator">*</span><span class="uscript-operator">dot</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
                lb<span class="uscript-operator">+=</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>b<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">-</span><span class="uscript-type">float</span><span class="uscript-operator">(</span>dist<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingradius<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-type">float</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>b<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-number">255</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span>l<span class="uscript-operator">.</span>lightingscale<span class="uscript-operator">*</span><span class="uscript-operator">dot</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

                <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>bspec<span class="uscript-operator">&amp;&amp;</span>dotm<span class="uscript-operator">&gt;=</span>specstart<span class="uscript-operator">)</span>
                <span class="uscript-operator">{</span>
                    lr<span class="uscript-operator">+=</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>r<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">/</span>specstart<span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span>dotm<span class="uscript-operator">-</span>specstart<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span>l<span class="uscript-operator">.</span>specularscale<span class="uscript-operator">;</span>
                    lg<span class="uscript-operator">+=</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>g<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">/</span>specstart<span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span>dotm<span class="uscript-operator">-</span>specstart<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span>l<span class="uscript-operator">.</span>specularscale<span class="uscript-operator">;</span>
                    lb<span class="uscript-operator">+=</span><span class="uscript-operator">(</span>l<span class="uscript-operator">.</span>lightingcolor<span class="uscript-operator">.</span>b<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">/</span>specstart<span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span>dotm<span class="uscript-operator">-</span>specstart<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span>l<span class="uscript-operator">.</span>specularscale<span class="uscript-operator">;</span>
                <span class="uscript-operator">}</span>

            <span class="uscript-operator">}</span>

        <span class="uscript-operator">}</span>

    <span class="uscript-operator">}</span>

    <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>bdfog<span class="uscript-operator">&amp;&amp;</span>a<span class="uscript-operator">.</span>level<span class="uscript-operator">.</span>fogdistance<span class="uscript-operator">&gt;</span><span class="uscript-number">0</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        fscale <span class="uscript-operator">=</span> fmin<span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">,</span>vsize<span class="uscript-operator">(</span>loc<span class="uscript-operator">-</span>a<span class="uscript-operator">.</span>location<span class="uscript-operator">)</span><span class="uscript-operator">/</span>a<span class="uscript-operator">.</span>level<span class="uscript-operator">.</span>fogdistance<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

        lr<span class="uscript-operator">=</span>lr<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">-</span>fscale<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        lg<span class="uscript-operator">=</span>lg<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">-</span>fscale<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        lb<span class="uscript-operator">=</span>lb<span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">-</span>fscale<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

        lr<span class="uscript-operator">+=</span>a<span class="uscript-operator">.</span>level<span class="uscript-operator">.</span>fogcolor<span class="uscript-operator">.</span>r<span class="uscript-operator">*</span>fscale<span class="uscript-operator">;</span>
        lg<span class="uscript-operator">+=</span>a<span class="uscript-operator">.</span>level<span class="uscript-operator">.</span>fogcolor<span class="uscript-operator">.</span>g<span class="uscript-operator">*</span>fscale<span class="uscript-operator">;</span>
        lb<span class="uscript-operator">+=</span>a<span class="uscript-operator">.</span>level<span class="uscript-operator">.</span>fogcolor<span class="uscript-operator">.</span>b<span class="uscript-operator">*</span>fscale<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>

    lightcolor<span class="uscript-operator">.</span>r<span class="uscript-operator">=</span>min<span class="uscript-operator">(</span><span class="uscript-number">255</span><span class="uscript-operator">,</span>lr<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    lightcolor<span class="uscript-operator">.</span>g<span class="uscript-operator">=</span>min<span class="uscript-operator">(</span><span class="uscript-number">255</span><span class="uscript-operator">,</span>lg<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    lightcolor<span class="uscript-operator">.</span>b<span class="uscript-operator">=</span>min<span class="uscript-operator">(</span><span class="uscript-number">255</span><span class="uscript-operator">,</span>lb<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre></div>
<h3><a name="0.1.5"></a>Version 3</h3>
<p>this was actually done quite a while ago but i forgot to update this page</p>
<p>version 3 features volumetric lighting, soft shadows ambient occlusion, fisheye and panoramic rendering and also a crappy global illumination method which pushes the render time up by several hours..and doesnt look too great either <img alt=":P" src="emoticons/tongue.gif" align="middle"> having soft shadows and gi basically makes it non-realtime since it takes too long to render each frame</p>
<h2><a name="0.2"></a>pics:</h2>
<div class="floatimages"><table border=0 cellspacing=0 cellpadding=0 width="100%"><tr valign=top><td class="floatimages-left" align=left width=1><div><img alt="[pass_materials]" src="images/pass-materials.jpeg"><p>solid color material pass</p>
</div>
<div><img alt="[pass_light]" src="images/pass-light.jpeg"><p>lighting pass</p>
</div>
<div><img alt="[pass_softlight]" src="images/pass-softlight.jpeg"><p>lighting with soft shadows</p>
</div>
<div><img alt="[pass_volumetric]" src="images/pass-volumetric.jpeg"><p>volumetric light, i know..it looks terrible <img alt=";)" src="emoticons/wink.gif" align="middle"> plenty of artifacts here</p>
</div>
<div><img alt="[pass_gi]" src="images/pass-gi.jpeg"><p>global illumination pass</p>
</div>
</td>
<td class="floatimages-text" width="100%"><div class="floatimages"><table border=0 cellspacing=0 cellpadding=0 align=center width=1><tr valign=top><td class="floatimages-block"><div><img alt="[roomrender_color]" src="images/roomrender-color.jpeg"><p>Completed render using all features, this was rendered at 800x600 and took about 9 hours, the global illumination is very noisy and doesnt reflect color just brightness</p>
</div>
<div><img alt="[globalillum_fisheye]" src="images/globalillum-fisheye.jpeg"><p>global illumination test</p>
</div>
<div><img alt="[panoramic_2]" src="images/panoramic-2.jpeg"><p>panoramic render test</p>
</div>
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="floatimages"><table border=0 cellspacing=0 cellpadding=0 width="100%"><tr valign=top><td class="floatimages-left" align=left width=1><div><img alt="[pass_final]" src="images/pass-final.jpeg"><p>final scene rendered at 800x600 with high settings, i cant remember how long this took, i left it on overnight <img alt=":P" src="emoticons/tongue.gif" align="middle"></p>
</div>
</td>
<td class="floatimages-text" width="100%"></td>
</tr>
</table>
</div>
<h2><a name="0.3"></a>Todo:</h2>
<p>work on the realtime renderer a bit more</p>
<p>add better(more evenly distributed) raytracing for soft shadows and global illumination</p>
<p>translucent materials</p>
<p>anti aliasing</p>
<h2><a name="0.4"></a>Feedback</h2>
<p><em class="em2">Xian:</em> WOW, very impressive. I look forward to seeing the next version, keep up the good work <img alt=":)" src="emoticons/smile.gif" align="middle"> It's nice to see another fellow UT developer, since so many moved to UE2 (UT2004 in particular).</p>
<p><em class="em2">UArch</em> should probably update this at some point, light calculation code above is old and..well..crap <img alt=";)" src="emoticons/wink.gif" align="middle"></p>
<p><em class="em2">UArch</em> should have a nifty update to this code soon, added some optimizations to the renderer mostly to do with soft shadowing and gi, added support for "plug-ins" (dynamically loaded static-classes to add custom ray-tracing methods and such)</p>
<p>gi is still really noisy and well...it sucks to put it simple ;P i need to find an even hackier and faster method!..in uscript i think this may be an impossibility</p>
<script type="text/javascript"><!--
 menuItemAdd("UnrealScript Renderer", "#0.1");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>First Test version", "#0.1.1");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Second version", "#0.1.2");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Future plans", "#0.1.3");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>The Code", "#0.1.4");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Version 3", "#0.1.5");
menuItemAdd("pics:", "#0.2");
menuItemAdd("Todo:", "#0.3");
menuItemAdd("Feedback", "#0.4");
 menuWrite() //--></script></div>
</div>

<div id="footer" class="bar">
	<p>
<a href="../index.html">Home Page</a> | <a href="uarch.html">UArch</a> | <a href="recent-changes.html">Recent Changes</a><br>
Last edited March 31, 2007 4:54 <a href="http://wiki.beyondunreal.com/wiki?action=browse&diff=1&id=UArch/USRender">(diff)</a><br>Search: <input type="text" name="search"  size="14" /><input type="button" onclick="location.href='../search-error/index.html';" value="search" /><br><br><small><a href="http://wiki.beyondunreal.com/wiki/UArch/USRender">Original page</a> &#150; copy created Sat, Jun 23, 2007</small><div></div>

	</p>
	<p>Worst-case scenario: the UEd Goblin wipes the map and burns down your house.
</p>
</div>
</div><!-- close of "scrolling" div -->

<div id="quickbar">
	<div id="logo"><a href="../index.html"><img src="shared/wikilogo.jpg" width="143" height="100" border="0"></a>
		</div>
	<div class="qbsitename">
		<p>The Unreal Engine Documentation Site</p>
	</div>
	<div class="qbsection">
<p><a href="metatopics.html">Wiki Community</a></p>
<p><a href="category-category.html">Topic Categories</a></p>


<p><a href="recent-changes.html">Recent Changes</a></p>
<p><a href="offline-wiki.html">Offline Wiki</a></p>
</div><div class="qbsection">
<p><a href="unreal-engine.html">Unreal Engine</a></p>
<p><a href="console-commands.html">Console Commands</a></p>
<p><a href="terminology.html">Terminology</a></p>
<p><a href="category-faq.html">FAQs</a></p>
<p><a href="help-desk.html">Help Desk</a></p>
</div><div class="qbsection">
<p><a href="topics-on-mapping.html">Mapping Topics</a></p>
<p><a href="mapping-lessons.html">Mapping Lessons</a></p>
<p><a href="unrealed-3.html">UnrealEd Interface</a></p>
</div><div class="qbsection">
<p><a href="unrealscript.html">UnrealScript Topics</a></p>
<p><a href="unrealscript-lessons.html">UnrealScript Lessons</a></p>
<p><a href="making-mods.html">Making Mods</a></p>
<p><a href="class-tree.html">Class Tree</a></p>
</div><div class="qbsection">
<p><a href="topics-on-modeling.html">Modeling Topics</a></p>
</div><div class="qbsection">
<p><a href="chongqing-page.html">Chongqing Page</a></p>
<p><a href="log-in.html">Log In</a></p></div>
</div>

</body></html>
