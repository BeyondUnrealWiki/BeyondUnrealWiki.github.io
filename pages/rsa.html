<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head lang="en">
	<title>UnrealWiki: RSA</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<link rel="stylesheet" type="text/css" media="screen, print"
		href="shared/stylebase.structural.css">	
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/template-default.css">
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/styles.chblue.css">
	<link rel="stylesheet" type="text/css" media="print"
		href="shared/template-default-print.css">
	<!--[if IE 6]>
			<style>
			/* dirty hack for IE6. */
			#quickbar {
				position: absolute;
				}
			</style>
	<![endif]-->
  <link rel="start" href="http://wiki.beyondunreal.com/">
  <link rel="glossary"  href="http://wiki.beyondunreal.com/wiki/Terminology">
  <link rel="help"  href="http://wiki.beyondunreal.com/wiki/Using_The_Wiki">
<script type="text/javascript" src="shared/dhtml.js"></script>
<script type="text/javascript" src="shared/dhtml-menu.js"></script>
<style type="text/css">#dhtml-menu    { background: #eee; padding: 5px 0px; margin-right: -20px; border: 1px solid #888; border-left: 1px solid #ccc; border-top: 1px solid #ccc;  border-right: 1px solid #888; border-bottom: 1px solid #888 }
#dhtml-menu td { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; padding: 1px 10px; cursor: default }
#dhtml-menu a  { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; text-decoration: none }
#dhtml-menu tt { font-family: monospace; font-size: 9pt }
#dhtml-menu-separator { height: 1px; background: red }
#dhtml-menu-anchor { cursor: default }
</style>
<script type="text/javascript" src="shared/expandable.js"></script>
</head>
<body onLoad="menuInit(); document.cookie='page=RSA; path=/'" class="default">
<div id="scrolling"><!-- contains all except the fixed sidebar -->
<div id="topbar"  class="bar">
	<div class="righthalf">
		<input type="text" name="search"  size="14" /> <input type="button" onclick="location.href='../search-error/index.html';" value="search" />
	</div>
	<div class="lefthalf">
		<script type="text/javascript"><!--
			menuAlignRight = false;
		//--></script>
		<span><script type="text/javascript"><!--
 menuWriteAnchor("Quick Navigation") //--></script></span> | <a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a>
	</div>
</div>

<div id="content"><!-- contains the title and article -->
	<h1 class='pagetitle'><a href="http://wiki.beyondunreal.com/wiki?back=RSA">RSA</a></h1>
	<div class="wiki"><p>R.S.A. stands for Rivest, Shamir and Adleman - the three cryptographers who invented this public key cryptosystem. </p>
<p>For information about RSA encryption see  <span class="interwiki"><img 
      alt="Wikipedia logo"
      title="Wikipedia"
      src="shared//InterWiki-Wikipedia.png">&nbsp;<a href="http://www.wikipedia.com/wiki/RSA">RSA</a></span> and the related documents section below.</p>
<h2><a name="0.1"></a>Code</h2>
<p>This code uses integers, integers are 32bit in UnrealScript. Because of this the encryption as shown in the document isn't very secure. The improved code can have encryption up to 23bit, the previous implementation was limited to 13bits.</p>
<p>Using floats is not an option because they will lose signification at a certain point.</p>
<h3><a name="0.1.1"></a>PowerMod</h3>
<p>Support function to calculate <code>b^e mod m</code>. Because float signification you can't just use <code>C**D%N</code></p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">int</span> PowerMod<span class="uscript-operator">(</span><span class="uscript-type">int</span> C<span class="uscript-operator">,</span> <span class="uscript-type">int</span> D<span class="uscript-operator">,</span> <span class="uscript-type">int</span> N<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> p<span class="uscript-operator">;</span>
    c <span class="uscript-operator">=</span> mod<span class="uscript-operator">(</span>c<span class="uscript-operator">,</span> n<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>c <span class="uscript-operator">&lt;</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span> c <span class="uscript-operator">+=</span> n<span class="uscript-operator">;</span>
    p <span class="uscript-operator">=</span> <span class="uscript-number">1</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">while</span> <span class="uscript-operator">(</span>d <span class="uscript-operator">&gt;=</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>d <span class="uscript-operator">&amp;</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span> <span class="uscript-operator">==</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span> p <span class="uscript-operator">=</span> mulmod<span class="uscript-operator">(</span>c<span class="uscript-operator">,</span> p<span class="uscript-operator">,</span> n<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        c <span class="uscript-operator">=</span> mulmod<span class="uscript-operator">(</span>c<span class="uscript-operator">,</span> c<span class="uscript-operator">,</span> n<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        d <span class="uscript-operator">=</span> d <span class="uscript-operator">/</span> <span class="uscript-number">2</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">return</span> p<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">int</span> mulmod<span class="uscript-operator">(</span><span class="uscript-type">int</span> C<span class="uscript-operator">,</span> <span class="uscript-type">int</span> D<span class="uscript-operator">,</span> <span class="uscript-type">int</span> N<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> p<span class="uscript-operator">;</span>
    c <span class="uscript-operator">=</span> mod<span class="uscript-operator">(</span>c<span class="uscript-operator">,</span> n<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>c <span class="uscript-operator">&lt;</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span> c <span class="uscript-operator">+=</span> n<span class="uscript-operator">;</span>
    p <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">while</span> <span class="uscript-operator">(</span>d <span class="uscript-operator">&gt;=</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>d <span class="uscript-operator">&amp;</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span> <span class="uscript-operator">==</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span> p <span class="uscript-operator">=</span> mod<span class="uscript-operator">(</span>c <span class="uscript-operator">+</span> p<span class="uscript-operator">,</span> n<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        c <span class="uscript-operator">=</span> mod<span class="uscript-operator">(</span>c <span class="uscript-operator">*</span> <span class="uscript-number">2</span><span class="uscript-operator">,</span> n<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        d <span class="uscript-operator">=</span> d <span class="uscript-operator">/</span> <span class="uscript-number">2</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">return</span> p<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-comment">/**
 * int precision modulo function.
 * Like the % operator, this function returns a negative result for negative a.
 */</span>
<span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">int</span> mod<span class="uscript-operator">(</span><span class="uscript-type">int</span> a<span class="uscript-operator">,</span> <span class="uscript-type">int</span> n<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">return</span> a <span class="uscript-operator">-</span> <span class="uscript-operator">(</span>a <span class="uscript-operator">/</span> n<span class="uscript-operator">)</span> <span class="uscript-operator">*</span> n<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h3><a name="0.1.2"></a>_RSAGCD</h3>
<p>A private function to calculate the Greatest Common Divider, this is use to calculate the encryption key</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">private</span> <span class="uscript-keyword">function</span> <span class="uscript-type">int</span> _RSAGCD<span class="uscript-operator">(</span><span class="uscript-type">int</span> e<span class="uscript-operator">,</span> <span class="uscript-type">int</span> PHI<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> great<span class="uscript-operator">,</span> a<span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>e <span class="uscript-operator">&gt;</span> PHI<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        <span class="uscript-keyword">while</span> <span class="uscript-operator">(</span>mod<span class="uscript-operator">(</span>e<span class="uscript-operator">,</span> PHI<span class="uscript-operator">)</span> <span class="uscript-operator">!=</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            a <span class="uscript-operator">=</span> mod<span class="uscript-operator">(</span>e<span class="uscript-operator">,</span> PHI<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
            e <span class="uscript-operator">=</span> PHI<span class="uscript-operator">;</span>
            PHI <span class="uscript-operator">=</span> a<span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
        great <span class="uscript-operator">=</span> PHI<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span> <span class="uscript-operator">{</span>
        <span class="uscript-keyword">while</span> <span class="uscript-operator">(</span>mod<span class="uscript-operator">(</span>PHI<span class="uscript-operator">,</span> e<span class="uscript-operator">)</span> <span class="uscript-operator">!=</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            a <span class="uscript-operator">=</span> mod<span class="uscript-operator">(</span>PHI<span class="uscript-operator">,</span> e<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
            PHI <span class="uscript-operator">=</span> e<span class="uscript-operator">;</span>
            e <span class="uscript-operator">=</span> a<span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
        great <span class="uscript-operator">=</span> e<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">return</span> great<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h3><a name="0.1.3"></a>RSAEncodeKeygen</h3>
<p>This method will calculate the encryption key E from the prime numbers you supply.</p>
<p>P and Q have to be prime and unequal. N=P*Q and must be large enough to contain all possible values you need to encrypt..</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">int</span> RSAPublicKeygen<span class="uscript-operator">(</span><span class="uscript-type">int</span> p<span class="uscript-operator">,</span> <span class="uscript-type">int</span> q<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> PHI<span class="uscript-operator">,</span> E<span class="uscript-operator">,</span> great<span class="uscript-operator">;</span>
    PHI <span class="uscript-operator">=</span> <span class="uscript-operator">(</span>p<span class="uscript-number">-1</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span>q<span class="uscript-number">-1</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    great <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
    E <span class="uscript-operator">=</span> <span class="uscript-number">2</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">while</span> <span class="uscript-operator">(</span>great <span class="uscript-operator">!=</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        E<span class="uscript-operator">++</span><span class="uscript-operator">;</span>
        great <span class="uscript-operator">=</span> _RSAGCD<span class="uscript-operator">(</span>E<span class="uscript-operator">,</span> PHI<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">return</span> E<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h3><a name="0.1.4"></a>RSADecodeKeygen</h3>
<p>This will calculate the decrypt key D for the corresponding encrypt key</p>
<p>Use the same P and Q as you did with the encrypt key</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">int</span> RSAPrivateKeygen<span class="uscript-operator">(</span><span class="uscript-type">int</span> E<span class="uscript-operator">,</span> <span class="uscript-type">int</span> p<span class="uscript-operator">,</span> <span class="uscript-type">int</span> q<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> PHI<span class="uscript-operator">,</span> u1<span class="uscript-operator">,</span> u2<span class="uscript-operator">,</span> u3<span class="uscript-operator">,</span> v1<span class="uscript-operator">,</span> v2<span class="uscript-operator">,</span> v3<span class="uscript-operator">,</span> t1<span class="uscript-operator">,</span> t2<span class="uscript-operator">,</span> t3<span class="uscript-operator">,</span> z<span class="uscript-operator">;</span>
    PHI <span class="uscript-operator">=</span> <span class="uscript-operator">(</span>p<span class="uscript-number">-1</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span>q<span class="uscript-number">-1</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    u1 <span class="uscript-operator">=</span> <span class="uscript-number">1</span><span class="uscript-operator">;</span>
    u2 <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
    u3 <span class="uscript-operator">=</span> PHI<span class="uscript-operator">;</span>
    v1 <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
    v2 <span class="uscript-operator">=</span> <span class="uscript-number">1</span><span class="uscript-operator">;</span>
    v3 <span class="uscript-operator">=</span> E<span class="uscript-operator">;</span>
    <span class="uscript-keyword">while</span> <span class="uscript-operator">(</span>v3 <span class="uscript-operator">!=</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        z <span class="uscript-operator">=</span> u3<span class="uscript-operator">/</span>v3<span class="uscript-operator">;</span>
        t1 <span class="uscript-operator">=</span> u1<span class="uscript-operator">-</span>z<span class="uscript-operator">*</span>v1<span class="uscript-operator">;</span>
        t2 <span class="uscript-operator">=</span> u2<span class="uscript-operator">-</span>z<span class="uscript-operator">*</span>v2<span class="uscript-operator">;</span>
        t3 <span class="uscript-operator">=</span> u3<span class="uscript-operator">-</span>z<span class="uscript-operator">*</span>v3<span class="uscript-operator">;</span>
        u1 <span class="uscript-operator">=</span> v1<span class="uscript-operator">;</span>
        u2 <span class="uscript-operator">=</span> v2<span class="uscript-operator">;</span>
        u3 <span class="uscript-operator">=</span> v3<span class="uscript-operator">;</span>
        v1 <span class="uscript-operator">=</span> t1<span class="uscript-operator">;</span>
        v2 <span class="uscript-operator">=</span> t2<span class="uscript-operator">;</span>
        v3 <span class="uscript-operator">=</span> t3<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>u2 <span class="uscript-operator">&lt;</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        <span class="uscript-keyword">return</span> u2 <span class="uscript-operator">+</span> PHI<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span> <span class="uscript-operator">{</span>
        <span class="uscript-keyword">return</span> u2<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
<span class="uscript-operator">}</span></pre><h3><a name="0.1.5"></a>NumBits</h3>
<p>This will return the number of bits used in an integer. </p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">int</span> NumBits<span class="uscript-operator">(</span><span class="uscript-type">int</span> sample<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> bits<span class="uscript-operator">;</span>
    bits <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">while</span> <span class="uscript-operator">(</span>sample <span class="uscript-operator">&gt;</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        sample <span class="uscript-operator">=</span> sample <span class="uscript-operator">&gt;&gt;&gt;</span> <span class="uscript-number">1</span><span class="uscript-operator">;</span>
        bits<span class="uscript-operator">++</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">return</span> bits<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h3><a name="0.1.6"></a>RSAEncodeStream</h3>
<p>This will encode the string using the keys E and N <code>(=P*Q)</code>. the output will be stored in the int array data2.</p>
<p>It will automactially adjust to window size according to the size of N. When N is more than 15 bits two characters will put in a single integer.</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> RSAEncodeStream<span class="uscript-operator">(</span><span class="uscript-keyword">coerce</span> <span class="uscript-type">string</span> data<span class="uscript-operator">,</span> <span class="uscript-type">int</span> E<span class="uscript-operator">,</span> <span class="uscript-type">int</span> N<span class="uscript-operator">,</span> <span class="uscript-keyword">out</span> <span class="uscript-keyword">array</span><span class="uscript-operator">&lt;</span><span class="uscript-type">int</span><span class="uscript-operator">&gt;</span> data2<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> i<span class="uscript-operator">,</span> c<span class="uscript-operator">,</span> window<span class="uscript-operator">,</span> j<span class="uscript-operator">;</span>
    window <span class="uscript-operator">=</span> NumBits<span class="uscript-operator">(</span>N<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-number">8</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">for</span> <span class="uscript-operator">(</span>i <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span> i <span class="uscript-operator">&lt;</span> len<span class="uscript-operator">(</span>data<span class="uscript-operator">)</span><span class="uscript-operator">;</span> i <span class="uscript-operator">=</span> i<span class="uscript-operator">+</span>window<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        c <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
        <span class="uscript-keyword">for</span> <span class="uscript-operator">(</span>j <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span> j <span class="uscript-operator">&lt;</span> window<span class="uscript-operator">;</span> j<span class="uscript-operator">++</span><span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            c <span class="uscript-operator">+=</span> Asc<span class="uscript-operator">(</span>Mid<span class="uscript-operator">(</span>data<span class="uscript-operator">,</span>i<span class="uscript-operator">+</span>j<span class="uscript-operator">,</span><span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">&lt;&lt;</span> <span class="uscript-operator">(</span>window<span class="uscript-operator">-</span>j<span class="uscript-number">-1</span><span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-number">8</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
        data2<span class="uscript-operator">[</span>data2<span class="uscript-operator">.</span><span class="uscript-keyword">length</span><span class="uscript-operator">]</span> <span class="uscript-operator">=</span> PowerMod<span class="uscript-operator">(</span>c<span class="uscript-operator">,</span>E<span class="uscript-operator">,</span>N<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
<span class="uscript-operator">}</span></pre><h3><a name="0.1.7"></a>RSADecodeStream</h3>
<p>This will decrypt the array data to the correct string value.</p>
<p>It will automactially adjust to window size according to the size of N.</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">string</span> RSADecodeStream<span class="uscript-operator">(</span><span class="uscript-keyword">array</span><span class="uscript-operator">&lt;</span><span class="uscript-type">int</span><span class="uscript-operator">&gt;</span> data<span class="uscript-operator">,</span> <span class="uscript-type">int</span> D<span class="uscript-operator">,</span> <span class="uscript-type">int</span> N<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> i<span class="uscript-operator">,</span> c<span class="uscript-operator">,</span> window<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">string</span> result<span class="uscript-operator">;</span>
    window <span class="uscript-operator">=</span> NumBits<span class="uscript-operator">(</span>N<span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-number">8</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">for</span> <span class="uscript-operator">(</span>i <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span> i <span class="uscript-operator">&lt;</span> data<span class="uscript-operator">.</span><span class="uscript-keyword">length</span><span class="uscript-operator">;</span> i<span class="uscript-operator">++</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        c <span class="uscript-operator">=</span> PowerMod<span class="uscript-operator">(</span>data<span class="uscript-operator">[</span>i<span class="uscript-operator">]</span><span class="uscript-operator">,</span>D<span class="uscript-operator">,</span>N<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>window <span class="uscript-operator">&gt;</span> <span class="uscript-number">3</span><span class="uscript-operator">)</span> result <span class="uscript-operator">$</span><span class="uscript-operator">=</span> chr<span class="uscript-operator">(</span><span class="uscript-operator">(</span>c <span class="uscript-operator">&amp;</span> <span class="uscript-number">0xff000000</span><span class="uscript-operator">)</span> <span class="uscript-operator">&gt;&gt;</span> <span class="uscript-number">24</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>window <span class="uscript-operator">&gt;</span> <span class="uscript-number">2</span><span class="uscript-operator">)</span> result <span class="uscript-operator">$</span><span class="uscript-operator">=</span> chr<span class="uscript-operator">(</span><span class="uscript-operator">(</span>c <span class="uscript-operator">&amp;</span> <span class="uscript-number">0x00ff0000</span><span class="uscript-operator">)</span> <span class="uscript-operator">&gt;&gt;</span> <span class="uscript-number">16</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>window <span class="uscript-operator">&gt;</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span> result <span class="uscript-operator">$</span><span class="uscript-operator">=</span> chr<span class="uscript-operator">(</span><span class="uscript-operator">(</span>c <span class="uscript-operator">&amp;</span> <span class="uscript-number">0x0000ff00</span><span class="uscript-operator">)</span> <span class="uscript-operator">&gt;&gt;</span> <span class="uscript-number">8</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        result <span class="uscript-operator">$</span><span class="uscript-operator">=</span> chr<span class="uscript-operator">(</span><span class="uscript-operator">(</span>c <span class="uscript-operator">&amp;</span> <span class="uscript-number">0x000000ff</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">return</span> result<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h2><a name="0.2"></a>Example usage</h2>
<p>Here's an example that creates the keys, encrypts and decrypts and checks if they're equal. It will also print the encrypted data.</p>
<pre class="uscript"><span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> EncTest<span class="uscript-operator">(</span><span class="uscript-type">int</span> p<span class="uscript-operator">,</span> <span class="uscript-type">int</span> q<span class="uscript-operator">,</span> <span class="uscript-type">string</span> testData<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">string</span> s2<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> n<span class="uscript-operator">,</span>e<span class="uscript-operator">,</span>d<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> <span class="uscript-keyword">array</span><span class="uscript-operator">&lt;</span><span class="uscript-type">int</span><span class="uscript-operator">&gt;</span> ia<span class="uscript-operator">;</span>

    n <span class="uscript-operator">=</span> p<span class="uscript-operator">*</span>q<span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>NumBits<span class="uscript-operator">(</span>N<span class="uscript-operator">)</span> <span class="uscript-operator">&lt;</span> <span class="uscript-number">8</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        warn<span class="uscript-operator">(</span><span class="uscript-string">"Not enough bits for encrypting the data"</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        <span class="uscript-keyword">return</span> <span class="uscript-keyword">false</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>

    e <span class="uscript-operator">=</span> RSAEncodeKeygen<span class="uscript-operator">(</span>p<span class="uscript-operator">,</span> q<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    d <span class="uscript-operator">=</span> RSADecodeKeygen<span class="uscript-operator">(</span>e<span class="uscript-operator">,</span> p<span class="uscript-operator">,</span> q<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    log<span class="uscript-operator">(</span><span class="uscript-string">"p="</span><span class="uscript-operator">$</span>p<span class="uscript-operator">@</span><span class="uscript-string">"q="</span><span class="uscript-operator">$</span>q<span class="uscript-operator">@</span><span class="uscript-string">"n="</span><span class="uscript-operator">$</span>n<span class="uscript-operator">@</span><span class="uscript-string">"e="</span><span class="uscript-operator">$</span>e<span class="uscript-operator">@</span><span class="uscript-string">"d="</span><span class="uscript-operator">$</span>d<span class="uscript-operator">@</span><span class="uscript-string">"bits="</span><span class="uscript-operator">$</span>NumBits<span class="uscript-operator">(</span>N<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    log<span class="uscript-operator">(</span><span class="uscript-string">"Source:"</span><span class="uscript-operator">$</span>chr<span class="uscript-operator">(</span><span class="uscript-number">9</span><span class="uscript-operator">)</span><span class="uscript-operator">$</span>chr<span class="uscript-operator">(</span><span class="uscript-number">9</span><span class="uscript-operator">)</span><span class="uscript-operator">@</span>testData<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    RSAEncodeStream<span class="uscript-operator">(</span>testData<span class="uscript-operator">,</span> e<span class="uscript-operator">,</span> n<span class="uscript-operator">,</span> ia<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    log<span class="uscript-operator">(</span><span class="uscript-string">"Encrypted:"</span><span class="uscript-operator">$</span>chr<span class="uscript-operator">(</span><span class="uscript-number">9</span><span class="uscript-operator">)</span><span class="uscript-operator">@</span>printByteArray<span class="uscript-operator">(</span>ia<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    s2 <span class="uscript-operator">=</span> RSADecodeStream<span class="uscript-operator">(</span>ia<span class="uscript-operator">,</span> d<span class="uscript-operator">,</span> n<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    log<span class="uscript-operator">(</span><span class="uscript-string">"Decrypted:"</span><span class="uscript-operator">$</span>chr<span class="uscript-operator">(</span><span class="uscript-number">9</span><span class="uscript-operator">)</span><span class="uscript-operator">@</span>s2<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">return</span> s2 <span class="uscript-operator">==</span> testData<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>When called with <code>EncTest(2851, 2927, "012345 hello world")</code> it will output:</p>
<pre class="paraverbatim"> p=2851 q=2927 n=8344877 e=13 d=2565877 bits=23
 Source:          012345 hello world
 Encrypted:       001075070001d062007efb6800542d6800471922003fc53e00692eae005a3a310074b044
 Decrypted:       012345 hello world</pre><p>Note that I left in the values of <code>p</code> and <code>q</code> in the above example. You should remove the usage of <code>p</code> and <code>q</code> when you no longer need them. When you have decided what <code>p</code> and <code>q</code> to use calculate the <code>n</code>, <code>e</code> and <code>d</code> values and use them in the rest of your code.</p>
<h2><a name="0.3"></a>Comments</h2>
<p><em class="em2">Sixpack_Shambler:</em> Hmmmm....I've tried this code out and when I decrypt a string I don't even have to use the decrypt string to decrypt it, I just converted every signgle byte in the encrypted array to big string and it came out as EXACTLY the same string as what I put in <img alt=":/" src="emoticons/hmm.gif" align="middle"></p>
<p><em class="em2">El Muerte:</em> then you didn't pick correct prime numbers. I've improved the implementation, it can now encrypt up to 23bits, thus allowing a window size of 2 bytes.</p>
<p><em class="em2">UsAaR33:</em> Do you think it would be possible to perhaps rewrite some math algorithms?  With structures and some funky overloading, you could probably use much higher bit encryption.  Right now, you can factor out the private key in seconds...</p>
<p><em class="em2">El Muerte:</em> both me and PJMODOS once started on an BigInt implementation, but neither of use ever finished it (at least not ebough to have all required operators). But it should be possible to create a BigInt type, but it won't be as nice\fast as a C or Pascal implementation (w.r.t. normal execution time in unrealscript).</p>
<h2><a name="0.4"></a>Related documents</h2>
<ul><li><a href="http://pajhome.org.uk/crypt/rsa">http://pajhome.org.uk/crypt/rsa</a></li>
<li><a href="http://www.di-mgt.com.au/rsa_alg.html">http://www.di-mgt.com.au/rsa_alg.html</a></li>
</ul>
<h2><a name="0.5"></a>Related Topics</h2>
<ul><li><a href="open-source.html">Open Source</a></li>
<li><a href="wutils.html">WUtils</a></li>
</ul>
<hr class="thin"><p><a href="category-algorithm.html">Category Algorithm</a></p>
<script type="text/javascript"><!--
 menuItemAdd("Code", "#0.1");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>PowerMod", "#0.1.1");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>_RSAGCD", "#0.1.2");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>RSAEncodeKeygen", "#0.1.3");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>RSADecodeKeygen", "#0.1.4");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>NumBits", "#0.1.5");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>RSAEncodeStream", "#0.1.6");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>RSADecodeStream", "#0.1.7");
menuItemAdd("Example usage", "#0.2");
menuItemAdd("Comments", "#0.3");
menuItemAdd("Related documents", "#0.4");
menuItemAdd("Related Topics", "#0.5");
 menuWrite() //--></script></div>
</div>

<div id="footer" class="bar">
	<p>
<a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a><br>
Last edited October 27, 2006 14:21 <a href="http://wiki.beyondunreal.com/wiki?action=browse&diff=1&id=RSA">(diff)</a><br>Search: <input type="text" name="search"  size="14" /><input type="button" onclick="location.href='../search-error/index.html';" value="search" /><br><br><small><a href="http://wiki.beyondunreal.com/wiki/RSA">Original page</a> &#150; copy created Sat, Jun 23, 2007</small><div></div>

	</p>
	<p>I love the smell of UnrealEd crashing in the morning. (tarquin)</p>
</div>
</div><!-- close of "scrolling" div -->

<div id="quickbar">
	<div id="logo"><a href="../index.html"><img src="shared/wikilogo.jpg" width="143" height="100" border="0"></a>
		</div>
	<div class="qbsitename">
		<p>The Unreal Engine Documentation Site</p>
	</div>
	<div class="qbsection">
<p><a href="metatopics.html">Wiki Community</a></p>
<p><a href="category-category.html">Topic Categories</a></p>


<p><a href="recent-changes.html">Recent Changes</a></p>
<p><a href="offline-wiki.html">Offline Wiki</a></p>
</div><div class="qbsection">
<p><a href="unreal-engine.html">Unreal Engine</a></p>
<p><a href="console-commands.html">Console Commands</a></p>
<p><a href="terminology.html">Terminology</a></p>
<p><a href="category-faq.html">FAQs</a></p>
<p><a href="help-desk.html">Help Desk</a></p>
</div><div class="qbsection">
<p><a href="topics-on-mapping.html">Mapping Topics</a></p>
<p><a href="mapping-lessons.html">Mapping Lessons</a></p>
<p><a href="unrealed-3.html">UnrealEd Interface</a></p>
</div><div class="qbsection">
<p><a href="unrealscript.html">UnrealScript Topics</a></p>
<p><a href="unrealscript-lessons.html">UnrealScript Lessons</a></p>
<p><a href="making-mods.html">Making Mods</a></p>
<p><a href="class-tree.html">Class Tree</a></p>
</div><div class="qbsection">
<p><a href="topics-on-modeling.html">Modeling Topics</a></p>
</div><div class="qbsection">
<p><a href="chongqing-page.html">Chongqing Page</a></p>
<p><a href="log-in.html">Log In</a></p></div>
</div>

</body></html>
