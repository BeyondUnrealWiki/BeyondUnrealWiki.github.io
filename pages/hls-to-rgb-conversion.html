<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head lang="en">
	<title>UnrealWiki: HLS To RGB Conversion</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<link rel="stylesheet" type="text/css" media="screen, print"
		href="shared/stylebase.structural.css">	
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/template-default.css">
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/styles.chblue.css">
	<link rel="stylesheet" type="text/css" media="print"
		href="shared/template-default-print.css">
	<!--[if IE 6]>
			<style>
			/* dirty hack for IE6. */
			#quickbar {
				position: absolute;
				}
			</style>
	<![endif]-->
  <link rel="start" href="http://wiki.beyondunreal.com/">
  <link rel="glossary"  href="http://wiki.beyondunreal.com/wiki/Terminology">
  <link rel="help"  href="http://wiki.beyondunreal.com/wiki/Using_The_Wiki">
<script type="text/javascript" src="shared/dhtml.js"></script>
<script type="text/javascript" src="shared/dhtml-menu.js"></script>
<style type="text/css">#dhtml-menu    { background: #eee; padding: 5px 0px; margin-right: -20px; border: 1px solid #888; border-left: 1px solid #ccc; border-top: 1px solid #ccc;  border-right: 1px solid #888; border-bottom: 1px solid #888 }
#dhtml-menu td { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; padding: 1px 10px; cursor: default }
#dhtml-menu a  { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; text-decoration: none }
#dhtml-menu tt { font-family: monospace; font-size: 9pt }
#dhtml-menu-separator { height: 1px; background: red }
#dhtml-menu-anchor { cursor: default }
</style>
<script type="text/javascript" src="shared/expandable.js"></script>
</head>
<body onLoad="menuInit(); document.cookie='page=HLS_To_RGB_Conversion; path=/'" class="default">
<div id="scrolling"><!-- contains all except the fixed sidebar -->
<div id="topbar"  class="bar">
	<div class="righthalf">
		<form class="inline" method="post" action="/wiki" enctype="application/x-www-form-urlencoded"><input type="text" name="search"  size="20" /> <input type="submit" name="search" value="search" /></form>
	</div>
	<div class="lefthalf">
		<script type="text/javascript"><!--
			menuAlignRight = false;
		//--></script>
		<span><script type="text/javascript"><!--
 menuWriteAnchor("Quick Navigation") //--></script></span> | <a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a>
	</div>
</div>

<div id="content"><!-- contains the title and article -->
	<h1 class='pagetitle'><a href="http://wiki.beyondunreal.com/wiki?back=HLS To RGB Conversion">HLS To RGB Conversion</a></h1>
	<div class="wiki"><p>This set of functions can convert HLS values to RGB.  hls2rgb takes the byte values of Hue, Luminosity, and Saturation and returns the Color it represents.  (HueToRGB is a support function for the main conversion.)</p>
<p>Very liberally adapted from <a href="http://plaza27.mbn.or.jp/~satomii/design/win32/hls2rgb.html">http://plaza27.mbn.or.jp/~satomii/design/win32/hls2rgb.html</a></p>
<blockquote><p><em class="em2">How to convert HLS value to RGB value?</em></p>
<p>This is an useful function extracted from Microsoft's old sample code, modified a little by Rei for her own product. Note that this code is copyrighted to Microsoft Corporation.</p>
<p class="indent1"><em class="em1">Quoted from that page.</em></p>
</blockquote><pre class="uscript"><span class="uscript-keyword">const</span> HLSMAX <span class="uscript-operator">=</span> <span class="uscript-number">240</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">const</span> RGBMAX <span class="uscript-operator">=</span> <span class="uscript-number">255</span><span class="uscript-operator">;</span>


<span class="uscript-keyword">final</span> <span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> <span class="uscript-type">float</span> HueToRGB<span class="uscript-operator">(</span><span class="uscript-type">float</span> n1<span class="uscript-operator">,</span> <span class="uscript-type">float</span> n2<span class="uscript-operator">,</span> <span class="uscript-type">float</span> hue<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> hue <span class="uscript-operator">&lt;</span> <span class="uscript-number">0</span> <span class="uscript-operator">)</span> hue <span class="uscript-operator">+=</span> HLSMAX<span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> hue <span class="uscript-operator">&gt;</span> HLSMAX <span class="uscript-operator">)</span> hue <span class="uscript-operator">-=</span> HLSMAX<span class="uscript-operator">;</span>

    <span class="uscript-comment">/* return r,g, or b value from this tridrant */</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> hue <span class="uscript-operator">&lt;</span> <span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">6</span><span class="uscript-operator">)</span> <span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span> <span class="uscript-operator">(</span> n1 <span class="uscript-operator">+</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span>n2<span class="uscript-operator">-</span>n1<span class="uscript-operator">)</span><span class="uscript-operator">*</span>hue <span class="uscript-operator">+</span> <span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">12</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">6</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> hue <span class="uscript-operator">&lt;</span> <span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">2</span><span class="uscript-operator">)</span> <span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span> n2<span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> hue <span class="uscript-operator">&lt;</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">*</span><span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-number">3</span><span class="uscript-operator">)</span> <span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span> <span class="uscript-operator">(</span> n1 <span class="uscript-operator">+</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span>n2<span class="uscript-operator">-</span>n1<span class="uscript-operator">)</span><span class="uscript-operator">*</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">*</span><span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-number">3</span><span class="uscript-operator">)</span><span class="uscript-operator">-</span>hue<span class="uscript-operator">)</span> <span class="uscript-operator">+</span> <span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">12</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">/</span><span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">6</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">else</span>
        <span class="uscript-keyword">return</span> n1<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>


<span class="uscript-keyword">final</span> <span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> Color hls2rgb<span class="uscript-operator">(</span><span class="uscript-type">byte</span> hue<span class="uscript-operator">,</span> <span class="uscript-type">byte</span> lum<span class="uscript-operator">,</span> <span class="uscript-type">byte</span> sat<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> Color C<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> Magic1<span class="uscript-operator">,</span> Magic2<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> R<span class="uscript-operator">,</span>G<span class="uscript-operator">,</span>B<span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> sat<span class="uscript-operator">==</span><span class="uscript-number">0</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>     <span class="uscript-comment">/* achromatic case */</span>
        C<span class="uscript-operator">.</span>R <span class="uscript-operator">=</span> <span class="uscript-operator">(</span>lum<span class="uscript-operator">*</span>RGBMAX<span class="uscript-operator">)</span> <span class="uscript-operator">/</span> HLSMAX<span class="uscript-operator">;</span>
        C<span class="uscript-operator">.</span>G <span class="uscript-operator">=</span> C<span class="uscript-operator">.</span>R<span class="uscript-operator">;</span>
        C<span class="uscript-operator">.</span>B <span class="uscript-operator">=</span> C<span class="uscript-operator">.</span>R<span class="uscript-operator">;</span>

        <span class="uscript-comment">/* Small fix */</span>
        R <span class="uscript-operator">=</span> C<span class="uscript-operator">.</span>R<span class="uscript-operator">;</span>
        G <span class="uscript-operator">=</span> C<span class="uscript-operator">.</span>G<span class="uscript-operator">;</span>
        B <span class="uscript-operator">=</span> C<span class="uscript-operator">.</span>B<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span>
    <span class="uscript-operator">{</span>       <span class="uscript-comment">/* chromatic case */</span>
        <span class="uscript-comment">/* set up magic numbers */</span>
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>lum <span class="uscript-operator">&lt;=</span> <span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span>
            Magic2 <span class="uscript-operator">=</span> <span class="uscript-operator">(</span>lum<span class="uscript-operator">*</span><span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">+</span>sat<span class="uscript-operator">)</span><span class="uscript-operator">+</span><span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> HLSMAX<span class="uscript-operator">;</span>
        <span class="uscript-keyword">else</span>
            Magic2 <span class="uscript-operator">=</span> lum<span class="uscript-operator">+</span>sat <span class="uscript-operator">-</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>lum<span class="uscript-operator">*</span>sat<span class="uscript-operator">)</span><span class="uscript-operator">+</span><span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> HLSMAX<span class="uscript-operator">;</span>

        Magic1 <span class="uscript-operator">=</span> <span class="uscript-number">2</span><span class="uscript-operator">*</span>lum <span class="uscript-operator">-</span> Magic2<span class="uscript-operator">;</span>

        <span class="uscript-comment">/* get RGB, change units from HLSMAX to RGBMAX */</span>
        R <span class="uscript-operator">=</span> <span class="uscript-operator">(</span>HueToRGB<span class="uscript-operator">(</span>Magic1<span class="uscript-operator">,</span> Magic2<span class="uscript-operator">,</span> hue<span class="uscript-operator">+</span><span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">3</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span>
                <span class="uscript-operator">*</span> RGBMAX <span class="uscript-operator">+</span> <span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> HLSMAX<span class="uscript-operator">;</span>
        G <span class="uscript-operator">=</span> <span class="uscript-operator">(</span>HueToRGB<span class="uscript-operator">(</span>Magic1<span class="uscript-operator">,</span> Magic2<span class="uscript-operator">,</span> hue<span class="uscript-operator">)</span>
                <span class="uscript-operator">*</span> RGBMAX <span class="uscript-operator">+</span> <span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> HLSMAX<span class="uscript-operator">;</span>
        B <span class="uscript-operator">=</span> <span class="uscript-operator">(</span>HueToRGB<span class="uscript-operator">(</span>Magic1<span class="uscript-operator">,</span> Magic2<span class="uscript-operator">,</span> hue<span class="uscript-operator">-</span><span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">3</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span>
                <span class="uscript-operator">*</span> RGBMAX <span class="uscript-operator">+</span> <span class="uscript-operator">(</span>HLSMAX<span class="uscript-operator">/</span><span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> HLSMAX<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>

    C<span class="uscript-operator">.</span>R <span class="uscript-operator">=</span> R<span class="uscript-operator">;</span>
    C<span class="uscript-operator">.</span>G <span class="uscript-operator">=</span> G<span class="uscript-operator">;</span>
    C<span class="uscript-operator">.</span>B <span class="uscript-operator">=</span> B<span class="uscript-operator">;</span>
    C<span class="uscript-operator">.</span>A <span class="uscript-operator">=</span> <span class="uscript-number">255</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">return</span> C<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><pre class="uscript"><span class="uscript-comment">// ============================================================================</span>
<span class="uscript-comment">// HLStoRGB</span>
<span class="uscript-comment">//</span>
<span class="uscript-comment">// Converts the given HLS color value to its RGB equivalent and returns it.</span>
<span class="uscript-comment">//</span>
<span class="uscript-comment">//   H   Hue          from 0 (red) over 80 (green) and 160 (blue) to 240 (red)</span>
<span class="uscript-comment">//   L   Lightness    from 0 (black) over 120 (full color) to 240 (white)</span>
<span class="uscript-comment">//   S   Saturation   from 0 (gray) to 240 (full color)</span>
<span class="uscript-comment">//</span>
<span class="uscript-comment">// Due to its use of the color scaling operator this function expects to be</span>
<span class="uscript-comment">// implemented in an Actor subclass.</span>
<span class="uscript-comment">// ============================================================================</span>

<span class="uscript-keyword">static</span> <span class="uscript-keyword">function</span> Color HLStoRGB<span class="uscript-operator">(</span><span class="uscript-type">int</span> H<span class="uscript-operator">,</span> <span class="uscript-type">int</span> L<span class="uscript-operator">,</span> <span class="uscript-type">int</span> S<span class="uscript-operator">)</span> <span class="uscript-operator">{</span>

  <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> OffsetLightness<span class="uscript-operator">;</span>
  <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> OffsetSaturation<span class="uscript-operator">;</span>
  <span class="uscript-keyword">local</span> Color Color<span class="uscript-operator">;</span>
  
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>H <span class="uscript-operator">&lt;</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span> H <span class="uscript-operator">=</span> <span class="uscript-operator">(</span><span class="uscript-number">240</span> <span class="uscript-operator">-</span> H<span class="uscript-operator">)</span> <span class="uscript-operator">%</span> <span class="uscript-number">240</span><span class="uscript-operator">;</span>
        <span class="uscript-keyword">else</span> H <span class="uscript-operator">=</span>        H  <span class="uscript-operator">%</span> <span class="uscript-number">240</span><span class="uscript-operator">;</span>

       <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>H <span class="uscript-operator">&lt;</span>  <span class="uscript-number">80</span><span class="uscript-operator">)</span> Color<span class="uscript-operator">.</span>R <span class="uscript-operator">=</span> Min<span class="uscript-operator">(</span><span class="uscript-number">255</span><span class="uscript-operator">,</span> <span class="uscript-number">255</span> <span class="uscript-operator">*</span> <span class="uscript-operator">(</span><span class="uscript-number">80</span> <span class="uscript-operator">-</span> H<span class="uscript-operator">)</span>  <span class="uscript-operator">/</span> <span class="uscript-number">40</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>H <span class="uscript-operator">&gt;</span> <span class="uscript-number">160</span><span class="uscript-operator">)</span> Color<span class="uscript-operator">.</span>R <span class="uscript-operator">=</span> Min<span class="uscript-operator">(</span><span class="uscript-number">255</span><span class="uscript-operator">,</span> <span class="uscript-number">255</span> <span class="uscript-operator">*</span> <span class="uscript-operator">(</span>H <span class="uscript-operator">-</span> <span class="uscript-number">160</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-number">40</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>H <span class="uscript-operator">&lt;</span> <span class="uscript-number">160</span><span class="uscript-operator">)</span> Color<span class="uscript-operator">.</span>G <span class="uscript-operator">=</span> Min<span class="uscript-operator">(</span><span class="uscript-number">255</span><span class="uscript-operator">,</span> <span class="uscript-number">255</span> <span class="uscript-operator">*</span> <span class="uscript-operator">(</span><span class="uscript-number">80</span> <span class="uscript-operator">-</span> Abs<span class="uscript-operator">(</span>H <span class="uscript-operator">-</span>  <span class="uscript-number">80</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-number">40</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>H <span class="uscript-operator">&gt;</span>  <span class="uscript-number">80</span><span class="uscript-operator">)</span> Color<span class="uscript-operator">.</span>B <span class="uscript-operator">=</span> Min<span class="uscript-operator">(</span><span class="uscript-number">255</span><span class="uscript-operator">,</span> <span class="uscript-number">255</span> <span class="uscript-operator">*</span> <span class="uscript-operator">(</span><span class="uscript-number">80</span> <span class="uscript-operator">-</span> Abs<span class="uscript-operator">(</span>H <span class="uscript-operator">-</span> <span class="uscript-number">160</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-number">40</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>S <span class="uscript-operator">&lt;</span> <span class="uscript-number">240</span><span class="uscript-operator">)</span> <span class="uscript-operator">{</span>
    Color <span class="uscript-operator">=</span> Color <span class="uscript-operator">*</span> <span class="uscript-operator">(</span><span class="uscript-type">float</span><span class="uscript-operator">(</span>S<span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-number">240</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    OffsetSaturation <span class="uscript-operator">=</span> <span class="uscript-number">128</span> <span class="uscript-operator">*</span> <span class="uscript-operator">(</span><span class="uscript-number">240</span> <span class="uscript-operator">-</span> S<span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-number">240</span><span class="uscript-operator">;</span>
    Color<span class="uscript-operator">.</span>R <span class="uscript-operator">+=</span> OffsetSaturation<span class="uscript-operator">;</span>
    Color<span class="uscript-operator">.</span>G <span class="uscript-operator">+=</span> OffsetSaturation<span class="uscript-operator">;</span>
    Color<span class="uscript-operator">.</span>B <span class="uscript-operator">+=</span> OffsetSaturation<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>

  L <span class="uscript-operator">=</span> Min<span class="uscript-operator">(</span><span class="uscript-number">240</span><span class="uscript-operator">,</span> L<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  Color <span class="uscript-operator">=</span> Color <span class="uscript-operator">*</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">120</span> <span class="uscript-operator">-</span> Abs<span class="uscript-operator">(</span>L <span class="uscript-operator">-</span> <span class="uscript-number">120</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-number">120</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>L <span class="uscript-operator">&gt;</span> <span class="uscript-number">120</span><span class="uscript-operator">)</span> <span class="uscript-operator">{</span>
    OffsetLightness <span class="uscript-operator">=</span> <span class="uscript-number">256</span> <span class="uscript-operator">*</span> <span class="uscript-operator">(</span>L <span class="uscript-operator">-</span> <span class="uscript-number">120</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-number">120</span><span class="uscript-operator">;</span>
    Color<span class="uscript-operator">.</span>R <span class="uscript-operator">+=</span> OffsetLightness<span class="uscript-operator">;</span>
    Color<span class="uscript-operator">.</span>G <span class="uscript-operator">+=</span> OffsetLightness<span class="uscript-operator">;</span>
    Color<span class="uscript-operator">.</span>B <span class="uscript-operator">+=</span> OffsetLightness<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>

  <span class="uscript-keyword">return</span> Color<span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span></pre><p><em class="em2">UArch</em> slight modification to the above script</p>
<p>ok changed it now, im using this custom version for a script im doing</p>
<p>input HLS values range from 0-255, output vector with ranges 0-1 x=R y=G z=B</p>
<pre class="uscript"><span class="uscript-keyword">simulated</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> vector HLStoRGB<span class="uscript-operator">(</span><span class="uscript-type">float</span> H<span class="uscript-operator">,</span><span class="uscript-type">float</span> L<span class="uscript-operator">,</span><span class="uscript-type">float</span> S<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> OffsetLightness<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> OffsetSaturation<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> vector cout<span class="uscript-operator">;</span>

    H <span class="uscript-operator">=</span> fclamp<span class="uscript-operator">(</span>H<span class="uscript-operator">,</span><span class="uscript-number">0</span><span class="uscript-operator">,</span><span class="uscript-number">255</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    L <span class="uscript-operator">=</span> fclamp<span class="uscript-operator">(</span>L<span class="uscript-operator">,</span><span class="uscript-number">0</span><span class="uscript-operator">,</span><span class="uscript-number">255</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    S <span class="uscript-operator">=</span> fclamp<span class="uscript-operator">(</span>S<span class="uscript-operator">,</span><span class="uscript-number">0</span><span class="uscript-operator">,</span><span class="uscript-number">255</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    S <span class="uscript-operator">=</span> <span class="uscript-number">255</span> <span class="uscript-operator">-</span> S<span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>H <span class="uscript-operator">&lt;</span> <span class="uscript-number">85</span><span class="uscript-operator">)</span>
        cout<span class="uscript-operator">.</span>x <span class="uscript-operator">=</span> fMin<span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">,</span> <span class="uscript-operator">(</span><span class="uscript-number">85</span> <span class="uscript-operator">-</span> H<span class="uscript-operator">)</span>  <span class="uscript-operator">/</span> <span class="uscript-number">42.5</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>H <span class="uscript-operator">&gt;</span> <span class="uscript-number">170</span><span class="uscript-operator">)</span>
        cout<span class="uscript-operator">.</span>x <span class="uscript-operator">=</span> fMin<span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">,</span> <span class="uscript-operator">(</span>H <span class="uscript-operator">-</span> <span class="uscript-number">170</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-number">42.5</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>H <span class="uscript-operator">&lt;</span> <span class="uscript-number">170</span><span class="uscript-operator">)</span>
        cout<span class="uscript-operator">.</span>y <span class="uscript-operator">=</span> fMin<span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">,</span> <span class="uscript-operator">(</span><span class="uscript-number">85</span> <span class="uscript-operator">-</span> Abs<span class="uscript-operator">(</span>H <span class="uscript-operator">-</span>  <span class="uscript-number">85</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-number">42.5</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>H <span class="uscript-operator">&gt;</span> <span class="uscript-number">85</span><span class="uscript-operator">)</span>
        cout<span class="uscript-operator">.</span>z <span class="uscript-operator">=</span> fMin<span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">,</span> <span class="uscript-operator">(</span><span class="uscript-number">85</span> <span class="uscript-operator">-</span> Abs<span class="uscript-operator">(</span>H <span class="uscript-operator">-</span> <span class="uscript-number">170</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-number">42.5</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>S <span class="uscript-operator">&lt;</span> <span class="uscript-number">255</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        cout <span class="uscript-operator">=</span> cout <span class="uscript-operator">*</span> <span class="uscript-operator">(</span>S <span class="uscript-operator">/</span> <span class="uscript-number">255</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        OffsetSaturation <span class="uscript-operator">=</span> <span class="uscript-comment">/*128 **/</span> <span class="uscript-operator">(</span><span class="uscript-number">255</span> <span class="uscript-operator">-</span> S<span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-number">255</span><span class="uscript-operator">;</span>
        cout<span class="uscript-operator">.</span>x <span class="uscript-operator">+=</span> OffsetSaturation<span class="uscript-operator">;</span>
        cout<span class="uscript-operator">.</span>y <span class="uscript-operator">+=</span> OffsetSaturation<span class="uscript-operator">;</span>
        cout<span class="uscript-operator">.</span>z <span class="uscript-operator">+=</span> OffsetSaturation<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>

    cout <span class="uscript-operator">=</span> cout <span class="uscript-operator">*</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span><span class="uscript-number">255</span> <span class="uscript-operator">-</span> Abs<span class="uscript-operator">(</span>L <span class="uscript-operator">-</span> <span class="uscript-number">255</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> <span class="uscript-number">255</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">return</span> cout<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Here's what <a href="sourced-player-shadows.html">Sourced Player Shadows</a> uses to determine the light color when casting colored shadows.  It's based on direct measurements of the color of white walls in a zone with various ambient colors set.  You'll have to add your own code to scale for light brightness.  This isn't anything like the scientifically correct way to do the conversion, but my guess is they were just kinda guessing when they wrote it the first time.</p>
<pre class="uscript"><span class="uscript-comment">// Convert the color (not brightness) of an Unreal light to RGB values from 0 to 1</span>
<span class="uscript-comment">// inputs are float so I don't have to worry about casting them.</span>
<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> Chroma2RGB<span class="uscript-operator">(</span><span class="uscript-type">float</span> hue<span class="uscript-operator">,</span> <span class="uscript-type">float</span> saturation<span class="uscript-operator">,</span>
                     <span class="uscript-keyword">out</span> <span class="uscript-type">float</span> r<span class="uscript-operator">,</span> <span class="uscript-keyword">out</span> <span class="uscript-type">float</span> g<span class="uscript-operator">,</span> <span class="uscript-keyword">out</span> <span class="uscript-type">float</span> b<span class="uscript-operator">)</span> <span class="uscript-operator">{</span>
  hue <span class="uscript-operator">/=</span> <span class="uscript-number">85</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>hue <span class="uscript-operator">&lt;=</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span>      <span class="uscript-operator">{</span> g <span class="uscript-operator">=</span> hue  <span class="uscript-operator">;</span> r <span class="uscript-operator">=</span> <span class="uscript-number">1</span><span class="uscript-operator">-</span>g<span class="uscript-operator">;</span> b <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span><span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>hue <span class="uscript-operator">&lt;=</span> <span class="uscript-number">2</span><span class="uscript-operator">)</span> <span class="uscript-operator">{</span> b <span class="uscript-operator">=</span> hue<span class="uscript-number">-1</span><span class="uscript-operator">;</span> g <span class="uscript-operator">=</span> <span class="uscript-number">1</span><span class="uscript-operator">-</span>b<span class="uscript-operator">;</span> r <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span><span class="uscript-operator">}</span>
  <span class="uscript-keyword">else</span>               <span class="uscript-operator">{</span> r <span class="uscript-operator">=</span> hue<span class="uscript-number">-2</span><span class="uscript-operator">;</span> b <span class="uscript-operator">=</span> <span class="uscript-number">1</span><span class="uscript-operator">-</span>r<span class="uscript-operator">;</span> g <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span><span class="uscript-operator">}</span>
  saturation <span class="uscript-operator">=</span> FClamp<span class="uscript-operator">(</span>saturation<span class="uscript-operator">/</span><span class="uscript-number">255</span><span class="uscript-operator">,</span><span class="uscript-number">0</span><span class="uscript-operator">,</span><span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  r <span class="uscript-operator">=</span> lerp<span class="uscript-operator">(</span>saturation<span class="uscript-operator">,</span>r<span class="uscript-operator">,</span><span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  g <span class="uscript-operator">=</span> lerp<span class="uscript-operator">(</span>saturation<span class="uscript-operator">,</span>g<span class="uscript-operator">,</span><span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  b <span class="uscript-operator">=</span> lerp<span class="uscript-operator">(</span>saturation<span class="uscript-operator">,</span>b<span class="uscript-operator">,</span><span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h2><a name="0.1"></a>Comments</h2>
<p><em class="em2">capt.k:</em>  HLSMAX and RGBMAX are variables (which can obviously be hard-coded into the script) because I wasn't sure at the time of writing what values would be appropriate.  The UEd color picker uses 240 as the max for HLS values, but the slider has 255.</p>
<p><em class="em2">Wormbo:</em> Actor.LightSaturation goes from 0 to 255, where 0 means full saturation and 255 indicates a pure grey color. LightHue also goes from 0 to 255 and LightBrightness is an unlimited float value. The color picker in UEd is somwhat useless for light colors, except for the hue value.</p>
<p><em class="em2">Mychaeel:</em> Since in Windows the "saturation" property usually goes from 0 for "no saturation" (grayscale) to 255 for "full saturation" (full color), that could be the reason that the algorithm posted above doesn't work here without adaptation.</p>
<p><em class="em2">Mychaeel:</em> I've posted an alternative implementation created from scratch that also uses Windows' HLS definition (see comment header).  If Unreal's really differs from it, adapt the parameters before passing them to that function.</p>
<p>Please test it.  If it works as advertised, let's get rid of the first Microsoft-derived implementation (which is longer and not designed for UnrealScript).</p>
<p><em class="em2">inio:</em> Added what I came up with for <a href="sourced-player-shadows.html">Sourced Player Shadows</a>.</p>
<p><em class="em2">Sixpack-Shambler</em> Am I wrong or in the first HLStoRGB function on this page, if Sat == 0 (Achromatic case) will the result not turn out with no colours at all? Look at the code, at the end of it the local variables R G B are applied to C.R, C.G and C.B but if Sat == 0  then the R G B variables are not modifed?</p>
<p>I've changed the code a bit to 'fix' that</p>
<h2><a name="0.2"></a>Related Topics</h2>
<ul><li><a href="rgb-to-hls-conversion.html">RGB To HLS Conversion</a></li>
<li><a href="color-operators.html">Color Operators</a></li>
<li><a href="open-source.html">Open Source</a> &ndash; questionable, see quote at the top of this page?</li>
</ul>
<script type="text/javascript"><!--
 menuItemAdd("Comments", "#0.1");
menuItemAdd("Related Topics", "#0.2");
 menuWrite() //--></script></div>
</div>

<div id="footer" class="bar">
	<p><form method="post" action="http://wiki.beyondunreal.com/wiki" enctype="application/x-www-form-urlencoded">
<a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a><br>
Last edited July 10, 2006 4:52 <a href="http://wiki.beyondunreal.com/wiki?action=browse&diff=1&id=HLS_To_RGB_Conversion">(diff)</a><br>Search: <input type="text" name="search"  size="20" /><input type="hidden" name="dosearch" value="1"  /><br><br><small><a href="http://wiki.beyondunreal.com/wiki/HLS_To_RGB_Conversion">Original page</a> &#150; copy created Sat, Jun 23, 2007</small><div></div>
</form>
	</p>
	<p>I don't need to test my programs. I have an error-correcting modem.
</p>
</div>
</div><!-- close of "scrolling" div -->

<div id="quickbar">
	<div id="logo"><a href="../index.html"><img src="shared/wikilogo.jpg" width="143" height="100" border="0"></a>
		</div>
	<div class="qbsitename">
		<p>The Unreal Engine Documentation Site</p>
	</div>
	<div class="qbsection">
<p><a href="metatopics.html">Wiki Community</a></p>
<p><a href="category-category.html">Topic Categories</a></p>


<p><a href="recent-changes.html">Recent Changes</a></p>
<p><a href="offline-wiki.html">Offline Wiki</a></p>
</div><div class="qbsection">
<p><a href="unreal-engine.html">Unreal Engine</a></p>
<p><a href="console-commands.html">Console Commands</a></p>
<p><a href="terminology.html">Terminology</a></p>
<p><a href="category-faq.html">FAQs</a></p>
<p><a href="help-desk.html">Help Desk</a></p>
</div><div class="qbsection">
<p><a href="topics-on-mapping.html">Mapping Topics</a></p>
<p><a href="mapping-lessons.html">Mapping Lessons</a></p>
<p><a href="unrealed-3.html">UnrealEd Interface</a></p>
</div><div class="qbsection">
<p><a href="unrealscript.html">UnrealScript Topics</a></p>
<p><a href="unrealscript-lessons.html">UnrealScript Lessons</a></p>
<p><a href="making-mods.html">Making Mods</a></p>
<p><a href="class-tree.html">Class Tree</a></p>
</div><div class="qbsection">
<p><a href="topics-on-modeling.html">Modeling Topics</a></p>
</div><div class="qbsection">
<p><a href="chongqing-page.html">Chongqing Page</a></p>
<p><a href="log-in.html">Log In</a></p></div>
</div>

</body></html>
