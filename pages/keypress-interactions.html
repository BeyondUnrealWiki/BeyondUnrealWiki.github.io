<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head lang="en">
	<title>UnrealWiki: Keypress Interactions</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<link rel="stylesheet" type="text/css" media="screen, print"
		href="shared/stylebase.structural.css">	
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/template-default.css">
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/styles.chblue.css">
	<link rel="stylesheet" type="text/css" media="print"
		href="shared/template-default-print.css">
	<!--[if IE 6]>
			<style>
			/* dirty hack for IE6. */
			#quickbar {
				position: absolute;
				}
			</style>
	<![endif]-->
  <link rel="start" href="http://wiki.beyondunreal.com/">
  <link rel="glossary"  href="http://wiki.beyondunreal.com/wiki/Terminology">
  <link rel="help"  href="http://wiki.beyondunreal.com/wiki/Using_The_Wiki">
<script type="text/javascript" src="shared/dhtml.js"></script>
<script type="text/javascript" src="shared/dhtml-menu.js"></script>
<style type="text/css">#dhtml-menu    { background: #eee; padding: 5px 0px; margin-right: -20px; border: 1px solid #888; border-left: 1px solid #ccc; border-top: 1px solid #ccc;  border-right: 1px solid #888; border-bottom: 1px solid #888 }
#dhtml-menu td { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; padding: 1px 10px; cursor: default }
#dhtml-menu a  { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; text-decoration: none }
#dhtml-menu tt { font-family: monospace; font-size: 9pt }
#dhtml-menu-separator { height: 1px; background: red }
#dhtml-menu-anchor { cursor: default }
</style>
<script type="text/javascript" src="shared/expandable.js"></script>
</head>
<body onLoad="menuInit(); document.cookie='page=Keypress_Interactions; path=/'" class="default">
<div id="scrolling"><!-- contains all except the fixed sidebar -->
<div id="topbar"  class="bar">
	<div class="righthalf">
		<form class="inline" method="post" action="/wiki" enctype="application/x-www-form-urlencoded"><input type="text" name="search"  size="20" /> <input type="submit" name="search" value="search" /></form>
	</div>
	<div class="lefthalf">
		<script type="text/javascript"><!--
			menuAlignRight = false;
		//--></script>
		<span><script type="text/javascript"><!--
 menuWriteAnchor("Quick Navigation") //--></script></span> | <a href="(start).html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a> | <a href="http://wiki.beyondunreal.com/wiki?action=editprefs">Preferences</a>
	</div>
</div>

<div id="content"><!-- contains the title and article -->
	<h1 class='pagetitle'><a href="http://wiki.beyondunreal.com/wiki?back=Keypress Interactions">Keypress Interactions</a></h1>
	<div class="wiki"><p>KeyPress Interactions are pretty neat in my opinion. You can intercept on what type of press it is (Press, Hold, Release), or even pick up on axis movement.</p>
<p>First off, you need to make your mutator class that will create your interaction. See <a href="creating-an-interaction-fr1.html">Creating An Interaction From A Mutator</a> for this.</p>
<p>Done that? Good...</p>
<p>So thats the mutator part done. Next is the easy part! <img alt=":)" src="emoticons/smile.gif" align="middle"></p>
<p>A simple interaction:</p>
<pre class="uscript"><span class="uscript-keyword">Class</span> MyInteraction <span class="uscript-keyword">extends</span> Interaction<span class="uscript-operator">;</span>

<span class="uscript-keyword">Function</span> Initialize<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    Log<span class="uscript-operator">(</span><span class="uscript-string">"Interaction Initialized"</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Dont forget to add</p>
<pre class="uscript">bActive<span class="uscript-operator">=</span><span class="uscript-keyword">True</span></pre><p>Under defaultproperties (else this interaction wont do anything).</p>
<p>Now to see what is going on with these keypresses, add the following function under your initialize function.</p>
<pre class="uscript"><span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> KeyEvent<span class="uscript-operator">(</span>EInputKey Key<span class="uscript-operator">,</span> EInputAction Action<span class="uscript-operator">,</span> <span class="uscript-type">FLOAT</span> Delta <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Action <span class="uscript-operator">==</span> IST_Press<span class="uscript-operator">)</span>
        ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>ClientMessage<span class="uscript-operator">(</span><span class="uscript-string">"Key PRESSED:"</span> <span class="uscript-operator">@</span> Key<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Action <span class="uscript-operator">==</span> IST_Release<span class="uscript-operator">)</span>
        ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>ClientMessage<span class="uscript-operator">(</span><span class="uscript-string">"Key RELEASED:"</span> <span class="uscript-operator">@</span> Key<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Action <span class="uscript-operator">==</span> IST_Hold<span class="uscript-operator">)</span>
        ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>ClientMessage<span class="uscript-operator">(</span><span class="uscript-string">"Key HELD:"</span> <span class="uscript-operator">@</span> Key<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Action <span class="uscript-operator">==</span> IST_Axis<span class="uscript-operator">)</span>
        ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>ClientMessage<span class="uscript-operator">(</span><span class="uscript-string">"Key AXIS:"</span> <span class="uscript-operator">@</span> Key<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">return</span> <span class="uscript-keyword">false</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>This will make a small white message appear in the chat box in the bottom left of your screen telling you what you did, and which key you pressed. The keys are represented as numbers (try using Chr(Key) to convert them into letters and numbers. Remember keys like "Home" wont display properly like this), though you can use the ones listed in <code>Engine.Interactions</code> to match on a key that has been pressed.</p>
<p>Note the <code>Return False;</code>. If you return "True" in this function, the <a href="interactionmaster.html">InteractionMaster</a> will cease to iterate through the interactions, it will stop at yours.</p>
<p>Another function, KeyType, can be used to build up a string from what keys have been pushed, as is demonstrated in <code>Engine.Console</code>. I think that is all there is to it.</p>
<pre class="uscript"><span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> KeyType<span class="uscript-operator">(</span> EInputKey Key<span class="uscript-operator">,</span> <span class="uscript-keyword">optional</span> <span class="uscript-type">string</span> Unicode <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>bIgnoreKeys<span class="uscript-operator">)</span>        
        <span class="uscript-keyword">return</span> <span class="uscript-keyword">true</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span><span class="uscript-operator">(</span> Key<span class="uscript-operator">&gt;=</span><span class="uscript-number">0x20</span> <span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        <span class="uscript-keyword">if</span><span class="uscript-operator">(</span> Unicode <span class="uscript-operator">!=</span> <span class="uscript-string">""</span> <span class="uscript-operator">)</span>
            TypedStr <span class="uscript-operator">=</span> TypedStr <span class="uscript-operator">$</span> Unicode<span class="uscript-operator">;</span>
        <span class="uscript-keyword">else</span>
            TypedStr <span class="uscript-operator">=</span> TypedStr <span class="uscript-operator">$</span> Chr<span class="uscript-operator">(</span>Key<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
           <span class="uscript-keyword">return</span><span class="uscript-operator">(</span> <span class="uscript-keyword">true</span> <span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
<span class="uscript-operator">}</span></pre><p>Now that you can see which does what, lets look at a practical use for it. I will be modifying ICU (which was created in the <a href="hud-interactions.html">HUD Interactions</a> page) to highlight enemys when you push Page Up, and Friendlys when you push Page Down.</p>
<p>I added this for the keypress function:</p>
<pre class="uscript"><span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> KeyEvent<span class="uscript-operator">(</span>EInputKey Key<span class="uscript-operator">,</span> EInputAction Action<span class="uscript-operator">,</span> <span class="uscript-type">FLOAT</span> Delta <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>Action <span class="uscript-operator">==</span> IST_Press<span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">(</span>Key <span class="uscript-operator">==</span> IK_PageUp<span class="uscript-operator">)</span><span class="uscript-operator">)</span>
        bDrawEnemy <span class="uscript-operator">=</span> <span class="uscript-keyword">True</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>Action <span class="uscript-operator">==</span> IST_Release<span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">(</span>Key <span class="uscript-operator">==</span> IK_PageUp<span class="uscript-operator">)</span><span class="uscript-operator">)</span>
        bDrawEnemy <span class="uscript-operator">=</span> <span class="uscript-keyword">False</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>Action <span class="uscript-operator">==</span> IST_Press<span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">(</span>Key <span class="uscript-operator">==</span> IK_PageDown<span class="uscript-operator">)</span><span class="uscript-operator">)</span>
        bDrawFriendly <span class="uscript-operator">=</span> <span class="uscript-keyword">True</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>Action <span class="uscript-operator">==</span> IST_Release<span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">(</span>Key <span class="uscript-operator">==</span> IK_PageDown<span class="uscript-operator">)</span><span class="uscript-operator">)</span>
        bDrawFriendly <span class="uscript-operator">=</span> <span class="uscript-keyword">False</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">return</span> <span class="uscript-keyword">false</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>That, quite basically, sets bDrawEnemy to TRUE when PageUp is pressed, and to FALSE when it is released. The same for bDrawFriendly.</p>
<p>I have added a couple of extra lines to the PostRender function to account for this, and only draw the right people:</p>
<pre class="uscript"><span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> PostRender<span class="uscript-operator">(</span> canvas Canvas <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> Pawn P<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> vector CameraLocation<span class="uscript-operator">,</span> dir<span class="uscript-operator">,</span> ScreenLocation<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> rotator CameraRotation<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> dist<span class="uscript-operator">,</span> draw_scale<span class="uscript-operator">;</span>

    <span class="uscript-keyword">If</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>bDrawEnemy<span class="uscript-operator">)</span> <span class="uscript-operator">||</span> <span class="uscript-operator">(</span>bDrawFriendly<span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-comment">//if none are true, dont do anything. Saves processing.</span>
        <span class="uscript-operator">{</span>
        <span class="uscript-keyword">foreach</span> ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>DynamicActors<span class="uscript-operator">(</span><span class="uscript-keyword">class</span><span class="uscript-name">'Pawn'</span><span class="uscript-operator">,</span> P<span class="uscript-operator">)</span>
            <span class="uscript-operator">{</span>
            <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>Pawn <span class="uscript-operator">==</span> <span class="uscript-keyword">None</span> <span class="uscript-operator">||</span> P <span class="uscript-operator">==</span> <span class="uscript-keyword">None</span><span class="uscript-operator">)</span>
                <span class="uscript-keyword">Return</span><span class="uscript-operator">;</span>
    
            <span class="uscript-comment">//A trace to tell if you can see this thing</span>
            <span class="uscript-keyword">If</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>Canvas<span class="uscript-operator">.</span>Viewport<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>FastTrace<span class="uscript-operator">(</span>P<span class="uscript-operator">.</span>Location<span class="uscript-operator">,</span> ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>Pawn<span class="uscript-operator">.</span>Location<span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">(</span>P <span class="uscript-operator">!=</span> ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>Pawn<span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">(</span>P<span class="uscript-operator">.</span>PlayerReplicationInfo <span class="uscript-operator">!=</span> <span class="uscript-keyword">None</span><span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">(</span>P<span class="uscript-operator">.</span>Health <span class="uscript-operator">&gt;</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span>
                <span class="uscript-operator">{</span>
                <span class="uscript-comment">//Convert 3d location to 2d for display on the Canvas</span>
                ScreenLocation <span class="uscript-operator">=</span> WorldToScreen<span class="uscript-operator">(</span>P<span class="uscript-operator">.</span>location<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
                Canvas<span class="uscript-operator">.</span>GetCameraLocation<span class="uscript-operator">(</span>CameraLocation<span class="uscript-operator">,</span> CameraRotation<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
                dir <span class="uscript-operator">=</span> P<span class="uscript-operator">.</span>Location <span class="uscript-operator">-</span> CameraLocation<span class="uscript-operator">;</span>
                dist <span class="uscript-operator">=</span> VSize<span class="uscript-operator">(</span>dir<span class="uscript-operator">)</span><span class="uscript-operator">;</span> <span class="uscript-comment">//Distance between me and them           </span>
                
                <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>dir <span class="uscript-operator">dot</span> vector<span class="uscript-operator">(</span>CameraRotation<span class="uscript-operator">)</span> <span class="uscript-operator">&gt;</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span>
                    <span class="uscript-operator">{</span>
                    draw_scale <span class="uscript-operator">=</span> <span class="uscript-number">512</span> <span class="uscript-operator">/</span> dist<span class="uscript-operator">;</span> <span class="uscript-comment">//Calculate the drawscale, 512 is the "1:1" distance.</span>
                    <span class="uscript-comment">//Set drawing params</span>
                    Canvas<span class="uscript-operator">.</span>SetPos<span class="uscript-operator">(</span>ScreenLocation<span class="uscript-operator">.</span>X <span class="uscript-operator">-</span> <span class="uscript-operator">(</span><span class="uscript-number">32</span> <span class="uscript-operator">*</span> draw_scale<span class="uscript-operator">)</span><span class="uscript-operator">,</span> ScreenLocation<span class="uscript-operator">.</span>Y <span class="uscript-operator">-</span> <span class="uscript-operator">(</span><span class="uscript-number">32</span> <span class="uscript-operator">*</span> draw_scale<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
                    Canvas<span class="uscript-operator">.</span>Style <span class="uscript-operator">=</span> <span class="uscript-number">3</span><span class="uscript-operator">;</span>
                    Canvas<span class="uscript-operator">.</span>SetDrawColor<span class="uscript-operator">(</span><span class="uscript-number">255</span><span class="uscript-operator">,</span><span class="uscript-number">255</span><span class="uscript-operator">,</span><span class="uscript-number">255</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
                    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>bDrawEnemy<span class="uscript-operator">)</span> <span class="uscript-comment">//If PageUp is depressed (bDrawEnemy is true), see if the pawn is an enemy, if so, draw him!</span>
                        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span><span class="uscript-operator">(</span>P<span class="uscript-operator">.</span>PlayerReplicationInfo<span class="uscript-operator">.</span>Team<span class="uscript-operator">.</span>TeamIndex <span class="uscript-operator">!=</span> ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>Pawn<span class="uscript-operator">.</span>PlayerReplicationInfo<span class="uscript-operator">.</span>Team<span class="uscript-operator">.</span>TeamIndex<span class="uscript-operator">)</span> <span class="uscript-operator">||</span> <span class="uscript-operator">(</span><span class="uscript-operator">!</span>GRI<span class="uscript-operator">.</span>bTeamGame<span class="uscript-operator">)</span><span class="uscript-operator">)</span>
                            Canvas<span class="uscript-operator">.</span>DrawIcon<span class="uscript-operator">(</span>texture<span class="uscript-name">'red'</span><span class="uscript-operator">,</span> draw_scale<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
                    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>bDrawFriendly<span class="uscript-operator">)</span> <span class="uscript-comment">//If PageDown is depressed (bDrawFriendly is true), see if the pawn is an friendly, if so, draw him!</span>
                        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>P<span class="uscript-operator">.</span>PlayerReplicationInfo<span class="uscript-operator">.</span>Team<span class="uscript-operator">.</span>TeamIndex <span class="uscript-operator">==</span> ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>Pawn<span class="uscript-operator">.</span>PlayerReplicationInfo<span class="uscript-operator">.</span>Team<span class="uscript-operator">.</span>TeamIndex<span class="uscript-operator">)</span>
                            Canvas<span class="uscript-operator">.</span>DrawIcon<span class="uscript-operator">(</span>texture<span class="uscript-name">'green'</span><span class="uscript-operator">,</span> draw_scale<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
                    <span class="uscript-operator">}</span>
                <span class="uscript-operator">}</span>
            <span class="uscript-operator">}</span>
        <span class="uscript-operator">}</span>
<span class="uscript-operator">}</span></pre><p>I must also make sure</p>
<pre class="uscript">bVisible<span class="uscript-operator">=</span><span class="uscript-keyword">True</span></pre><p>Is in defaultproperties, else any render functions will be ignored.</p>
<p>Now I have a mutator that highlights my enemys in red when I push PageUp, and people on my team in green when I push PageDown. Neat, huh?</p>
<p>Checkout <a href="inputkeymap.html">Input Key Mapping</a> for a full table of input keys, and their corresponding values.</p>
<hr class="thin"><p>With a little work, I figured out how to use these with the GUIUserKeyBinding class, to allow the user to select the keys used by the Interaction.</p>
<p>This part is in RadarInteraction.uc:</p>
<pre class="uscript"><span class="uscript-keyword">var</span> <span class="uscript-type">int</span> LastKey
<span class="uscript-keyword">var</span> <span class="uscript-type">int</span> Zooming<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span> <span class="uscript-type">float</span> ZoomDelta

<span class="uscript-comment">// KeyEvent will detect keyup and keydown events for any keys bound to our</span>
<span class="uscript-comment">// zoom feature, and act accordingly</span>
<span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> KeyEvent<span class="uscript-operator">(</span>EInputKey Key<span class="uscript-operator">,</span> EInputAction Action<span class="uscript-operator">,</span> <span class="uscript-type">float</span> Delta<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>

    <span class="uscript-keyword">local</span> <span class="uscript-type">string</span> tmp<span class="uscript-operator">;</span>

<span class="uscript-comment">// if the zoom key that is currently being held is released, end the zoom</span>
    <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>Action <span class="uscript-operator">==</span> IST_Release <span class="uscript-operator">&amp;&amp;</span> Zooming <span class="uscript-operator">!=</span><span class="uscript-number">0</span> <span class="uscript-operator">&amp;&amp;</span> Key <span class="uscript-operator">==</span> LastKey<span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        LastKey<span class="uscript-operator">=</span><span class="uscript-operator">-</span><span class="uscript-number">1</span><span class="uscript-operator">;</span>
        Zooming<span class="uscript-operator">=</span><span class="uscript-number">0</span><span class="uscript-operator">;</span>
        <span class="uscript-keyword">return</span> <span class="uscript-keyword">True</span><span class="uscript-operator">;</span>
<span class="uscript-comment">// a key has been pressed</span>
    <span class="uscript-operator">}</span> <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Action <span class="uscript-operator">==</span> IST_Press<span class="uscript-operator">)</span> <span class="uscript-operator">{</span>
<span class="uscript-comment">// big ugliness here, we use console commands to get the name of the numeric</span>
<span class="uscript-comment">// key, and then the alias bound to that keyname</span>
        tmp <span class="uscript-operator">=</span> ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>ConsoleCommand<span class="uscript-operator">(</span><span class="uscript-string">"KEYNAME"</span><span class="uscript-operator">@</span>Key<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        tmp <span class="uscript-operator">=</span> ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>ConsoleCommand<span class="uscript-operator">(</span><span class="uscript-string">"KEYBINDING"</span><span class="uscript-operator">@</span>tmp<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-comment">// if it's one of our two aliases (which don't actually exist), set the zoom</span>
<span class="uscript-comment">// direction, save the key that started the zoom, and eat the event</span>
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>tmp <span class="uscript-operator">==</span> <span class="uscript-string">"tdzoomin"</span><span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            LastKey <span class="uscript-operator">=</span> Key<span class="uscript-operator">;</span>
            Zooming <span class="uscript-operator">=</span> <span class="uscript-operator">-</span><span class="uscript-number">1</span><span class="uscript-operator">;</span>
            <span class="uscript-keyword">return</span> <span class="uscript-keyword">True</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span> <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>tmp <span class="uscript-operator">~=</span> <span class="uscript-string">"tdzoomout"</span><span class="uscript-operator">)</span> <span class="uscript-operator">{</span>
            LastKey <span class="uscript-operator">=</span> Key<span class="uscript-operator">;</span>
            zooming <span class="uscript-operator">=</span> <span class="uscript-number">1</span><span class="uscript-operator">;</span>
            <span class="uscript-keyword">return</span> <span class="uscript-keyword">True</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
    <span class="uscript-operator">}</span>
<span class="uscript-comment">// this event doesn't matter to us, so we pass it on for further processing</span>
    <span class="uscript-keyword">return</span> <span class="uscript-keyword">False</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>and this is from TacticalDisplayKeyBinding:</p>
<pre class="uscript"><span class="uscript-comment">// Custom Key Bindings</span>
<span class="uscript-keyword">class</span> TacticalDisplayKeyBinding <span class="uscript-keyword">extends</span> GUIUserKeyBinding<span class="uscript-operator">;</span>

<span class="uscript-keyword">defaultproperties</span>
<span class="uscript-operator">{</span>
    KeyData<span class="uscript-operator">(</span><span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">=</span><span class="uscript-operator">(</span>Alias<span class="uscript-operator">=</span><span class="uscript-string">""</span><span class="uscript-operator">,</span>KeyLabel<span class="uscript-operator">=</span><span class="uscript-string">"Tactical Display Controls"</span><span class="uscript-operator">,</span>bIsSection<span class="uscript-operator">=</span><span class="uscript-keyword">True</span><span class="uscript-operator">)</span>
    KeyData<span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">=</span><span class="uscript-operator">(</span>alias<span class="uscript-operator">=</span><span class="uscript-string">"tdzoomin"</span><span class="uscript-operator">,</span>KeyLabel<span class="uscript-operator">=</span><span class="uscript-string">"Zoom In"</span><span class="uscript-operator">,</span>bIsSection<span class="uscript-operator">=</span><span class="uscript-keyword">False</span><span class="uscript-operator">)</span>
    KeyData<span class="uscript-operator">(</span><span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">=</span><span class="uscript-operator">(</span>alias<span class="uscript-operator">=</span><span class="uscript-string">"tdzoomout"</span><span class="uscript-operator">,</span>KeyLabel<span class="uscript-operator">=</span><span class="uscript-string">"Zoom Out"</span><span class="uscript-operator">,</span>bIsSection<span class="uscript-operator">=</span><span class="uscript-keyword">False</span><span class="uscript-operator">)</span>
<span class="uscript-operator">}</span></pre><p>The GUIUserKeyBinding allows the user to bind the keys aliases in the "Controls" tab of their settings.  When they press a key, the interaction checks to see if it is bound to one of the two aliases, and takes action.  This is adapted from the same code that the Controls tab uses to load the user's keybindings.</p>
<hr class="thin"><p><em class="em2">Will:</em> Any problems understanding this? Anything I could do to make it clearer? If so: tell me, or do it yourself <img alt=";)" src="emoticons/wink.gif" align="middle"></p>
<p><em class="em2">DJPaul:</em> Not for me - once again, brilliantly written.  Cheers.</p>
<p><em class="em2">Claw:</em> Hmm, this is excellently written. And now I finally realize what WorldToScreen() means. <img alt=":rolleyes:" src="emoticons/rolleyes.gif" align="middle"></p>
<p><em class="em2">CheshireCat:</em> Here's another KeyEvent example, that allows the user to select the keys used.  Any questions?</p>
<p><em class="em2">Mysterial:</em> Why would you want to do all that key binding stuff in KeyEvent() (in the last example)? Why not just use an exec function instead?</p>
<p><em class="em2">Mychaeel:</em> Because exec functions only work in certain classes, and you might not want to create those classes.  (It's a good idea not to replace game-relevant classes like xPlayer unless you absolutely have to for very good reasons <em class="em1">other</em> than doing things that could just as well be done less invasively, like what's described above.)</p>
<p><em class="em2">Mysterial:</em> Ah, I was under the impression that Interactions were such a class. Obviously not <img alt=";)" src="emoticons/wink.gif" align="middle"></p>
<p>Is there a list anywhere of classes in which exec functions work?</p>
<p><em class="em2">Mychaeel:</em> Since you can register any amount of <a href="interaction.html">Interaction</a> objects simultaneously (instead of having to replace an existing one by yours), they're safe and neat for modding.  (Though Joe Wilcox says that they weren't meant to be used for that.) &ndash; I don't think there's a list of places where "exec function"s work.  Sounds like an idea for a new page though.</p>
<p><em class="em2">Tarquin:</em> exec function the same as <a href="exec-directive.html">exec directive</a>?</p>
<p><em class="em2">Mychaeel:</em> No.  See <a href="function-syntax.html">Function Syntax</a>.</p>
<p><em class="em2">Nuleo:</em> Has anyone figured out a better way to use the GUIUserKeyBindings without using exec commands just to get the key names?  In my interaction I was originally using this method </p>
<pre class="paraverbatim">    if ((Action == IST_Press) &amp;&amp; (Key == IK_PageUp))
         //Do something</pre><p>But when I changed to this method (with a class extending GUIUserKeyBindings)</p>
<pre class="paraverbatim">    tmp = ViewportOwner.Actor.ConsoleCommand("KEYNAME"@Key);
    tmp = ViewportOwner.Actor.ConsoleCommand("KEYBINDING"@tmp);
    // if it's one of our two aliases (which don't actually exist), set the zoom
    // direction, save the key that started the zoom, and eat the event
    if (tmp == "tdzoomin")
         //Do something</pre><p>I noticed a reduce in game speed and the sound was chopping up a bit.</p>
<p><em class="em2">Ceej:</em> I've just been experimenting with this. For new game types, one place to install a keypress interaction seems to be in the InitInputSystem() event of your PlayerController subclass. For example:</p>
<pre class="uscript"><span class="uscript-keyword">event</span> InitInputSystem<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">super</span><span class="uscript-operator">.</span>InitInputSystem<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    Player<span class="uscript-operator">.</span>interactionMaster<span class="uscript-operator">.</span>AddInteraction<span class="uscript-operator">(</span><span class="uscript-string">"MyPackage.MyKeyInteraction"</span><span class="uscript-operator">,</span> Player<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p><em class="em2">Foxpaw:</em> Is it just me, or do interactions not pick up on joystick axes? Mine picks up my mouse axis movement, and joystick buttons, and joystick axes can be bound to stuff using preferences (so they appear to be being picked up by the game) but my interaction doesn't report any input when I move the joystick.</p>
<p><em class="em2">Newbie:</em> How do I get keypress events for an actor in UT1?</p>
<p><em class="em2">Meowcat:</em> @nuelo, I have not found a better way to locate the key yet, but you can use the initialize event to do a search for the key that you want, then save it for comparison.  I have used this for an interaction and it works ok except that you cannot change it midgame</p>
<p><em class="em2">Conzar:</em> You can also add the interaction to a new GameInfo object (ut2004) here.</p>
<pre class="uscript"><span class="uscript-keyword">event</span> PostLogin<span class="uscript-operator">(</span>PlayerController NewPlayer<span class="uscript-operator">)</span><span class="uscript-operator">{</span>
   <span class="uscript-keyword">super</span><span class="uscript-operator">.</span>PostLogin<span class="uscript-operator">(</span>NewPlayer<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
   NewPlayer<span class="uscript-operator">.</span>Player<span class="uscript-operator">.</span>interactionMaster<span class="uscript-operator">.</span>AddInteraction<span class="uscript-operator">(</span><span class="uscript-string">"pkg.class"</span><span class="uscript-operator">,</span>NewPlayer<span class="uscript-operator">.</span>Player<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

<span class="uscript-operator">}</span></pre><p><em class="em2">Wormbo:</em> Your idea will only work in single player and on a listen server. Clients in network games won't see the interaction, though.</p>
<p><em class="em2">Kungfu Hampster:</em>  Is there a way to use an interaction to change the input of a key?  For example, changing the right mouse button to be the use key?</p>
<p><em class="em2">Foxpaw:</em> Yes. Depending on what exactly you're planning, you may be able to get any actor to do that.</p>
<p>You could have a keypress interaction return true on right mouse button, (to prevent the regular right mouse button event from propogating) and also make it manually activate the "Use" function. (I think that it is in Pawn on Controller or something.)</p>
<p>There's also a more direct approach which I'm hesitant to recommend, though it shouldn't have any problems unless maybe the game crashes. You can manually change the keybinds from any actor using set and get on the console. EG: (I've substituted Q for rightmouse, but I think "RightMouse" is the correct name for that input.)</p>
<pre class="uscript">  <span class="uscript-keyword">function</span> ChangeRMB<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> Backup <span class="uscript-operator">==</span> <span class="uscript-string">""</span> <span class="uscript-operator">)</span>
      Backup <span class="uscript-operator">=</span> ConsoleCommand<span class="uscript-operator">(</span> <span class="uscript-string">"Get Input Q"</span> <span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    ConsoleCommand<span class="uscript-operator">(</span> <span class="uscript-string">"Set Input Q Use"</span> <span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>

  <span class="uscript-keyword">function</span> ChangeRMBBack<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    ConsoleCommand<span class="uscript-operator">(</span> <span class="uscript-string">"Set Input Q "</span><span class="uscript-operator">$</span>Backup <span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    Backup <span class="uscript-operator">=</span> <span class="uscript-string">""</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>

  <span class="uscript-keyword">function</span> Destroyed<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    ChangeRMBBack<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>  <span class="uscript-comment">// Very important to make sure the keybind gets reset if the game is exited!</span>

    <span class="uscript-keyword">Super</span><span class="uscript-operator">.</span>Destroyed<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span></pre><p><em class="em2">MythOpus:</em> I think this would also be useful for things other than Mutators... like on special secret areas in maps where you need a pass to get in...  ?  Is it possible to intercept keys without using mutators or interactions?</p>
<p><em class="em2">Kungfu Hampster:</em> I don't think so.  There might be a way to grab the inputs from the playercontroller class, but using an interaction is really the best way to grab keypresses in my opinion.</p>
<p><em class="em2">Mindcry:</em> I did some quick testing with stopwatch and found that: </p>
<pre class="uscript">tmp <span class="uscript-operator">=</span> ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>ConsoleCommand<span class="uscript-operator">(</span><span class="uscript-string">"KEYBINDING"</span><span class="uscript-operator">@</span>ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>ConsoleCommand<span class="uscript-operator">(</span><span class="uscript-string">"KEYNAME"</span><span class="uscript-operator">@</span>Key<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span></pre><p>is about 3.3x faster than the</p>
<pre class="uscript">   tmp <span class="uscript-operator">=</span> ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>ConsoleCommand<span class="uscript-operator">(</span><span class="uscript-string">"KEYNAME"</span><span class="uscript-operator">@</span>Key<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
   tmp <span class="uscript-operator">=</span> ViewportOwner<span class="uscript-operator">.</span>Actor<span class="uscript-operator">.</span>ConsoleCommand<span class="uscript-operator">(</span><span class="uscript-string">"KEYBINDING"</span><span class="uscript-operator">@</span>tmp<span class="uscript-operator">)</span><span class="uscript-operator">;</span></pre><p>found in base UT2004 code and several examples throughout this wiki.</p>
</div>
</div>

<div id="footer" class="bar">
	<p><form method="post" action="http://wiki.beyondunreal.com/wiki" enctype="application/x-www-form-urlencoded">
<a href="(start).html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a> | <a href="http://wiki.beyondunreal.com/wiki?action=editprefs">Preferences</a><br>
<a href="http://wiki.beyondunreal.com/wiki?action=edit&id=Keypress_Interactions">Edit text of this page</a> | <a href="http://wiki.beyondunreal.com/wiki?action=history&id=Keypress_Interactions">View other revisions</a><br>Last edited September 27, 2005 14:37 <a href="http://wiki.beyondunreal.com/wiki?action=browse&diff=1&id=Keypress_Interactions">(diff)</a><br>Search: <input type="text" name="search"  size="20" /><input type="hidden" name="dosearch" value="1"  /><br><br><small><a href="http://wiki.beyondunreal.com/wiki/Keypress_Interactions">Original page</a> &#150; copy created Sat, Jun 23, 2007</small><div></div>
</form>
	</p>
	<p>The three virtues of a programmer: Laziness, Impatience, and Hubris. (Larry Wall)
</p>
</div>
</div><!-- close of "scrolling" div -->

<div id="quickbar">
	<div id="logo"><a href="http://wiki.beyondunreal.com/"><img src="shared/wikilogo.jpg" width="143" height="100" border="0"></a>
		</div>
	<div class="qbsitename">
		<p>The Unreal Engine Documentation Site</p>
	</div>
	<div class="qbsection">
<p><a href="metatopics.html">Wiki Community</a></p>
<p><a href="category-category.html">Topic Categories</a></p>
<p><a href="/cgi-bin/imageupload.cgi/wiki-ext/imageupload.htt" target="_blank ">Image Uploads</a></p>
<p><a href="http://wiki.beyondunreal.com/wiki?action=random">Random Page</a></p>
<p><a href="recent-changes.html">Recent Changes</a></p>
<p><a href="offline-wiki.html">Offline Wiki</a></p>
</div><div class="qbsection">
<p><a href="unreal-engine.html">Unreal Engine</a></p>
<p><a href="console-commands.html">Console Commands</a></p>
<p><a href="terminology.html">Terminology</a></p>
<p><a href="category-faq.html">FAQs</a></p>
<p><a href="help-desk.html">Help Desk</a></p>
</div><div class="qbsection">
<p><a href="topics-on-mapping.html">Mapping Topics</a></p>
<p><a href="mapping-lessons.html">Mapping Lessons</a></p>
<p><a href="unrealed-3.html">UnrealEd Interface</a></p>
</div><div class="qbsection">
<p><a href="unrealscript.html">UnrealScript Topics</a></p>
<p><a href="unrealscript-lessons.html">UnrealScript Lessons</a></p>
<p><a href="making-mods.html">Making Mods</a></p>
<p><a href="class-tree.html">Class Tree</a></p>
</div><div class="qbsection">
<p><a href="topics-on-modeling.html">Modeling Topics</a></p>
</div><div class="qbsection">
<p><a href="chongqing-page.html">Chongqing Page</a></p>
<p><a href="log-in.html">Log In</a></p></div>
</div>

</body></html>
