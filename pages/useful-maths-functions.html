<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head lang="en">
	<title>UnrealWiki: Useful Maths Functions</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<link rel="stylesheet" type="text/css" media="screen, print"
		href="shared/stylebase.structural.css">	
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/template-default.css">
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/styles.chblue.css">
	<link rel="stylesheet" type="text/css" media="print"
		href="shared/template-default-print.css">
	<!--[if IE 6]>
			<style>
			/* dirty hack for IE6. */
			#quickbar {
				position: absolute;
				}
			</style>
	<![endif]-->
  <link rel="start" href="http://wiki.beyondunreal.com/">
  <link rel="glossary"  href="http://wiki.beyondunreal.com/wiki/Terminology">
  <link rel="help"  href="http://wiki.beyondunreal.com/wiki/Using_The_Wiki">
<script type="text/javascript" src="shared/dhtml.js"></script>
<script type="text/javascript" src="shared/dhtml-menu.js"></script>
<style type="text/css">#dhtml-menu    { background: #eee; padding: 5px 0px; margin-right: -20px; border: 1px solid #888; border-left: 1px solid #ccc; border-top: 1px solid #ccc;  border-right: 1px solid #888; border-bottom: 1px solid #888 }
#dhtml-menu td { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; padding: 1px 10px; cursor: default }
#dhtml-menu a  { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; text-decoration: none }
#dhtml-menu tt { font-family: monospace; font-size: 9pt }
#dhtml-menu-separator { height: 1px; background: red }
#dhtml-menu-anchor { cursor: default }
</style>
<script type="text/javascript" src="shared/expandable.js"></script>
</head>
<body onLoad="menuInit(); document.cookie='page=Useful_Maths_Functions; path=/'" class="default">
<div id="scrolling"><!-- contains all except the fixed sidebar -->
<div id="topbar"  class="bar">
	<div class="righthalf">
		<input type="text" name="search"  size="14" /> <input type="button" onclick="location.href='../search-error/index.html';" value="search" />
	</div>
	<div class="lefthalf">
		<script type="text/javascript"><!--
			menuAlignRight = false;
		//--></script>
		<span><script type="text/javascript"><!--
 menuWriteAnchor("Quick Navigation") //--></script></span> | <a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a>
	</div>
</div>

<div id="content"><!-- contains the title and article -->
	<h1 class='pagetitle'><a href="http://wiki.beyondunreal.com/wiki?back=Useful Maths Functions">Useful Maths Functions</a></h1>
	<div class="wiki"><p>Some useful functions and operators to fill in some of UnrealScript's gaps. See also:</p>
<ul><li><a href="scripting-operators.html">Scripting Operators</a> for more information and other examples.</li>
<li><a href="global-function.html">Global Function</a>s for built-in maths functions</li>
</ul>
<p>See <a href="useful-maths-functions-clea.html">/Cleanup</a></p>
<h2><a name="0.1"></a>Number functions and operators</h2>
<h3><a name="0.1.1"></a>divides </h3>
<p>This is an operator that returns true if A is a divisor of B: for example:</p>
<pre class="paraverbatim"> ( 3 divides 5 ) is false
 ( 3 divides 6 ) is true</pre><pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">operator</span><span class="uscript-operator">(</span><span class="uscript-number">24</span><span class="uscript-operator">)</span> <span class="uscript-type">bool</span> divides <span class="uscript-operator">(</span> <span class="uscript-type">float</span> A <span class="uscript-operator">,</span> <span class="uscript-type">float</span> B <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  B <span class="uscript-operator">/=</span> A<span class="uscript-operator">;</span>
  <span class="uscript-keyword">return</span> <span class="uscript-type">int</span><span class="uscript-operator">(</span>B<span class="uscript-operator">)</span> <span class="uscript-operator">==</span> B<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p><em class="em2">Dante:</em> This won't work in most cases because of precision issues with floats. It should "return abs(int(B) - B) &lt; EPS;" with a small EPS value.</p>
<p><em class="em2">Wormbo:</em> Or simply use the ~= operator. (equality after rounding to only a few digits after the comma)</p>
<p><em class="em2">Tarquin:</em> Why would you use numbers with decimals here anyway? The concept is only useful for whole numbers. The given B should be a whole number. </p>
<p><em class="em2">Wormbo:</em> In that case a simple check for <code>B % A == 0</code> should do the trick, possibly after overriding the % operator for int operands so the results are accurate for large values as well.</p>
<p><em class="em2">Tarquin:</em> True, but I wrote the divides operator because I wanted my code to be easily legible <img alt=":)" src="emoticons/smile.gif" align="middle"></p>
<h3><a name="0.1.2"></a>sgn </h3>
<p>This is a function that crops up in maths from time to time, that has proved useful on occasion in UnrealScript. It returns -1, 0 or +1 depending on the sign of the input.</p>
<pre class="uscript"><span class="uscript-keyword">function</span> <span class="uscript-type">float</span> Sgn<span class="uscript-operator">(</span> <span class="uscript-type">float</span> theValue <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">if</span><span class="uscript-operator">(</span> theValue <span class="uscript-operator">==</span> <span class="uscript-number">0</span> <span class="uscript-operator">)</span>
    <span class="uscript-keyword">return</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">return</span> theValue <span class="uscript-operator">/</span> Abs<span class="uscript-operator">(</span>theValue<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h3><a name="0.1.3"></a>Modulo operator </h3>
<p>UnrealScript already has a modulus operator, <code>%</code> but its behaviour with negative numbers is not consistent with the mathematical definition:</p>
<p class="indent1">UnrealScript says -8 % 10 = -8 </p>
<p class="indent1">Maths says -8 % 10 = 2</p>
<p>Interestingly enough, this also occurs with C's own % operator, showing the source of the "bug".</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">operator</span><span class="uscript-operator">(</span><span class="uscript-number">18</span><span class="uscript-operator">)</span> <span class="uscript-type">float</span> mod  <span class="uscript-operator">(</span> <span class="uscript-type">float</span> A<span class="uscript-operator">,</span> <span class="uscript-type">float</span> B <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">if</span><span class="uscript-operator">(</span> A <span class="uscript-operator">%</span> B <span class="uscript-operator">&gt;=</span> <span class="uscript-number">0</span> <span class="uscript-operator">)</span>
    <span class="uscript-keyword">return</span> A <span class="uscript-operator">%</span> B <span class="uscript-operator">;</span>
  <span class="uscript-keyword">else</span>
    <span class="uscript-keyword">return</span> <span class="uscript-operator">(</span> A <span class="uscript-operator">%</span> B <span class="uscript-operator">)</span> <span class="uscript-operator">+</span> B <span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p><em class="em2">j3rky:</em> Sorry, but this is complete nonsense. The modulo operator is defined as the remainder after integer division of its first argument by its second argument. The integer remainder of -8 divided by 10 is -8, the behaviour of UnrealScript and, of course, all C and C++ compilers is correct. Your misunderstanding may be based on the fact that the modulo operator for A % B, where A is a POSITIVE integer, can be implemented as <em class="em1">while (A &gt;= B) { A -= B; }</em>. However, this doesn't mean that for negative integers it has to be implemented as <em class="em1">while (A + B &lt; B) { A += B }</em>.</p>
<p><em class="em2">Chinju:</em> Well, actually, many would consider the remainder after integer division of -8 divided by 10 to be 2, thinking that -8 == -1 * 10 + 2. In fact, (-8)/10 can be implemented as  either -1 or 0 and (-8)%10 can be implemented as either -8 or 2 by a compliant C compiler, so even the C standard allows us to use the proposed "mathematical" definition of modulus. That having been said, there isn't one single mathematical definition of the modulus operator, but it's fairly conventional to define it in such a way that 0 &lt;= a mod n &lt; n (by sending a mod n to the equivalence class of integers modulo n containing a, and then designating that class by its unique member in the appropriate range).</p>
<p><em class="em2">j3rky:</em> I think we have to be more accurate here. First of all, there IS a mathematical definition of the modulus operator which has been created a long time before computers were invented. It is based on equivalence classes and can be written out as <em class="em1">remainder = A - (B * q)</em>, where <em class="em1">q</em> is as large as possible without exceeding the magnitude of the true quotient of <em class="em1">A / B</em>, and <em class="em1">q</em> will have the same sign as <em class="em1">A / B</em>. This will always lead to positive remainders, and in our case it would actually be <em class="em1">2</em> (the remainder can be thought of as "borrowed" from <em class="em1">B * q</em>). In computational arithmetics, however, the modulus operator is defined as the remainder of the integer division of <em class="em1">A / B</em>, and therefore the remainder will be negative if <em class="em1">A &lt; 0</em>. Now the ugly part begins when dealing with floating-point numbers because the floating-point implementation of the modulus operator is not the same as the so called "remainder" operation as defined by IEEE. In IEEE 754 the remainder operation is a rounding division, not a truncating division, and therefore complies with the historical definition based on equivalence classes. In computational arithmetics on the other hand, the floating-point modulus operator is usually implemented analogous to the integer remainder operation. This is especially true for the floating-point % operator in Java and various scripting languages, as well as the <em class="em1">fmod</em> function in C (which is also used in UnrealScript).</p>
<p><em class="em2">Foogod:</em> Heh.. Actually, j3rky, I think you just said exactly the same thing as the original text above does:  <em class="em1">The typical definition of the "modulo" operator in computational arithmetics (remainder) is not the same as the traditional mathematical definition of a "modulus" ("A - (B * q)")</em> (so basically, you just agreed with what you had called "nonsense" earlier).  To be strictly clear, in programming, the modulo operator for integers is typically defined by the equivalence: A = (A / B) * B + (A % B).  Thus the sign for negative operands depends on what the result of integer division is for negative numbers, which varies from language to language (and in some cases, from computer to computer for the same language).  As far as floating point numbers, the typical definition of a modulo operator for floating point numbers derives from the equivalence: A = floor(A / B) * B + (A % B), and thus depends on the definition of the "floor" operation for negative numbers, which also varies from language to language (hopefully, but not always, consistently with integer division).</p>
<p>Regardless of any of this discussion, however, the point remains that both forms of "modulo" operation are useful in different contexts, and therefore it is useful to have the alternative form available, which is why it's here.</p>
<p><em class="em2">Sweavo:</em> If have an integer input and you want to bound your value to a nice binary number, e.g. [0..7] or [0..255] then you can do this efficiently and elegantly using masking:</p>
<pre class="uscript">val_5bits <span class="uscript-operator">&amp;</span><span class="uscript-operator">=</span> <span class="uscript-number">0x001f</span><span class="uscript-operator">;</span> 
val_6bits <span class="uscript-operator">&amp;</span><span class="uscript-operator">=</span> <span class="uscript-number">0x003f</span><span class="uscript-operator">;</span> 
val_6bits <span class="uscript-operator">&amp;</span><span class="uscript-operator">=</span> <span class="uscript-number">0x007f</span><span class="uscript-operator">;</span> 
val_8bits <span class="uscript-operator">&amp;</span><span class="uscript-operator">=</span> <span class="uscript-number">0x00ff</span><span class="uscript-operator">;</span></pre><p>Whatever val_5bits had in there before, it's had its more significant bits thrown away.  Great for keeping track of rotation for example, and has the desirable properties described (as long as your mask value is all binary ones from whenever it starts down till the end).</p>
<h3><a name="0.1.4"></a>Modulo operator for Integers</h3>
<p>UnrealScript's modulo operator <code>%</code> takes float parameters, but this can cause precision errors for large integers. The following implementation overrides the operator for integer parameters and works exactly as the built-in float version:</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">operator</span><span class="uscript-operator">(</span><span class="uscript-number">18</span><span class="uscript-operator">)</span> <span class="uscript-type">int</span> <span class="uscript-operator">%</span> <span class="uscript-operator">(</span><span class="uscript-type">int</span> A<span class="uscript-operator">,</span> <span class="uscript-type">int</span> B<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">return</span> A <span class="uscript-operator">-</span> <span class="uscript-operator">(</span>A <span class="uscript-operator">/</span> B<span class="uscript-operator">)</span> <span class="uscript-operator">*</span> B<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Note that the implementation exhibits the same "non-mathematical" behavior for negative numbers as the float version. See the previous section for a potential fix.</p>
<p><em class="em2">UArch</em> shouldnt this be A - (A / B) * B;? <img alt=":P" src="emoticons/tongue.gif" align="middle"> ...fixed</p>
<h3><a name="0.1.5"></a>Log </h3>
<p>UnrealScript has a natural log (Loge) function, but no log with a variable base.  This function allows that. 10 is the default if 0 or no base is passed:</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">float</span> Logarithm <span class="uscript-operator">(</span><span class="uscript-type">float</span> a<span class="uscript-operator">,</span> <span class="uscript-keyword">optional</span> <span class="uscript-type">float</span> Base<span class="uscript-operator">)</span><span class="uscript-operator">{</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Base<span class="uscript-operator">==</span><span class="uscript-number">0</span><span class="uscript-operator">)</span>
    Base<span class="uscript-operator">=</span><span class="uscript-number">10</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">return</span> Loge<span class="uscript-operator">(</span>a<span class="uscript-operator">)</span><span class="uscript-operator">/</span>Loge<span class="uscript-operator">(</span>base<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h3><a name="0.1.6"></a>Next power of 2 </h3>
<p>Returns the next power of 2 or the input value if it is already a power of 2:</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">int</span> NextPowerOfTwo<span class="uscript-operator">(</span> <span class="uscript-keyword">coerce</span> <span class="uscript-type">int</span> in <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
in <span class="uscript-operator">-=</span> <span class="uscript-number">1</span><span class="uscript-operator">;</span>
in <span class="uscript-operator">=</span> in <span class="uscript-operator">|</span> <span class="uscript-operator">(</span>in <span class="uscript-operator">&gt;&gt;</span> <span class="uscript-number">16</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
in <span class="uscript-operator">=</span> in <span class="uscript-operator">|</span> <span class="uscript-operator">(</span>in <span class="uscript-operator">&gt;&gt;</span> <span class="uscript-number">8</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
in <span class="uscript-operator">=</span> in <span class="uscript-operator">|</span> <span class="uscript-operator">(</span>in <span class="uscript-operator">&gt;&gt;</span> <span class="uscript-number">4</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
in <span class="uscript-operator">=</span> in <span class="uscript-operator">|</span> <span class="uscript-operator">(</span>in <span class="uscript-operator">&gt;&gt;</span> <span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
in <span class="uscript-operator">=</span> in <span class="uscript-operator">|</span> <span class="uscript-operator">(</span>in <span class="uscript-operator">&gt;&gt;</span> <span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">return</span> in <span class="uscript-operator">+</span> <span class="uscript-number">1</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p><em class="em2">Tarquin:</em> Why not just use log?</p>
<p><em class="em2">Switch`:</em> True, log may be better. Do you mean something like this?</p>
<pre class="uscript"><span class="uscript-keyword">final</span> <span class="uscript-keyword">static</span> <span class="uscript-keyword">function</span> <span class="uscript-type">int</span> NextPowerOfTwo<span class="uscript-operator">(</span> <span class="uscript-keyword">coerce</span> <span class="uscript-type">int</span> in <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">return</span> <span class="uscript-number">1</span> <span class="uscript-operator">&lt;&lt;</span> <span class="uscript-type">int</span><span class="uscript-operator">(</span>Loge<span class="uscript-operator">(</span>in<span class="uscript-number">-1</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> Loge<span class="uscript-operator">(</span><span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">+</span><span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>


<span class="uscript-keyword">final</span> <span class="uscript-keyword">static</span> <span class="uscript-keyword">function</span> <span class="uscript-type">int</span> PrevPowerOfTwo<span class="uscript-operator">(</span> <span class="uscript-keyword">coerce</span> <span class="uscript-type">int</span> in <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">return</span> <span class="uscript-number">1</span> <span class="uscript-operator">&lt;&lt;</span> <span class="uscript-type">int</span><span class="uscript-operator">(</span>Loge<span class="uscript-operator">(</span>in<span class="uscript-operator">)</span> <span class="uscript-operator">/</span> Loge<span class="uscript-operator">(</span><span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Log method is faster by about 30%.</p>
<p><em class="em2">Foxpaw:</em> This is interesting. Why is the log method faster? Shifting and or-ing seems like it should be MUCH faster. Is the difference in the overhead from the Unrealscript interpreter?</p>
<p><em class="em2">Foogod:</em> In C I'm fairly certain that the bit-shifting approach would be much faster, but in UnrealScript it's very likely that the interpreter overhead would outweigh anything else.  We are talking about (at least) 12 interpreter operations for the shifting version as opposed to 6 for the log version, which means half as many runs through a potentially fairly complicated (with OO and all) interpreter loop.  The moral of this story:  Do as little as you can in UnrealScript and use native functions as much as possible, even expensive natives are better than a bunch of cheap UnrealScript operations.</p>
<p><em class="em2">Sweavo:</em> have you actually tried that or are you theorising?  Just interested to know how sure we are of these findings!</p>
<h3><a name="0.1.7"></a>Bitwise Switch</h3>
<p><em class="em2">Kohan:</em> This was something I came up with when trying to compare binary to chromosomes; when cells perform meiosis, their chromosomes collide and switch chromatids at the point of collision.  I decided to port this to a bitwise function that I figured could be used for some sort of breeding game, I don't know.  I just think it's cool.</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">int</span> BitSwitch<span class="uscript-operator">(</span> <span class="uscript-type">int</span> A<span class="uscript-operator">,</span> <span class="uscript-type">int</span> B<span class="uscript-operator">,</span> <span class="uscript-type">int</span> C <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">return</span> a <span class="uscript-operator">^</span> <span class="uscript-operator">(</span>a <span class="uscript-operator">^</span> b<span class="uscript-operator">)</span> <span class="uscript-operator">&amp;</span> c<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Now, what this does is it compares A and B and switches their bits when C's respective bit is 1 (C represents random occurences of collision) and returns the resulting A.  Example:</p>
<pre class="uscript"><span class="uscript-number">01010100</span> A
<span class="uscript-number">10101001</span> B
<span class="uscript-number">10101010</span> C
<span class="uscript-operator">--</span><span class="uscript-operator">--</span><span class="uscript-operator">--</span><span class="uscript-operator">--</span> <span class="uscript-keyword">Switch</span>
<span class="uscript-number">11111100</span></pre><p>I guess those weren't the best random numbers...  Anyway, that's the idea.  The human logic is that you are switching bits.  In computer terms, it is pretty pointless to switch a 1 and a 1, or a 0 and a 0, so a XOR is performed on A and B, resulting in a list of valid switching bits.  Second, this list is ANDed with C, further decreasing the number of bits to be flipped (usually).  So, if you were to Switch an A and B with a maximum-numerical-value C, you would effectively switch their values, or, at least, return a value of B.  Let us take the above example:</p>
<pre class="uscript"><span class="uscript-number">01010100</span> A
<span class="uscript-number">10101001</span> B
<span class="uscript-number">11111111</span> C
<span class="uscript-operator">--</span><span class="uscript-operator">--</span><span class="uscript-operator">--</span><span class="uscript-operator">--</span> <span class="uscript-keyword">Switch</span>
<span class="uscript-number">10101001</span></pre><p>Well, I do hope I'm not pointless, and I hope someone might someday use this <img alt=":)" src="emoticons/smile.gif" align="middle">.</p>
<h2><a name="0.2"></a>Trigonometic functions</h2>
<p>Unrealscript includes Sin, Cos, Tan, and arcTan functions, defined in the <a href="object.html">Object</a> class.  The sin, cos, and tan assume an angle in radians is passed and aTan will return an angle in radians.  Here are some const conversions:</p>
<pre class="uscript"><span class="uscript-keyword">Const</span> RadianToDegree <span class="uscript-operator">=</span> <span class="uscript-number">57.2957795131</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">Const</span> DegreeToRadian <span class="uscript-operator">=</span> <span class="uscript-number">0.01745329252</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">Const</span> RadianToURot <span class="uscript-operator">=</span> <span class="uscript-number">10430.3783505</span><span class="uscript-operator">;</span>
<span class="uscript-keyword">Const</span> URotToRadian <span class="uscript-operator">=</span> <span class="uscript-number">0.000095873799</span><span class="uscript-operator">;</span></pre><p>Where URot is an unreal rotation unit (used in <a href="rotator.html">rotator</a>s).</p>
<h4><a name="0.2.0.1"></a>arcSin function</h4>
<p>Inverse Sin function. Pass the sin of an angle, and it returns the angle: </p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">float</span> ASin  <span class="uscript-operator">(</span> <span class="uscript-type">float</span> A <span class="uscript-operator">)</span><span class="uscript-operator">{</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>A<span class="uscript-operator">&gt;</span><span class="uscript-number">1</span><span class="uscript-operator">||</span>A<span class="uscript-operator">&lt;</span><span class="uscript-operator">-</span><span class="uscript-number">1</span><span class="uscript-operator">)</span> <span class="uscript-comment">//outside domain!</span>
    <span class="uscript-keyword">return</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>A<span class="uscript-operator">==</span><span class="uscript-number">1</span><span class="uscript-operator">)</span>  <span class="uscript-comment">//div by 0 checks</span>
    <span class="uscript-keyword">return</span> Pi<span class="uscript-operator">/</span><span class="uscript-number">2.0</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>A<span class="uscript-operator">==</span><span class="uscript-operator">-</span><span class="uscript-number">1</span><span class="uscript-operator">)</span>
    <span class="uscript-keyword">return</span> Pi<span class="uscript-operator">/</span><span class="uscript-operator">-</span><span class="uscript-number">2.0</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">return</span> ATan<span class="uscript-operator">(</span>A<span class="uscript-operator">/</span>Sqrt<span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">-</span>Square<span class="uscript-operator">(</span>A<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h4><a name="0.2.0.2"></a>arcCos funtion</h4>
<p>Inverse Cosine funtion.  Pass the cosine of an angle and the angle is returned:</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">float</span> ACos  <span class="uscript-operator">(</span> <span class="uscript-type">float</span> A <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>A<span class="uscript-operator">&gt;</span><span class="uscript-number">1</span><span class="uscript-operator">||</span>A<span class="uscript-operator">&lt;</span><span class="uscript-operator">-</span><span class="uscript-number">1</span><span class="uscript-operator">)</span> <span class="uscript-comment">//outside domain!</span>
    <span class="uscript-keyword">return</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>A<span class="uscript-operator">==</span><span class="uscript-number">0</span><span class="uscript-operator">)</span> <span class="uscript-comment">//div by 0 check</span>
    <span class="uscript-keyword">return</span> <span class="uscript-operator">(</span>Pi<span class="uscript-operator">/</span><span class="uscript-number">2.0</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  A<span class="uscript-operator">=</span>ATan<span class="uscript-operator">(</span>Sqrt<span class="uscript-operator">(</span><span class="uscript-number">1.0</span><span class="uscript-operator">-</span>Square<span class="uscript-operator">(</span>A<span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">/</span>A<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>A<span class="uscript-operator">&lt;</span><span class="uscript-number">0</span><span class="uscript-operator">)</span>
    A<span class="uscript-operator">+=</span>Pi<span class="uscript-operator">;</span>
  <span class="uscript-keyword">Return</span> A<span class="uscript-operator">;</span>

<span class="uscript-operator">}</span></pre><h4><a name="0.2.0.3"></a>aTan2 funtion</h4>
<p>ArcTangent2. Pass the adjacent triangle leg as X and the opposite leg as Y (or X compoent, Y compont of a triangle inscribed in a unit circle).: </p>
<p>Note that if Y and X are 0, it will return 0, although in reality there is no answer (no line = no angle).   The ratio allows for more exact angles (i.e. anywhere on the unit circle, rather than just 1/2 of it).</p>
<pre class="uscript"><span class="uscript-keyword">final</span> <span class="uscript-keyword">static</span> <span class="uscript-keyword">function</span> <span class="uscript-type">float</span> ATan2<span class="uscript-operator">(</span><span class="uscript-type">float</span> Y<span class="uscript-operator">,</span><span class="uscript-type">float</span> X<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> tempang<span class="uscript-operator">;</span>
  
  <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>X<span class="uscript-operator">==</span><span class="uscript-number">0</span><span class="uscript-operator">)</span> <span class="uscript-operator">{</span> <span class="uscript-comment">//div by 0 checks.</span>
    <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>Y<span class="uscript-operator">&lt;</span><span class="uscript-number">0</span><span class="uscript-operator">)</span>
      <span class="uscript-keyword">return</span> <span class="uscript-operator">-</span>pi<span class="uscript-operator">/</span><span class="uscript-number">2.0</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>Y<span class="uscript-operator">&gt;</span><span class="uscript-number">0</span><span class="uscript-operator">)</span>
      <span class="uscript-keyword">return</span> pi<span class="uscript-operator">/</span><span class="uscript-number">2.0</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">else</span>
      <span class="uscript-keyword">return</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span> <span class="uscript-comment">//technically impossible (nothing exists)</span>
  <span class="uscript-operator">}</span>
  tempang<span class="uscript-operator">=</span>ATan<span class="uscript-operator">(</span>Y<span class="uscript-operator">/</span>X<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>X<span class="uscript-operator">&lt;</span><span class="uscript-number">0</span><span class="uscript-operator">)</span>
    tempang<span class="uscript-operator">+=</span>pi<span class="uscript-operator">;</span>  <span class="uscript-comment">//1st/3rd quad</span>
  
  <span class="uscript-comment">//normalize (from -pi to pi)</span>
  <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>tempang<span class="uscript-operator">&gt;</span>pi<span class="uscript-operator">)</span> 
    tempang<span class="uscript-operator">-=</span>pi<span class="uscript-operator">*</span><span class="uscript-number">2.0</span><span class="uscript-operator">;</span>
  
  <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>tempang<span class="uscript-operator">&lt;</span><span class="uscript-operator">-</span>pi<span class="uscript-operator">)</span>
    tempang<span class="uscript-operator">+=</span>pi<span class="uscript-operator">*</span><span class="uscript-number">2.0</span><span class="uscript-operator">;</span>
  
  <span class="uscript-keyword">return</span> tempang<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h4><a name="0.2.0.4"></a>aSin2 funtion</h4>
<p>ArcSin2: a more precise asin. Y=opposite leg, R=radius/hypotenuse. Of course if R is 0, no line exists, so it will return 0. Note that this assumes you put the asin code in your script. </p>
<pre class="uscript"><span class="uscript-keyword">final</span> <span class="uscript-keyword">static</span> <span class="uscript-keyword">function</span> <span class="uscript-type">float</span> ASin2<span class="uscript-operator">(</span><span class="uscript-type">float</span> Y<span class="uscript-operator">,</span><span class="uscript-type">float</span> Rad<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> tempang<span class="uscript-operator">;</span>
  
  <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>Rad<span class="uscript-operator">==</span><span class="uscript-number">0</span><span class="uscript-operator">)</span>
     <span class="uscript-keyword">return</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span> <span class="uscript-comment">//technically impossible (no hypotenuse = nothing)</span>
  tempang<span class="uscript-operator">=</span>ASin<span class="uscript-operator">(</span>Y<span class="uscript-operator">/</span>Rad<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Rad<span class="uscript-operator">&lt;</span><span class="uscript-number">0</span><span class="uscript-operator">)</span>
    tempang<span class="uscript-operator">=</span>pi<span class="uscript-operator">-</span>tempang<span class="uscript-operator">;</span>  <span class="uscript-comment">//lower quads</span>
  
  <span class="uscript-keyword">return</span> tempang<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h4><a name="0.2.0.5"></a>aCos2 funtion</h4>
<p>a more precise acos. X=adjecent leg, R=opposite. Other rules are similar to ASin2: </p>
<pre class="uscript"><span class="uscript-keyword">final</span> <span class="uscript-keyword">static</span> <span class="uscript-keyword">function</span> <span class="uscript-type">float</span> ACos2<span class="uscript-operator">(</span><span class="uscript-type">float</span> X<span class="uscript-operator">,</span><span class="uscript-type">float</span> Rad<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> tempang<span class="uscript-operator">;</span>
  
  <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>Rad<span class="uscript-operator">==</span><span class="uscript-number">0</span><span class="uscript-operator">)</span>
     <span class="uscript-keyword">return</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span> <span class="uscript-comment">//no possible angle</span>
  tempang<span class="uscript-operator">=</span>ACos<span class="uscript-operator">(</span>X<span class="uscript-operator">/</span>Rad<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  
  <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>X<span class="uscript-operator">&lt;</span><span class="uscript-number">0</span><span class="uscript-operator">)</span>
    tempang<span class="uscript-operator">*=</span><span class="uscript-operator">-</span><span class="uscript-number">1</span><span class="uscript-operator">;</span>  <span class="uscript-comment">//left quads</span>
  
  <span class="uscript-keyword">return</span> tempang<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h2><a name="0.3"></a>Vector operators</h2>
<p>Some simple vector operators, since most operators that you could want for vector have already been defined.</p>
<pre class="uscript"><span class="uscript-comment">// Extend vector by an unit length</span>
<span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">preoperator</span> vector <span class="uscript-operator">++</span> <span class="uscript-operator">(</span> <span class="uscript-keyword">out</span> vector A <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">return</span> A <span class="uscript-operator">+=</span> Normal<span class="uscript-operator">(</span>A<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>
<span class="uscript-comment">// Shrink operator by an unit length</span>
<span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">preoperator</span> vector <span class="uscript-operator">--</span> <span class="uscript-operator">(</span> <span class="uscript-keyword">out</span> vector A <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">return</span> A <span class="uscript-operator">-=</span> Normal<span class="uscript-operator">(</span>A<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-comment">// Same thing, but postop</span>
<span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">postoperator</span> vector <span class="uscript-operator">++</span> <span class="uscript-operator">(</span> <span class="uscript-keyword">out</span> vector A <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> vector B<span class="uscript-operator">;</span>
  B <span class="uscript-operator">=</span> A<span class="uscript-operator">;</span>
  A <span class="uscript-operator">+=</span> Normal<span class="uscript-operator">(</span>A<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">return</span> B<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">postoperator</span> vector <span class="uscript-operator">--</span> <span class="uscript-operator">(</span> <span class="uscript-keyword">out</span> vector A <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">local</span> vector B<span class="uscript-operator">;</span>
  B <span class="uscript-operator">=</span> A<span class="uscript-operator">;</span>
  A <span class="uscript-operator">+=</span> Normal<span class="uscript-operator">(</span>A<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
  <span class="uscript-keyword">return</span> B<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><h4><a name="0.3.0.1"></a>Rotate vector</h4>
<p>Rotate one vector towards another vector. </p>
<pre class="uscript"><span class="uscript-comment">//Rotate vector A towards vector B, an amount of degrees.</span>
<span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> RotateVector<span class="uscript-operator">(</span> <span class="uscript-keyword">out</span> vector A<span class="uscript-operator">,</span> vector B<span class="uscript-operator">,</span> <span class="uscript-type">float</span> Degree <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> Magnitude<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> vector C<span class="uscript-operator">;</span>

    Degree <span class="uscript-operator">=</span> Degree <span class="uscript-operator">*</span> Pi <span class="uscript-operator">/</span> <span class="uscript-number">180.0</span><span class="uscript-operator">;</span><span class="uscript-comment">//Convert to radians.</span>
    Magnitude <span class="uscript-operator">=</span> VSize<span class="uscript-operator">(</span>A<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    A <span class="uscript-operator">=</span> Normal<span class="uscript-operator">(</span>A<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    B <span class="uscript-operator">=</span> Normal<span class="uscript-operator">(</span>B<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span><span class="uscript-operator">(</span> A <span class="uscript-operator">Dot</span> B <span class="uscript-operator">==</span> <span class="uscript-operator">-</span><span class="uscript-number">1.0</span> <span class="uscript-operator">)</span><span class="uscript-comment">//Vectors are pointing in opposite directions.</span>
        B<span class="uscript-operator">.</span>x <span class="uscript-operator">+=</span> <span class="uscript-number">0.0001</span><span class="uscript-operator">;</span><span class="uscript-comment">//fudge it a little</span>

    C <span class="uscript-operator">=</span> Normal<span class="uscript-operator">(</span>B <span class="uscript-operator">-</span> <span class="uscript-operator">(</span>A <span class="uscript-operator">Dot</span> B<span class="uscript-operator">)</span> <span class="uscript-operator">*</span> A<span class="uscript-operator">)</span><span class="uscript-operator">;</span><span class="uscript-comment">//This forms a right angle with A</span>

    A <span class="uscript-operator">=</span> Normal<span class="uscript-operator">(</span> A <span class="uscript-operator">*</span> Cos<span class="uscript-operator">(</span>Degree<span class="uscript-operator">)</span> <span class="uscript-operator">+</span> C <span class="uscript-operator">*</span> Sin<span class="uscript-operator">(</span>Degree<span class="uscript-operator">)</span> <span class="uscript-operator">)</span> <span class="uscript-operator">*</span> Magnitude<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Example of RotateVector:</p>
<pre class="uscript"><span class="uscript-keyword">class</span> MySeekingRocket <span class="uscript-keyword">extends</span> SeekingRocketProj<span class="uscript-operator">;</span>

<span class="uscript-keyword">var</span><span class="uscript-operator">(</span><span class="uscript-operator">)</span> <span class="uscript-type">float</span> TurnRate<span class="uscript-operator">;</span><span class="uscript-comment">//in degrees</span>

<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> Timer<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span><span class="uscript-operator">(</span> Seeking <span class="uscript-operator">!=</span> <span class="uscript-keyword">None</span> <span class="uscript-operator">&amp;&amp;</span> Seeking <span class="uscript-operator">!=</span> Instigator <span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        RotateVector<span class="uscript-operator">(</span> Velocity<span class="uscript-operator">,</span> Seeking<span class="uscript-operator">.</span>Location <span class="uscript-operator">-</span> Location<span class="uscript-operator">,</span> TurnRate <span class="uscript-operator">*</span> TimerRate <span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        SetRotation<span class="uscript-operator">(</span> rotator<span class="uscript-operator">(</span> Velocity<span class="uscript-operator">)</span> <span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">defaultproperties</span>
<span class="uscript-operator">{</span>
    TurnRate<span class="uscript-operator">=</span><span class="uscript-number">25.000000</span>
<span class="uscript-operator">}</span></pre><p><em class="em2">Jon</em> You see the rocket's velocity vector is being rotated toward its target direction</p>
<p>25 degrees per second.</p>
<h2><a name="0.4"></a>Floating-point maths</h2>
<h3><a name="0.4.1"></a>frexp</h3>
<p>Calculates mantissa (a floating-point value between 0.5 and 1) and exponent (an integer value), such that:</p>
<pre class="paraverbatim">    f = mantissa * 2<sup>exponent</sup></pre><p>where f is parameter f, mantissa is the value returned by the function and exponent is set by the function.</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">float</span> frexp<span class="uscript-operator">(</span> <span class="uscript-type">float</span> f<span class="uscript-operator">,</span> <span class="uscript-keyword">out</span> <span class="uscript-type">int</span> e <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> m<span class="uscript-operator">,</span>ex<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> ei<span class="uscript-operator">;</span>
    
    <span class="uscript-keyword">if</span><span class="uscript-operator">(</span> f <span class="uscript-operator">==</span> <span class="uscript-number">0.0</span> <span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        e <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
        <span class="uscript-keyword">return</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span>
    <span class="uscript-operator">{</span>       
        ex <span class="uscript-operator">=</span> Ceil<span class="uscript-operator">(</span>Loge<span class="uscript-operator">(</span>Abs<span class="uscript-operator">(</span>f<span class="uscript-operator">)</span><span class="uscript-operator">)</span> <span class="uscript-operator">/</span> Loge<span class="uscript-operator">(</span><span class="uscript-number">2</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        ei <span class="uscript-operator">=</span> ex<span class="uscript-operator">;</span>
        m <span class="uscript-operator">=</span> ldexp<span class="uscript-operator">(</span>f<span class="uscript-operator">,</span> <span class="uscript-operator">-</span>ei<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        
        <span class="uscript-keyword">while</span><span class="uscript-operator">(</span> Abs<span class="uscript-operator">(</span>m<span class="uscript-operator">)</span> <span class="uscript-operator">&gt;=</span> <span class="uscript-number">1.0</span> <span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            ei<span class="uscript-operator">++</span><span class="uscript-operator">;</span>
            m <span class="uscript-operator">/=</span> <span class="uscript-number">2.0</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
        
        <span class="uscript-keyword">while</span><span class="uscript-operator">(</span> Abs<span class="uscript-operator">(</span>m<span class="uscript-operator">)</span> <span class="uscript-operator">&lt;</span> <span class="uscript-number">0.5</span> <span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            ei<span class="uscript-operator">--</span><span class="uscript-operator">;</span>
            m <span class="uscript-operator">*=</span> <span class="uscript-number">2.0</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
        
        e <span class="uscript-operator">=</span> ei<span class="uscript-operator">;</span>
        <span class="uscript-keyword">return</span> m<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
<span class="uscript-operator">}</span></pre><h3><a name="0.4.2"></a>ldexp</h3>
<p>Calculates the floating point value corresponding to the given mantissa and exponent, such that:</p>
<pre class="paraverbatim">    f = mantissa * 2<sup>exponent</sup></pre><p>where f is the value returned by the function, mantissa is parameter m and exponent is is parameter e.</p>
<pre class="uscript"><span class="uscript-keyword">static</span> <span class="uscript-keyword">final</span> <span class="uscript-keyword">function</span> <span class="uscript-type">float</span> ldexp<span class="uscript-operator">(</span> <span class="uscript-type">float</span> m<span class="uscript-operator">,</span> <span class="uscript-type">int</span> e <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">return</span> m <span class="uscript-operator">*</span> <span class="uscript-operator">(</span><span class="uscript-number">2</span><span class="uscript-operator">*</span><span class="uscript-operator">*</span>e<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><hr class="thin"><p><i>Suggestions:  Firstly, don't use &lt;pre&gt;&lt;/pre&gt;.  Indent your code lines by an arbitary amount of blanks instead (two, for instance) &ndash; that'll make Wiki automatically format them in a monospaced font and with linebreaks preserved, and it makes the code samples stand out better.  Secondly, avoid tabs &ndash; there's no standard way for rendering tabs, so you'll be lucky if it comes out as you wish on other people's computers; better use blanks instead.  &mdash;<a href="mychaeel.html">Mychaeel</a></i></p>
<p class="indent1">thanks <img alt=":-)" src="emoticons/smile.gif" align="middle"> these were a straight copy-paste from a posting I made in Buf-Coding &ndash; <a href="tarquin.html">Tarquin</a></p>
<p class="indent1"><em class="em1">Using &lt;uscript&gt;&lt;/uscript&gt; is way better now. <img alt=":-P" src="emoticons/tongue.gif" align="middle"> &ndash; <a href="wormbo.html">Wormbo</a></em></p>
<p class="indent1"><em class="em1">Indeed.  <img alt=":-)" src="emoticons/smile.gif" align="middle">  By the way, as a potentially useful trivia about &lt;uscript&gt;:  It expands tabs to spaces in four-character steps because that's the setting I believe Epic's coders used (and UnrealEd's script editor does as well).  Best way is to avoid tabs altogether though and indent with spaces...  &mdash;<a href="mychaeel.html">Mychaeel</a></em></p>
<p><i>Personally, I don't see any use of unary vector operators. Perhaps the author can explain their purpose? (though I admit it serves as a demonstration of proper usage of pre/post operator defining)&ndash; <a href="usaar33.html">UsAaR33</a></i></p>
<p><em class="em2">Corran:</em> Does anyone know what the abs() function does? In object.uc it's in the same section as all the trig functions but I can't seem to work out whay it does.</p>
<p><em class="em2">Tarquin:</em> is it abs(float) or abs(vector)? you should move this to <a href="global-function.html">Global Function</a>.</p>
<p><em class="em2">Mychaeel:</em> It returns the absolute value of its argument.  That is, the positive value of the given number.  (And the trigonometric functions only happen to be close to it because they also take a float as their arguments.)</p>
<p><em class="em2">Ironblayde:</em> For the Sgn() function, wouldn't it be better, if theValue turns out to be nonzero, to simply check whether theValue &gt; 0, and then return 1 or -1 as appropriate? A comparison should be faster than a floating-point divide. There are several little things like that in this page where it looks like small, simple optimizations could be made, for example where things like divisions or modulus operations are performed twice when they need only be done once. Maybe those changes don't make a big enough difference in UnrealScript, I don't know.</p>
<p>Also, I don't know if the link might be useful, but this is kind of a cool page that's got some quick little algorithms on it: <a href="http://aggregate.org/MAGIC/">http://aggregate.org/MAGIC/</a></p>
<p><em class="em2">Birelli:</em> A greater than comparison vs. a floating point operation being faster depends a lot on the context of the code. If the floating point processor is just sitting idle, then the given method might literally take no "time" at all to calculate. On the other hand comparison operators are usually highly optimized so they're both probably quite fast depending on the situation. In a general library definition like this though it's impossible to take those things into account.</p>
<p><em class="em2">Foxpaw:</em> Hrmm, you would probrably have to test to find out. It's definately not accurate to say that the floating point divide would take no time if the floating point processor was idle. The FPU on an x86-based computer does not take a "list" of operations to perform and output a list of results, acting asynchronously to the main CPU.</p>
<p>Of course, that's a moot point as a comparison in the x86 architechture takes the form of a subtraction and then a logical test of the sign bit, so with floating point numbers you're going to use the FPU either way. A floating point subtraction is probrably faster than a floating point division, but it's also possible that the time for the FPU to compute is based on a worst case and is not different for different operations. (Unlikely, but possible.)</p>
<p>However, I would speculate that the comparison is almost definately faster as you are not only doing a floating point divide, but also taking the absolute value. This of course is most easily done by just masking off the sign bit, but that still takes at the very least one operation.</p>
<p>Hrm.. however, it's worth noting that the most time consuming part of the entire Sgn() function is the overhead involved in actually calling the function, especially in an object oriented interpreted language like Unrealscript. (in which making a function call is less trivial than it seems, and definately not "free" as some people would have you believe <img alt=";)" src="emoticons/wink.gif" align="middle">) Putting the code in your function directly instead of making it an operator would be faster.</p>
<p>Hrrrrmmmm. Now that I think about it, the theValue == 0 can probrably be optimized by casting it to bool. In assembly lanuage that would work, but I don't know if Unrealscript has any unnecessary overhead for such casting. I guess you'd have to time it to find out.</p>
<p>How's this:</p>
<pre class="uscript"><span class="uscript-keyword">function</span> <span class="uscript-type">float</span> Sgn<span class="uscript-operator">(</span> <span class="uscript-type">float</span> theValue <span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
  <span class="uscript-keyword">if</span><span class="uscript-operator">(</span> <span class="uscript-type">Bool</span><span class="uscript-operator">(</span>theValue<span class="uscript-operator">)</span> <span class="uscript-operator">)</span>
  <span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> theValue <span class="uscript-operator">&gt;</span> <span class="uscript-number">0</span> <span class="uscript-operator">)</span>
      <span class="uscript-keyword">return</span> <span class="uscript-number">1</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">else</span>
      <span class="uscript-keyword">return</span> <span class="uscript-operator">-</span><span class="uscript-number">1</span><span class="uscript-operator">;</span>
  <span class="uscript-operator">}</span>

  <span class="uscript-keyword">return</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span></pre><p>Ah, you know it's optimized when it's no longer readable. <img alt=";)" src="emoticons/wink.gif" align="middle"></p>
<p><em class="em2">Foxpaw:</em> In response to the comment, (that you removed) floating point numbers do have a sign bit and you are correct that that would be faster. However, you cannot do a bitwise and on a floating point number to mask ioff the sign bit like that in Unrealscript. <img alt=":(" src="emoticons/sad.gif" align="middle"></p>
<p><em class="em2">Birelli:</em> I know, that's why I removed it <img alt=";)" src="emoticons/wink.gif" align="middle">. I was thinking in C (I do that a lot) <img alt=":)" src="emoticons/smile.gif" align="middle"></p>
<p><em class="em2">Matariel:</em> Umm guys, bit of a noobie question here but, how come you've listed all of those custom arc functions? Why not just use the arc functions defined in Object? I know that in ut2004 there are arc functions defined in Object; not sure if there are any in UTor ut2003 though <img alt=":p" src="emoticons/tongue.gif" align="middle"></p>
<p><em class="em2">Wormbo:</em> They are new to UnrealEngine2.</p>
<p><em class="em2">Matariel:</em> I see. Alright then <img alt=":D" src="emoticons/biggrin.gif" align="middle"></p>
<p><em class="em2">Solid Snake:</em> See some of the function use a division by 2.0, I think it is faster to simply multiply by 0.5. I've done that in a lot of my code, but never really considered whether it was faster or not. Just as a rule I do that.</p>
<script type="text/javascript"><!--
 menuItemAdd("Number functions and operators", "#0.1");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>divides ", "#0.1.1");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>sgn ", "#0.1.2");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Modulo operator ", "#0.1.3");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Modulo operator for Integers", "#0.1.4");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Log ", "#0.1.5");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Next power of 2 ", "#0.1.6");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Bitwise Switch", "#0.1.7");
menuItemAdd("Trigonometic functions", "#0.2");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>arcSin function", "#0.2.0.1");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>arcCos funtion", "#0.2.0.2");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>aTan2 funtion", "#0.2.0.3");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>aSin2 funtion", "#0.2.0.4");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>aCos2 funtion", "#0.2.0.5");
menuItemAdd("Vector operators", "#0.3");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>Rotate vector", "#0.3.0.1");
menuItemAdd("Floating-point maths", "#0.4");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>frexp", "#0.4.1");
menuItemAdd("<tt>&nbsp;&nbsp;</tt>ldexp", "#0.4.2");
 menuWrite() //--></script></div>
</div>

<div id="footer" class="bar">
	<p>
<a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a><br>
Last edited May 14, 2007 22:05 <a href="http://wiki.beyondunreal.com/wiki?action=browse&diff=1&id=Useful_Maths_Functions">(diff)</a><br>Search: <input type="text" name="search"  size="14" /><input type="button" onclick="location.href='../search-error/index.html';" value="search" /><br><br><small><a href="http://wiki.beyondunreal.com/wiki/Useful_Maths_Functions">Original page</a> &#150; copy created Sat, Jun 23, 2007</small><div></div>

	</p>
	<p>Gah - a solution with more questions. (EntropicLqd)
</p>
</div>
</div><!-- close of "scrolling" div -->

<div id="quickbar">
	<div id="logo"><a href="../index.html"><img src="shared/wikilogo.jpg" width="143" height="100" border="0"></a>
		</div>
	<div class="qbsitename">
		<p>The Unreal Engine Documentation Site</p>
	</div>
	<div class="qbsection">
<p><a href="metatopics.html">Wiki Community</a></p>
<p><a href="category-category.html">Topic Categories</a></p>


<p><a href="recent-changes.html">Recent Changes</a></p>
<p><a href="offline-wiki.html">Offline Wiki</a></p>
</div><div class="qbsection">
<p><a href="unreal-engine.html">Unreal Engine</a></p>
<p><a href="console-commands.html">Console Commands</a></p>
<p><a href="terminology.html">Terminology</a></p>
<p><a href="category-faq.html">FAQs</a></p>
<p><a href="help-desk.html">Help Desk</a></p>
</div><div class="qbsection">
<p><a href="topics-on-mapping.html">Mapping Topics</a></p>
<p><a href="mapping-lessons.html">Mapping Lessons</a></p>
<p><a href="unrealed-3.html">UnrealEd Interface</a></p>
</div><div class="qbsection">
<p><a href="unrealscript.html">UnrealScript Topics</a></p>
<p><a href="unrealscript-lessons.html">UnrealScript Lessons</a></p>
<p><a href="making-mods.html">Making Mods</a></p>
<p><a href="class-tree.html">Class Tree</a></p>
</div><div class="qbsection">
<p><a href="topics-on-modeling.html">Modeling Topics</a></p>
</div><div class="qbsection">
<p><a href="chongqing-page.html">Chongqing Page</a></p>
<p><a href="log-in.html">Log In</a></p></div>
</div>

</body></html>
