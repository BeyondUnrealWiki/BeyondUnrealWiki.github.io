<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head lang="en">
	<title>UnrealWiki: Minigun/Script</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<link rel="stylesheet" type="text/css" media="screen, print"
		href="shared/stylebase.structural.css">	
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/template-default.css">
	<link rel="stylesheet" type="text/css" media="screen"
		href="shared/styles.chblue.css">
	<link rel="stylesheet" type="text/css" media="print"
		href="shared/template-default-print.css">
	<!--[if IE 6]>
			<style>
			/* dirty hack for IE6. */
			#quickbar {
				position: absolute;
				}
			</style>
	<![endif]-->
  <link rel="start" href="http://wiki.beyondunreal.com/">
  <link rel="glossary"  href="http://wiki.beyondunreal.com/wiki/Terminology">
  <link rel="help"  href="http://wiki.beyondunreal.com/wiki/Using_The_Wiki">
<script type="text/javascript" src="shared/dhtml.js"></script>
<script type="text/javascript" src="shared/dhtml-menu.js"></script>
<style type="text/css">#dhtml-menu    { background: #eee; padding: 5px 0px; margin-right: -20px; border: 1px solid #888; border-left: 1px solid #ccc; border-top: 1px solid #ccc;  border-right: 1px solid #888; border-bottom: 1px solid #888 }
#dhtml-menu td { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; padding: 1px 10px; cursor: default }
#dhtml-menu a  { color: #000; font-family: Arial,Helvetica,sans-serif; font-size: 9pt; line-height: 13pt; text-decoration: none }
#dhtml-menu tt { font-family: monospace; font-size: 9pt }
#dhtml-menu-separator { height: 1px; background: red }
#dhtml-menu-anchor { cursor: default }
</style>
<script type="text/javascript" src="shared/expandable.js"></script>
</head>
<body onLoad="menuInit(); document.cookie='page=Minigun/Script; path=/'" class="default">
<div id="scrolling"><!-- contains all except the fixed sidebar -->
<div id="topbar"  class="bar">
	<div class="righthalf">
		<input type="text" name="search"  size="14" /> <input type="button" onclick="location.href='../search-error/index.html';" value="search" />
	</div>
	<div class="lefthalf">
		<script type="text/javascript"><!--
			menuAlignRight = false;
		//--></script>
		<span><script type="text/javascript"><!--
 menuWriteAnchor("Quick Navigation") //--></script></span> | <a href="../index.html">Home Page</a> | <a href="recent-changes.html">Recent Changes</a>
	</div>
</div>

<div id="content"><!-- contains the title and article -->
	<h1 class='pagetitle'><a href="minigun.html">Minigun</a>/<a href="http://wiki.beyondunreal.com/wiki?back=Minigun/Script">Script</a></h1>
	<div class="wiki"><div class="classpath"><img src="shared//gameicons/icon-ut2003.png"> <a href="unreal-tournament-2003.html">UT2003</a> :: <a href="actor.html">Actor</a> &gt;&gt; <a href="pickup.html">Pickup</a> &gt;&gt; <a href="weapon.html">Weapon</a> &gt;&gt; Minigun (commented UnrealScript code)<br></div>
<p>This is a reference to the Minigun code in case you can't understand the code.  All the remarks you see in the code will be done by me.  It's a good reference for various guns that fire rapidly and have charge-up times.</p>
<pre class="uscript"><span class="uscript-comment">//=============================================================================</span>
<span class="uscript-comment">// Minigun  // This is the name of the weapon.</span>
<span class="uscript-comment">//=============================================================================</span>
<span class="uscript-keyword">class</span> Minigun <span class="uscript-keyword">extends</span> Weapon  <span class="uscript-comment">//The class is the type of weapon, while the extends is used to refer the code to a specific type of actor</span>
    <span class="uscript-keyword">config</span><span class="uscript-operator">(</span>user<span class="uscript-operator">)</span><span class="uscript-operator">;</span>  <span class="uscript-comment">// This says that there are variables here that get their values from the user.ini file.</span>

<span class="uscript-comment">// The InterfaceContent.utx file contains all the icons for all the weapons. The following line loads the file so we can get to the icon for our minigun.</span>
<span class="uscript-exec">#EXEC OBJ LOAD FILE=InterfaceContent.utx</span>

<span class="uscript-keyword">var</span>     <span class="uscript-type">float</span>           CurrentRoll<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span>     <span class="uscript-type">float</span>           RollSpeed<span class="uscript-operator">;</span>
<span class="uscript-comment">//var     float           FireTime;</span>
<span class="uscript-keyword">var</span><span class="uscript-operator">(</span><span class="uscript-operator">)</span> xEmitter          ShellCaseEmitter<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span><span class="uscript-operator">(</span><span class="uscript-operator">)</span> vector            AttachLoc<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span><span class="uscript-operator">(</span><span class="uscript-operator">)</span> rotator           AttachRot<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span>   <span class="uscript-type">int</span>               CurrentMode<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span><span class="uscript-operator">(</span><span class="uscript-operator">)</span> <span class="uscript-type">float</span>             GearRatio<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span><span class="uscript-operator">(</span><span class="uscript-operator">)</span> <span class="uscript-type">float</span>             GearOffset<span class="uscript-operator">;</span>
<span class="uscript-keyword">var</span><span class="uscript-operator">(</span><span class="uscript-operator">)</span> <span class="uscript-type">float</span>             Blend<span class="uscript-operator">;</span>
<span class="uscript-comment">//These are the variables used in the code</span>

<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> PostBeginPlay<span class="uscript-operator">(</span><span class="uscript-operator">)</span>  <span class="uscript-comment">//Says to start code after play begins</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">Super</span><span class="uscript-operator">.</span>PostBeginPlay<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> Level<span class="uscript-operator">.</span>NetMode <span class="uscript-operator">==</span> NM_DedicatedServer <span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span><span class="uscript-operator">;</span>

    ShellCaseEmitter <span class="uscript-operator">=</span> spawn<span class="uscript-operator">(</span><span class="uscript-keyword">class</span><span class="uscript-name">'ShellSpewer'</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> ShellCaseEmitter <span class="uscript-operator">!=</span> <span class="uscript-keyword">None</span> <span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        ShellCaseEmitter<span class="uscript-operator">.</span>Trigger<span class="uscript-operator">(</span><span class="uscript-keyword">Self</span><span class="uscript-operator">,</span> Instigator<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        AttachToBone<span class="uscript-operator">(</span>ShellCaseEmitter<span class="uscript-operator">,</span> <span class="uscript-name">'shell'</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span> <span class="uscript-comment">//This says if the ShellCaseEmitter variable is not zero then the minigun will create an emitter to expel the shells when you fire</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">function</span> DropFrom<span class="uscript-operator">(</span>vector StartLocation<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> Ammunition AssaultAmmo<span class="uscript-operator">;</span> <span class="uscript-comment">// This creates a local instance of Assault Rifle ammunition.</span>
    <span class="uscript-keyword">local</span> Weapon AssaultRifle<span class="uscript-operator">;</span>    <span class="uscript-comment">// This creates a local instance of an Assault Rifle.</span>
                                      <span class="uscript-comment">// Both of these will be used in the following lines, but will be "destroyed" when the function ends.</span>
    
    <span class="uscript-keyword">Super</span><span class="uscript-operator">.</span>DropFrom<span class="uscript-operator">(</span>StartLocation<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> <span class="uscript-operator">(</span>Instigator <span class="uscript-operator">!=</span> <span class="uscript-keyword">None</span><span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">(</span>Instigator<span class="uscript-operator">.</span>Health <span class="uscript-operator">&gt;</span> <span class="uscript-number">0</span><span class="uscript-operator">)</span> <span class="uscript-operator">)</span> 
    <span class="uscript-operator">{</span>
        
        AssaultAmmo <span class="uscript-operator">=</span> Ammunition<span class="uscript-operator">(</span>Instigator<span class="uscript-operator">.</span>FindInventoryType<span class="uscript-operator">(</span><span class="uscript-keyword">class</span><span class="uscript-name">'MinigunAmmo'</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> AssaultAmmo <span class="uscript-operator">==</span> <span class="uscript-keyword">None</span> <span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            AssaultAmmo <span class="uscript-operator">=</span> spawn<span class="uscript-operator">(</span><span class="uscript-keyword">class</span><span class="uscript-name">'MinigunAmmo'</span><span class="uscript-operator">,</span>Instigator<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
            AssaultAmmo<span class="uscript-operator">.</span>GiveTo<span class="uscript-operator">(</span> Instigator<span class="uscript-operator">,</span> <span class="uscript-keyword">None</span> <span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span> <span class="uscript-comment">//This is the code to cause the ammo to be shared with the Assualt Rifle</span>
        AssaultAmmo<span class="uscript-operator">.</span>AmmoAmount <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
        AssaultRifle <span class="uscript-operator">=</span> Weapon<span class="uscript-operator">(</span>Instigator<span class="uscript-operator">.</span>FindInventoryType<span class="uscript-operator">(</span><span class="uscript-keyword">class</span><span class="uscript-name">'AssaultRifle'</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> AssaultRifle <span class="uscript-operator">!=</span> <span class="uscript-keyword">None</span> <span class="uscript-operator">)</span>
            AssaultRifle<span class="uscript-operator">.</span>Ammo<span class="uscript-operator">[</span><span class="uscript-number">0</span><span class="uscript-operator">]</span> <span class="uscript-operator">=</span> AssaultAmmo<span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>   
<span class="uscript-operator">}</span>

<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> OutOfAmmo<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> <span class="uscript-operator">!</span>Instigator<span class="uscript-operator">.</span>IsLocallyControlled<span class="uscript-operator">(</span><span class="uscript-operator">)</span> <span class="uscript-operator">||</span> HasAmmo<span class="uscript-operator">(</span><span class="uscript-operator">)</span> <span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span><span class="uscript-operator">;</span>

    Instigator<span class="uscript-operator">.</span>AmbientSound <span class="uscript-operator">=</span> <span class="uscript-keyword">None</span><span class="uscript-operator">;</span>
    DoAutoSwitch<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span> <span class="uscript-comment">//This says if a minigun runs out of ammo the weapon will autoswitch</span>

<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> Destroyed<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>ShellCaseEmitter <span class="uscript-operator">!=</span> <span class="uscript-keyword">None</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        ShellCaseEmitter<span class="uscript-operator">.</span>Destroy<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        ShellCaseEmitter <span class="uscript-operator">=</span> <span class="uscript-keyword">None</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>

    <span class="uscript-keyword">Super</span><span class="uscript-operator">.</span>Destroyed<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

BotFire<span class="uscript-operator">(</span><span class="uscript-operator">)</span> <span class="uscript-comment">//Initiates this section of code when a bot fires.</span>
<span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> BotFire<span class="uscript-operator">(</span><span class="uscript-type">bool</span> bFinished<span class="uscript-operator">,</span> <span class="uscript-keyword">optional</span> <span class="uscript-type">name</span> FiringMode<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> newmode<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> Controller C<span class="uscript-operator">;</span>

    C <span class="uscript-operator">=</span> Instigator<span class="uscript-operator">.</span>Controller<span class="uscript-operator">;</span>
    newMode <span class="uscript-operator">=</span> BestMode<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> newMode <span class="uscript-operator">==</span> <span class="uscript-number">0</span> <span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        C<span class="uscript-operator">.</span>bFire <span class="uscript-operator">=</span> <span class="uscript-number">1</span><span class="uscript-operator">;</span>
        C<span class="uscript-operator">.</span>bAltFire <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
    <span class="uscript-keyword">else</span>
    <span class="uscript-operator">{</span>
        C<span class="uscript-operator">.</span>bFire <span class="uscript-operator">=</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
        C<span class="uscript-operator">.</span>bAltFire <span class="uscript-operator">=</span> <span class="uscript-number">1</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> bFinished <span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span> <span class="uscript-keyword">true</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> FireMode<span class="uscript-operator">[</span>BotMode<span class="uscript-operator">]</span><span class="uscript-operator">.</span>bIsFiring <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">(</span>NewMode <span class="uscript-operator">!=</span> BotMode<span class="uscript-operator">)</span> <span class="uscript-operator">)</span>
        StopFire<span class="uscript-operator">(</span>BotMode<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> <span class="uscript-operator">!</span>ReadyToFire<span class="uscript-operator">(</span>newMode<span class="uscript-operator">)</span> <span class="uscript-operator">||</span> ClientState <span class="uscript-operator">!=</span> WS_ReadyToFire <span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span> <span class="uscript-keyword">false</span><span class="uscript-operator">;</span>

    BotMode <span class="uscript-operator">=</span> NewMode<span class="uscript-operator">;</span>
    StartFire<span class="uscript-operator">(</span>NewMode<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">return</span> <span class="uscript-keyword">true</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span> <span class="uscript-comment">//Allows the bots to change firing mode when using the minigun</span>

<span class="uscript-comment">//This is the AI Interface</span>
<span class="uscript-keyword">function</span> <span class="uscript-type">float</span> GetAIRating<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">return</span> AIRating <span class="uscript-operator">*</span> FMin<span class="uscript-operator">(</span>Pawn<span class="uscript-operator">(</span>Owner<span class="uscript-operator">)</span><span class="uscript-operator">.</span>DamageScaling<span class="uscript-operator">,</span> <span class="uscript-number">1.5</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

BestMode<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-keyword">function</span> <span class="uscript-type">byte</span> BestMode<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">float</span> EnemyDist<span class="uscript-operator">;</span>
    <span class="uscript-keyword">local</span> bot B<span class="uscript-operator">;</span>

    B <span class="uscript-operator">=</span> Bot<span class="uscript-operator">(</span>Instigator<span class="uscript-operator">.</span>Controller<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> <span class="uscript-operator">(</span>B <span class="uscript-operator">==</span> <span class="uscript-keyword">None</span><span class="uscript-operator">)</span> <span class="uscript-operator">||</span> <span class="uscript-operator">(</span>B<span class="uscript-operator">.</span>Enemy <span class="uscript-operator">==</span> <span class="uscript-keyword">None</span><span class="uscript-operator">)</span> <span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> FireMode<span class="uscript-operator">[</span><span class="uscript-number">0</span><span class="uscript-operator">]</span><span class="uscript-operator">.</span>bIsFiring <span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">else</span> <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> FireMode<span class="uscript-operator">[</span><span class="uscript-number">1</span><span class="uscript-operator">]</span><span class="uscript-operator">.</span>bIsFiring <span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span> <span class="uscript-number">1</span><span class="uscript-operator">;</span>
    EnemyDist <span class="uscript-operator">=</span> VSize<span class="uscript-operator">(</span>B<span class="uscript-operator">.</span>Enemy<span class="uscript-operator">.</span>Location <span class="uscript-operator">-</span> Instigator<span class="uscript-operator">.</span>Location<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> EnemyDist <span class="uscript-operator">&lt;</span> <span class="uscript-number">2000</span> <span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span> <span class="uscript-number">0</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">return</span> <span class="uscript-number">1</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span> <span class="uscript-comment">//This section is used to choose the best firing mode for the bots</span>

<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> SpawnShells<span class="uscript-operator">(</span><span class="uscript-type">float</span> amountPerSec<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">if</span><span class="uscript-operator">(</span>ShellCaseEmitter <span class="uscript-operator">==</span> <span class="uscript-keyword">None</span> <span class="uscript-operator">||</span> <span class="uscript-operator">!</span>FirstPersonView<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> Bot<span class="uscript-operator">(</span>Instigator<span class="uscript-operator">.</span>Controller<span class="uscript-operator">)</span> <span class="uscript-operator">!=</span> <span class="uscript-keyword">None</span> <span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        ShellCaseEmitter<span class="uscript-operator">.</span>Destroy<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        <span class="uscript-keyword">return</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>

    ShellCaseEmitter<span class="uscript-operator">.</span>mRegenRange<span class="uscript-operator">[</span><span class="uscript-number">0</span><span class="uscript-operator">]</span> <span class="uscript-operator">=</span> amountPerSec<span class="uscript-operator">;</span>
    ShellCaseEmitter<span class="uscript-operator">.</span>mRegenRange<span class="uscript-operator">[</span><span class="uscript-number">1</span><span class="uscript-operator">]</span> <span class="uscript-operator">=</span> amountPerSec<span class="uscript-operator">;</span>
    ShellCaseEmitter<span class="uscript-operator">.</span>Trigger<span class="uscript-operator">(</span><span class="uscript-keyword">self</span><span class="uscript-operator">,</span> Instigator<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span> <span class="uscript-comment">//This is the code for the amount of shells spawned per sec</span>

<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> FirstPersonView<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">return</span> <span class="uscript-operator">(</span>Instigator<span class="uscript-operator">.</span>IsLocallyControlled<span class="uscript-operator">(</span><span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">(</span>PlayerController<span class="uscript-operator">(</span>Instigator<span class="uscript-operator">.</span>Controller<span class="uscript-operator">)</span> <span class="uscript-operator">!=</span> <span class="uscript-keyword">None</span><span class="uscript-operator">)</span> <span class="uscript-operator">&amp;&amp;</span> <span class="uscript-operator">!</span>PlayerController<span class="uscript-operator">(</span>Instigator<span class="uscript-operator">.</span>Controller<span class="uscript-operator">)</span><span class="uscript-operator">.</span>bBehindView<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-comment">//This next section prevents the wrong animations from playing</span>
<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> AnimEnd<span class="uscript-operator">(</span><span class="uscript-type">int</span> channel<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
<span class="uscript-operator">}</span>

<span class="uscript-comment">// This is client side only: It updates the first person barrel rotation</span>
<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> UpdateRoll<span class="uscript-operator">(</span><span class="uscript-type">float</span> dt<span class="uscript-operator">,</span> <span class="uscript-type">float</span> speed<span class="uscript-operator">,</span> <span class="uscript-type">int</span> mode<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> rotator r<span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>Level<span class="uscript-operator">.</span>NetMode <span class="uscript-operator">==</span> NM_DedicatedServer<span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>mode <span class="uscript-operator">==</span> CurrentMode<span class="uscript-operator">)</span> <span class="uscript-comment">// to limit to one mode</span>
    <span class="uscript-operator">{</span>
       <span class="uscript-comment">// log(self$" updateroll (mode="$mode$") speed="$speed);</span>

        RollSpeed <span class="uscript-operator">=</span> speed<span class="uscript-operator">;</span>
        CurrentRoll <span class="uscript-operator">+=</span> dt<span class="uscript-operator">*</span>RollSpeed<span class="uscript-operator">;</span>
        CurrentRoll <span class="uscript-operator">=</span> CurrentRoll <span class="uscript-operator">%</span> <span class="uscript-number">65536</span><span class="uscript-operator">.</span>f<span class="uscript-operator">;</span>
        r<span class="uscript-operator">.</span>Roll <span class="uscript-operator">=</span> <span class="uscript-type">int</span><span class="uscript-operator">(</span>CurrentRoll<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        SetBoneRotation<span class="uscript-operator">(</span><span class="uscript-name">'Bone Barrels'</span><span class="uscript-operator">,</span> r<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">,</span> Blend<span class="uscript-operator">)</span><span class="uscript-operator">;</span>

        r<span class="uscript-operator">.</span>Roll <span class="uscript-operator">=</span> GearOffset <span class="uscript-operator">+</span> r<span class="uscript-operator">.</span>Roll<span class="uscript-operator">*</span>GearRatio<span class="uscript-operator">;</span>
        SetBoneRotation<span class="uscript-operator">(</span><span class="uscript-name">'Bone gear'</span><span class="uscript-operator">,</span> r<span class="uscript-operator">,</span> <span class="uscript-number">0</span><span class="uscript-operator">,</span> Blend<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-operator">}</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> StartFire<span class="uscript-operator">(</span><span class="uscript-type">int</span> mode<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">bool</span> bStart<span class="uscript-operator">;</span>

    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span> <span class="uscript-operator">!</span>MinigunFire<span class="uscript-operator">(</span>FireMode<span class="uscript-operator">[</span><span class="uscript-number">0</span><span class="uscript-operator">]</span><span class="uscript-operator">)</span><span class="uscript-operator">.</span>IsIdle<span class="uscript-operator">(</span><span class="uscript-operator">)</span> <span class="uscript-operator">||</span> <span class="uscript-operator">!</span>MinigunFire<span class="uscript-operator">(</span>FireMode<span class="uscript-operator">[</span><span class="uscript-number">1</span><span class="uscript-operator">]</span><span class="uscript-operator">)</span><span class="uscript-operator">.</span>IsIdle<span class="uscript-operator">(</span><span class="uscript-operator">)</span> <span class="uscript-operator">)</span>
        <span class="uscript-keyword">return</span> <span class="uscript-keyword">false</span><span class="uscript-operator">;</span>

    bStart <span class="uscript-operator">=</span> <span class="uscript-keyword">Super</span><span class="uscript-operator">.</span>StartFire<span class="uscript-operator">(</span>mode<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
    <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>bStart<span class="uscript-operator">)</span>
        FireMode<span class="uscript-operator">[</span>mode<span class="uscript-operator">]</span><span class="uscript-operator">.</span>StartFiring<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">return</span> bStart<span class="uscript-operator">;</span>
<span class="uscript-operator">}</span> <span class="uscript-comment">// If this function returns True, the weapon will start firing, if it returns False, it won't.</span>

<span class="uscript-comment">// This section allows fire modes to return to idle on weapon switch </span>
<span class="uscript-operator">(</span><span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> DetachFromPawn<span class="uscript-operator">(</span>Pawn P<span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    ReturnToIdle<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">Super</span><span class="uscript-operator">.</span>DetachFromPawn<span class="uscript-operator">(</span>P<span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> <span class="uscript-type">bool</span> PutDown<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    ReturnToIdle<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>

    <span class="uscript-keyword">return</span> <span class="uscript-keyword">Super</span><span class="uscript-operator">.</span>PutDown<span class="uscript-operator">(</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">simulated</span> <span class="uscript-keyword">function</span> ReturnToIdle<span class="uscript-operator">(</span><span class="uscript-operator">)</span>
<span class="uscript-operator">{</span>
    <span class="uscript-keyword">local</span> <span class="uscript-type">int</span> mode<span class="uscript-operator">;</span>

    <span class="uscript-keyword">for</span> <span class="uscript-operator">(</span>mode<span class="uscript-operator">=</span><span class="uscript-number">0</span><span class="uscript-operator">;</span> mode<span class="uscript-operator">&lt;</span>NUM_FIRE_MODES<span class="uscript-operator">;</span> mode<span class="uscript-operator">++</span><span class="uscript-operator">)</span>
    <span class="uscript-operator">{</span>
        <span class="uscript-keyword">if</span> <span class="uscript-operator">(</span>FireMode<span class="uscript-operator">[</span>mode<span class="uscript-operator">]</span> <span class="uscript-operator">!=</span> <span class="uscript-keyword">None</span><span class="uscript-operator">)</span>
        <span class="uscript-operator">{</span>
            FireMode<span class="uscript-operator">[</span>mode<span class="uscript-operator">]</span><span class="uscript-operator">.</span>GotoState<span class="uscript-operator">(</span><span class="uscript-name">'Idle'</span><span class="uscript-operator">)</span><span class="uscript-operator">;</span>
        <span class="uscript-operator">}</span>
    <span class="uscript-operator">}</span>
<span class="uscript-operator">}</span>

<span class="uscript-keyword">defaultproperties</span> <span class="uscript-comment">// These are the default properties of each variable. Some were created at the top of this file, others are inherited from the weapon's parent class.</span>
<span class="uscript-operator">{</span>
     AttachLoc<span class="uscript-operator">=</span><span class="uscript-operator">(</span>X<span class="uscript-operator">=</span><span class="uscript-operator">-</span><span class="uscript-number">77.000000</span><span class="uscript-operator">,</span>Y<span class="uscript-operator">=</span><span class="uscript-number">6.000000</span><span class="uscript-operator">,</span>Z<span class="uscript-operator">=</span><span class="uscript-number">4.000000</span><span class="uscript-operator">)</span> <span class="uscript-comment">// Where the model attachs</span>
     AttachRot<span class="uscript-operator">=</span><span class="uscript-operator">(</span>Pitch<span class="uscript-operator">=</span><span class="uscript-number">22000</span><span class="uscript-operator">,</span>Yaw<span class="uscript-operator">=</span><span class="uscript-operator">-</span><span class="uscript-number">16384</span><span class="uscript-operator">)</span> <span class="uscript-comment">// The rotation it is at</span>
     GearRatio<span class="uscript-operator">=</span><span class="uscript-operator">-</span><span class="uscript-number">2.370000</span>
     Blend<span class="uscript-operator">=</span><span class="uscript-number">1.000000</span>
     FireModeClass<span class="uscript-operator">(</span><span class="uscript-number">0</span><span class="uscript-operator">)</span><span class="uscript-operator">=</span><span class="uscript-keyword">Class</span><span class="uscript-name">'XWeapons.MinigunFire'</span>    <span class="uscript-comment">// Firing mode 1 (Primary)</span>
     FireModeClass<span class="uscript-operator">(</span><span class="uscript-number">1</span><span class="uscript-operator">)</span><span class="uscript-operator">=</span><span class="uscript-keyword">Class</span><span class="uscript-name">'XWeapons.MinigunAltFire'</span> <span class="uscript-comment">// Firing mode 2 (Alt/Secondary)</span>
     PutDownAnim<span class="uscript-operator">=</span><span class="uscript-string">"PutDown"</span>
     SelectSound<span class="uscript-operator">=</span>Sound<span class="uscript-name">'WeaponSounds.Minigun.SwitchToMiniGun'</span> <span class="uscript-comment">// The Sound that is played when you switch to this weapon.</span>
     SelectForce<span class="uscript-operator">=</span><span class="uscript-string">"SwitchToMiniGun"</span>
     AIRating<span class="uscript-operator">=</span><span class="uscript-number">0.710000</span>
     CurrentRating<span class="uscript-operator">=</span><span class="uscript-number">0.710000</span>
     EffectOffset<span class="uscript-operator">=</span><span class="uscript-operator">(</span>X<span class="uscript-operator">=</span><span class="uscript-number">100.000000</span><span class="uscript-operator">,</span>Y<span class="uscript-operator">=</span><span class="uscript-number">18.000000</span><span class="uscript-operator">,</span>Z<span class="uscript-operator">=</span><span class="uscript-operator">-</span><span class="uscript-number">16.000000</span><span class="uscript-operator">)</span>
     DisplayFOV<span class="uscript-operator">=</span><span class="uscript-number">60.000000</span>
     Priority<span class="uscript-operator">=</span><span class="uscript-number">7</span>
     DefaultPriority<span class="uscript-operator">=</span><span class="uscript-number">7</span>
     HudColor<span class="uscript-operator">=</span><span class="uscript-operator">(</span>B<span class="uscript-operator">=</span><span class="uscript-number">255</span><span class="uscript-operator">)</span>
     SmallViewOffset<span class="uscript-operator">=</span><span class="uscript-operator">(</span>X<span class="uscript-operator">=</span><span class="uscript-number">8.000000</span><span class="uscript-operator">,</span>Y<span class="uscript-operator">=</span><span class="uscript-number">1.000000</span><span class="uscript-operator">,</span>Z<span class="uscript-operator">=</span><span class="uscript-operator">-</span><span class="uscript-number">2.000000</span><span class="uscript-operator">)</span>
     CenteredOffsetY<span class="uscript-operator">=</span><span class="uscript-operator">-</span><span class="uscript-number">6.000000</span>
     CenteredRoll<span class="uscript-operator">=</span><span class="uscript-number">0</span>
     CenteredYaw<span class="uscript-operator">=</span><span class="uscript-operator">-</span><span class="uscript-number">500</span>
     InventoryGroup<span class="uscript-operator">=</span><span class="uscript-number">6</span> <span class="uscript-comment">// The inventory group used (i.e. the number you press to reach the gun)</span>
     PickupClass<span class="uscript-operator">=</span><span class="uscript-keyword">Class</span><span class="uscript-name">'XWeapons.MinigunPickup'</span> <span class="uscript-comment">// The MinigunPickup class defines the weapon the way it sits on the ground.</span>
     PlayerViewOffset<span class="uscript-operator">=</span><span class="uscript-operator">(</span>X<span class="uscript-operator">=</span><span class="uscript-number">2.000000</span><span class="uscript-operator">,</span>Y<span class="uscript-operator">=</span><span class="uscript-operator">-</span><span class="uscript-number">1.000000</span><span class="uscript-operator">)</span>
     PlayerViewPivot<span class="uscript-operator">=</span><span class="uscript-operator">(</span>Yaw<span class="uscript-operator">=</span><span class="uscript-number">500</span><span class="uscript-operator">)</span>
     BobDamping<span class="uscript-operator">=</span><span class="uscript-number">2.250000</span>
     AttachmentClass<span class="uscript-operator">=</span><span class="uscript-keyword">Class</span><span class="uscript-name">'XWeapons.MinigunAttachment'</span>
     IconMaterial<span class="uscript-operator">=</span>Texture<span class="uscript-name">'InterfaceContent.HUD.SkinA'</span>
     IconCoords<span class="uscript-operator">=</span><span class="uscript-operator">(</span>X1<span class="uscript-operator">=</span><span class="uscript-number">200</span><span class="uscript-operator">,</span>Y1<span class="uscript-operator">=</span><span class="uscript-number">372</span><span class="uscript-operator">,</span>X2<span class="uscript-operator">=</span><span class="uscript-number">321</span><span class="uscript-operator">,</span>Y2<span class="uscript-operator">=</span><span class="uscript-number">462</span><span class="uscript-operator">)</span>
     ItemName<span class="uscript-operator">=</span><span class="uscript-string">"Minigun"</span> <span class="uscript-comment">// The name!</span>

     LightType<span class="uscript-operator">=</span>LT_Pulse             <span class="uscript-comment">// Any of the excellent lighting tutorials</span>
     LightEffect<span class="uscript-operator">=</span>LE_NonIncidence    <span class="uscript-comment">// at the Wiki and around the web can </span>
     LightBrightness<span class="uscript-operator">=</span><span class="uscript-number">150.000000</span>     <span class="uscript-comment">// detail what these light properties</span>
     LightRadius<span class="uscript-operator">=</span><span class="uscript-number">4.000000</span>           <span class="uscript-comment">// are. They are the same properties that </span>
     LightHue<span class="uscript-operator">=</span><span class="uscript-number">30</span>                    <span class="uscript-comment">// you would set on a light on your map.</span>
     LightSaturation<span class="uscript-operator">=</span><span class="uscript-number">150</span>            <span class="uscript-comment">// If you look closely on a dark map you'll </span>
     LightPeriod<span class="uscript-operator">=</span><span class="uscript-number">3</span>                  <span class="uscript-comment">// notice that all the weapons actually give off a pulse light.</span>

     Mesh<span class="uscript-operator">=</span>SkeletalMesh<span class="uscript-name">'Weapons.Minigun_1st'</span> <span class="uscript-comment">// The skeletal mesh of the model</span>
     DrawScale<span class="uscript-operator">=</span><span class="uscript-number">0.400000</span>
     UV2Texture<span class="uscript-operator">=</span>Shader<span class="uscript-name">'XGameShaders.WeaponShaders.WeaponEnvShader'</span>
     SoundRadius<span class="uscript-operator">=</span><span class="uscript-number">400.000000</span> <span class="uscript-comment">// The radius of the minigun sounds</span>
<span class="uscript-operator">}</span></pre></div>
</div>

<div id="footer" class="bar">
	<p>
<a href="../index.html">Home Page</a> | <a href="minigun.html">Minigun</a> | <a href="recent-changes.html">Recent Changes</a><br>
Last edited October 9, 2004 6:53 <a href="http://wiki.beyondunreal.com/wiki?action=browse&diff=1&id=Minigun/Script">(diff)</a><br>Search: <input type="text" name="search"  size="14" /><input type="button" onclick="location.href='../search-error/index.html';" value="search" /><br><br><small><a href="http://wiki.beyondunreal.com/wiki/Minigun/Script">Original page</a> &#150; copy created Sat, Jun 23, 2007</small><div></div>

	</p>
	<p>Cogito, ergo sum
</p>
</div>
</div><!-- close of "scrolling" div -->

<div id="quickbar">
	<div id="logo"><a href="../index.html"><img src="shared/wikilogo.jpg" width="143" height="100" border="0"></a>
		</div>
	<div class="qbsitename">
		<p>The Unreal Engine Documentation Site</p>
	</div>
	<div class="qbsection">
<p><a href="metatopics.html">Wiki Community</a></p>
<p><a href="category-category.html">Topic Categories</a></p>


<p><a href="recent-changes.html">Recent Changes</a></p>
<p><a href="offline-wiki.html">Offline Wiki</a></p>
</div><div class="qbsection">
<p><a href="unreal-engine.html">Unreal Engine</a></p>
<p><a href="console-commands.html">Console Commands</a></p>
<p><a href="terminology.html">Terminology</a></p>
<p><a href="category-faq.html">FAQs</a></p>
<p><a href="help-desk.html">Help Desk</a></p>
</div><div class="qbsection">
<p><a href="topics-on-mapping.html">Mapping Topics</a></p>
<p><a href="mapping-lessons.html">Mapping Lessons</a></p>
<p><a href="unrealed-3.html">UnrealEd Interface</a></p>
</div><div class="qbsection">
<p><a href="unrealscript.html">UnrealScript Topics</a></p>
<p><a href="unrealscript-lessons.html">UnrealScript Lessons</a></p>
<p><a href="making-mods.html">Making Mods</a></p>
<p><a href="class-tree.html">Class Tree</a></p>
</div><div class="qbsection">
<p><a href="topics-on-modeling.html">Modeling Topics</a></p>
</div><div class="qbsection">
<p><a href="chongqing-page.html">Chongqing Page</a></p>
<p><a href="log-in.html">Log In</a></p></div>
</div>

</body></html>
